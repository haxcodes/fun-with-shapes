var paper=function(t,e){var i=t?t.window:require("./node/window"),n=i&&i.document;t=t||i;var r=new function(){function t(t,e,i,n,a){function o(s,o){o=o||(o=l(e,s))&&(o.get?o:o.value),"string"==typeof o&&"#"===o[0]&&(o=t[o.substring(1)]||o);var u,f="function"==typeof o,d=o,_=a||f&&!o.base?o&&o.get?s in t:t[s]:null;a&&_||(f&&_&&(o.base=_),f&&n!==!1&&(u=s.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(h[u[3].toLowerCase()+u[4]]=u[2]),d&&!f&&d.get&&"function"==typeof d.get&&r.isPlainObject(d)||(d={value:d,writable:!0}),(l(t,s)||{configurable:!0}).configurable&&(d.configurable=!0,d.enumerable=i),c(t,s,d))}var h={};if(e){for(var u in e)e.hasOwnProperty(u)&&!s.test(u)&&o(u);for(var u in h){var f=h[u],d=t["set"+f],_=t["get"+f]||d&&t["is"+f];!_||n!==!0&&0!==_.length||o(u,{get:_,set:d})}}return t}function i(t,e,i){return t&&("length"in t&&!t.getLength&&"number"==typeof t.length?a:o).call(t,e,i=i||t),i}function n(t,e,i){for(var n=i,r=e.length;n<r;n++){var s=e[n];for(var a in s)s.hasOwnProperty(a)&&(t[a]=s[a])}return t}var s=/^(statics|enumerable|beans|preserve)$/,a=[].forEach||function(t,e){for(var i=0,n=this.length;i<n;i++)t.call(e,this[i],i,this)},o=function(t,e){for(var i in this)this.hasOwnProperty(i)&&t.call(e,this[i],i,this)},h=Object.create||function(t){return{__proto__:t}},l=Object.getOwnPropertyDescriptor||function(t,e){var i=t.__lookupGetter__&&t.__lookupGetter__(e);return i?{get:i,set:t.__lookupSetter__(e),enumerable:!0,configurable:!0}:t.hasOwnProperty(e)?{value:t[e],enumerable:!0,configurable:!0,writable:!0}:null},u=Object.defineProperty||function(t,e,i){return(i.get||i.set)&&t.__defineGetter__?(i.get&&t.__defineGetter__(e,i.get),i.set&&t.__defineSetter__(e,i.set)):t[e]=i.value,t},c=function(t,e,i){return delete t[e],u(t,e,i)};return t(function(){n(this,arguments,0)},{inject:function(e){if(e){var i=e.statics===!0?e:e.statics,n=e.beans,r=e.preserve;i!==e&&t(this.prototype,e,e.enumerable,n,r),t(this,i,!0,n,r)}for(var s=1,a=arguments.length;s<a;s++)this.inject(arguments[s]);return this},extend:function(){for(var e,i,n,r=this,s=0,a=arguments.length;s<a&&(!e||!i);s++)n=arguments[s],e=e||n.initialize,i=i||n.prototype;return e=e||function(){r.apply(this,arguments)},i=e.prototype=i||h(this.prototype),c(i,"constructor",{value:e,writable:!0,configurable:!0}),t(e,this,!0),arguments.length&&this.inject.apply(e,arguments),e.base=r,e}},!0).inject({inject:function(){for(var e=0,i=arguments.length;e<i;e++){var n=arguments[e];n&&t(this,n,n.enumerable,n.beans,n.preserve)}return this},extend:function(){var t=h(this);return t.inject.apply(t,arguments)},each:function(t,e){return i(this,t,e)},set:function(){return n(this,arguments,0)},clone:function(){return new this.constructor(this)},statics:{each:i,create:h,define:c,describe:l,set:function(t){return n(t,arguments,1)},clone:function(t){return n(new t.constructor,arguments,0)},isPlainObject:function(t){var e=null!=t&&t.constructor;return e&&(e===Object||e===r||"Object"===e.name)},pick:function(t,i){return t!==e?t:i}}})};"undefined"!=typeof module&&(module.exports=r),r.inject({toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+r.each(this,function(t,e){if(!/^_/.test(e)){var i=typeof t;this.push(e+": "+("number"===i?h.instance.number(t):"string"===i?"'"+t+"'":t))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(t){return r.importJSON(t,this)},exportJSON:function(t){return r.exportJSON(this,t)},toJSON:function(){return r.serialize(this)},_set:function(t){if(t&&r.isPlainObject(t))return r.filter(this,t)},statics:{exports:{enumerable:!0},extend:function t(){var e=t.base.apply(this,arguments),i=e.prototype._class;return i&&!r.exports[i]&&(r.exports[i]=e),e},equals:function(t,e){if(t===e)return!0;if(t&&t.equals)return t.equals(e);if(e&&e.equals)return e.equals(t);if(t&&e&&"object"==typeof t&&"object"==typeof e){if(Array.isArray(t)&&Array.isArray(e)){var i=t.length;if(i!==e.length)return!1;for(;i--;)if(!r.equals(t[i],e[i]))return!1}else{var n=Object.keys(t),i=n.length;if(i!==Object.keys(e).length)return!1;for(;i--;){var s=n[i];if(!e.hasOwnProperty(s)||!r.equals(t[s],e[s]))return!1}}return!0}return!1},read:function(t,i,n,s){if(this===r){var a=this.peek(t,i);return t.__index++,a}var o=this.prototype,h=o._readIndex,l=i||h&&t.__index||0;s||(s=t.length-l);var u=t[l];return u instanceof this||n&&n.readNull&&null==u&&s<=1?(h&&(t.__index=l+1),u&&n&&n.clone?u.clone():u):(u=r.create(this.prototype),h&&(u.__read=!0),u=u.initialize.apply(u,l>0||s<t.length?Array.prototype.slice.call(t,l,l+s):t)||u,h&&(t.__index=l+u.__read,u.__read=e),u)},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readAll:function(t,e,i){for(var n,r=[],s=e||0,a=t.length;s<a;s++)r.push(Array.isArray(n=t[s])?this.read(n,0,i):this.read(t,s,i,1));return r},readNamed:function(t,i,n,s,a){var o=this.getNamed(t,i),h=o!==e;if(h){var l=t._filtered;l||(l=t._filtered=r.create(t[0]),l._filtering=t[0]),l[i]=e}return this.read(h?[o]:t,n,s,a)},getNamed:function(t,i){var n=t[0];if(t._hasObject===e&&(t._hasObject=1===t.length&&r.isPlainObject(n)),t._hasObject)return i?n[i]:t._filtered||n},hasNamed:function(t,e){return!!this.getNamed(t,e)},filter:function(t,i,n){for(var r=Object.keys(i._filtering||i),s=0,a=r.length;s<a;s++){var o=r[s];if(!n||!n[o]){var h=i[o];h!==e&&(t[o]=h)}}return t},isPlainValue:function(t,e){return this.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,e,i,n){e=e||{};var s,a=!n;if(a&&(e.formatter=new h(e.precision),n={length:0,definitions:{},references:{},add:function(t,e){var i="#"+t._id,n=this.references[i];if(!n){this.length++;var r=e.call(t),s=t._class;s&&r[0]!==s&&r.unshift(s),this.definitions[i]=r,n=this.references[i]=[i]}return n}}),t&&t._serialize){s=t._serialize(e,n);var o=t._class;!o||t._compactSerialize||!a&&i||s[0]===o||s.unshift(o)}else if(Array.isArray(t)){s=[];for(var l=0,u=t.length;l<u;l++)s[l]=r.serialize(t[l],e,i,n)}else if(r.isPlainObject(t)){s={};for(var c=Object.keys(t),l=0,u=c.length;l<u;l++){var f=c[l];s[f]=r.serialize(t[f],e,i,n)}}else s="number"==typeof t?e.formatter.number(t,e.precision):t;return a&&n.length>0?[["dictionary",n.definitions],s]:s},deserialize:function(t,e,i,n,s){var a=t,o=!i,h=o&&t&&t.length&&"dictionary"===t[0][0];if(i=i||{},Array.isArray(t)){var l=t[0],u="dictionary"===l;if(1==t.length&&/^#/.test(l))return i.dictionary[l];l=r.exports[l],a=[];for(var c=l?1:0,f=t.length;c<f;c++)a.push(r.deserialize(t[c],e,i,u,h));if(l){var d=a;e?a=e(l,d,o||s):(a=r.create(l.prototype),l.apply(a,d))}}else if(r.isPlainObject(t)){a={},n&&(i.dictionary=a);for(var _ in t)a[_]=r.deserialize(t[_],e,i)}return h?a[1]:a},exportJSON:function(t,e){var i=r.serialize(t,e);return e&&e.asString===!1?i:JSON.stringify(i)},importJSON:function(t,e){return r.deserialize("string"==typeof t?JSON.parse(t):t,function(t,i,n){var s=n&&e&&e.constructor===t,a=s?e:r.create(t.prototype);if(1===i.length&&a instanceof x&&(s||!(a instanceof w))){var o=i[0];r.isPlainObject(o)&&(o.insert=!1)}return(s?a._set:t).apply(a,i),s&&(e=null),a})},splice:function(t,i,n,r){var s=i&&i.length,a=n===e;n=a?t.length:n,n>t.length&&(n=t.length);for(var o=0;o<s;o++)i[o]._index=n+o;if(a)return t.push.apply(t,i),[];var h=[n,r];i&&h.push.apply(h,i);for(var l=t.splice.apply(t,h),o=0,u=l.length;o<u;o++)l[o]._index=e;for(var o=n+s,u=t.length;o<u;o++)t[o]._index=o;return l},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var s={on:function(t,e){if("string"!=typeof t)r.each(t,function(t,e){this.on(e,t)},this);else{var i=this._eventTypes,n=i&&i[t],s=this._callbacks=this._callbacks||{};s=s[t]=s[t]||[],s.indexOf(e)===-1&&(s.push(e),n&&n.install&&1===s.length&&n.install.call(this,t))}return this},off:function(t,e){if("string"!=typeof t)return void r.each(t,function(t,e){this.off(e,t)},this);var i,n=this._eventTypes,s=n&&n[t],a=this._callbacks&&this._callbacks[t];return a&&(!e||(i=a.indexOf(e))!==-1&&1===a.length?(s&&s.uninstall&&s.uninstall.call(this,t),delete this._callbacks[t]):i!==-1&&a.splice(i,1)),this},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){var i=this._callbacks&&this._callbacks[t];if(!i)return!1;var n=[].slice.call(arguments,1),r=e&&e.target&&!e.currentTarget;i=i.slice(),r&&(e.currentTarget=this);for(var s=0,a=i.length;s<a;s++)if(i[s].apply(this,n)===!1){e&&e.stop&&e.stop();break}return r&&delete e.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._eventTypes,i=this._callbacks,n=t?"install":"uninstall";if(e)for(var r in i)if(i[r].length>0){var s=e[r],a=s&&s[n];a&&a.call(this,r)}},statics:{inject:function t(e){var i=e._events;if(i){var n={};r.each(i,function(t,i){var s="string"==typeof t,a=s?t:i,o=r.capitalize(a),h=a.substring(2).toLowerCase();n[h]=s?{}:t,a="_"+a,e["get"+o]=function(){return this[a]},e["set"+o]=function(t){var e=this[a];e&&this.off(h,e),t&&this.on(h,t),this[a]=t}}),e._eventTypes=n}return t.base.apply(this,arguments)}}},a=r.extend({_class:"PaperScope",initialize:function e(){paper=this,this.settings=new r({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=e._id++,e._scopes[this._id]=this;var i=e.prototype;if(!this.support){var n=tt.getContext(1,1)||{};i.support={nativeDash:"setLineDash"in n||"mozDash"in n,nativeBlendModes:et.nativeModes},tt.release(n)}if(!this.agent){var s=t.navigator.userAgent.toLowerCase(),a=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(s)||[])[0],o="darwin"===a?"mac":a,h=i.agent=i.browser={platform:o};o&&(h[o]=!0),s.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(t,e,i,n,r){if(!h.chrome){var s="opera"===e?n:/^(node|trident)$/.test(e)?r:i;h.version=s,h.versionNumber=parseFloat(s),e="trident"===e?"msie":e,h.name=e,h[e]=!0}}),h.chrome&&delete h.webkit,h.atom&&delete h.chrome}},version:"0.10.2",getView:function(){var t=this.project;return t&&t._view},getPaper:function(){return this},execute:function(t,e){paper.PaperScript.execute(t,this,e),H.updateFocus()},install:function(t){var e=this;r.each(["project","view","tool"],function(i){r.define(t,i,{configurable:!0,get:function(){return e[i]}})});for(var i in this)!/^_/.test(i)&&this[i]&&(t[i]=this[i])},setup:function(t){return paper=this,this.project=new y(t),this},createCanvas:function(t,e){return tt.getCanvas(t,e)},activate:function(){paper=this},clear:function(){for(var t=this.projects,e=this.tools,i=this.palettes,n=t.length-1;n>=0;n--)t[n].remove();for(var n=e.length-1;n>=0;n--)e[n].remove();for(var n=i.length-1;n>=0;n--)i[n].remove()},remove:function(){this.clear(),delete a._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,i){return e[t](i)||e[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),o=r.extend(s,{initialize:function(t){this._scope=paper,this._index=this._scope[this._list].push(this)-1,!t&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];return t&&t!==this&&t.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(r.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),h=r.extend({initialize:function(t){this.precision=r.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,e,i){return this.number(t)+(i||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});h.instance=new h;var l=new function(){function t(t,e,i){return t<e?e:t>i?i:t}function e(t,e,i){function n(t){var e=134217729*t,i=t-e,n=i+e,r=t-n;return[n,r]}var r=e*e-t*i,a=e*e+t*i;if(3*s(r)<a){var o=n(t),h=n(e),l=n(i),u=e*e,c=h[0]*h[0]-u+2*h[0]*h[1]+h[1]*h[1],f=t*i,d=o[0]*l[0]-f+o[0]*l[1]+o[1]*l[0]+o[1]*l[1];r=u-f+(c-d)}return r}function i(){var t=Math.max.apply(Math,arguments);return t&&(t<1e-8||t>1e8)?o(2,-Math.round(h(t))):0}var n=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],r=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],s=Math.abs,a=Math.sqrt,o=Math.pow,h=Math.log2||function(t){return Math.log(t)*Math.LOG2E},u=1e-12,c=1.12e-16;return{TOLERANCE:1e-6,EPSILON:u,MACHINE_EPSILON:c,CURVETIME_EPSILON:4e-7,GEOMETRIC_EPSILON:2e-7,WINDING_EPSILON:2e-7,TRIGONOMETRIC_EPSILON:1e-7,CLIPPING_EPSILON:1e-9,KAPPA:4*(a(2)-1)/3,isZero:function(t){return t>=-u&&t<=u},clamp:t,integrate:function(t,e,i,s){for(var a=n[s-2],o=r[s-2],h=.5*(i-e),l=h+e,u=0,c=s+1>>1,f=1&s?o[u++]*t(l):0;u<c;){var d=h*a[u];f+=o[u++]*(t(l+d)+t(l-d))}return h*f},findRoot:function(t,e,i,n,r,a,o){for(var h=0;h<a;h++){var l=t(i),u=l/e(i),c=i-u;if(s(u)<o)return c;l>0?(r=i,i=c<=n?.5*(n+r):c):(n=i,i=c>=r?.5*(n+r):c)}return i},solveQuadratic:function(n,r,o,h,l,f){var d,_=1/0;if(s(n)<u){if(s(r)<u)return s(o)<u?-1:0;d=-o/r}else{r*=-.5;var g=e(n,r,o);if(g&&s(g)<c){var p=i(s(n),s(r),s(o));p&&(n*=p,r*=p,o*=p,g=e(n,r,o))}if(g>=-c){var v=g<0?0:a(g),m=r+(r<0?-v:v);0===m?(d=o/n,_=-d):(d=m/n,_=o/m)}}var y=0,x=null==l,b=l-u,w=f+u;return isFinite(d)&&(x||d>b&&d<w)&&(h[y++]=x?d:t(d,l,f)),_!==d&&isFinite(_)&&(x||_>b&&_<w)&&(h[y++]=x?_:t(_,l,f)),y},solveCubic:function(e,n,r,h,f,d,_){function g(t){p=t;var i=e*p;v=i+n,m=v*p+r,y=(i+v)*p+m,x=m*p+h}var p,v,m,y,x,b=i(s(e),s(n),s(r),s(h));if(b&&(e*=b,n*=b,r*=b,h*=b),s(e)<u)e=n,v=r,m=h,p=1/0;else if(s(h)<u)v=n,m=r,p=0;else{g(-(n/e)/3);var w=x/e,C=o(s(w),1/3),S=w<0?-1:1,A=-y/e,k=A>0?1.324717957244746*Math.max(C,a(A)):C,M=p-S*k;if(M!==p){do g(M),M=0===y?p:p-x/y/(1+c);while(S*M>S*p);s(e)*p*p>s(h/p)&&(m=-h/p,v=(m-r)/p)}}var P=l.solveQuadratic(e,v,m,f,d,_),E=null==d;return isFinite(p)&&(0===P||P>0&&p!==f[0]&&p!==f[1])&&(E||p>d-u&&p<_+u)&&(f[P++]=E?p:t(p,d,_)),P}}},u={_id:1,_pools:{},get:function(t){if(t){var e=this._pools[t];return e||(e=this._pools[t]={_id:1}),e._id++}return this._id++}},c=r.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var i=typeof t;if("number"===i){var n="number"==typeof e;this.x=t,this.y=n?e:t,this.__read&&(this.__read=n?2:1)}else if("undefined"===i||null===t)this.x=this.y=0,this.__read&&(this.__read=null===t?1:0);else{var r="string"===i?t.split(/[\s,]+/)||[]:t;Array.isArray(r)?(this.x=r[0],this.y=r.length>1?r[1]:r[0]):"x"in r?(this.x=r.x,this.y=r.y):"width"in r?(this.x=r.width,this.y=r.height):"angle"in r?(this.x=r.length,this.y=0,this.setAngle(r.angle)):(this.x=this.y=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1)}},set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new c(this.x,this.y)},toString:function(){var t=h.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this.set(Math.cos(e)*t,Math.sin(e)*t)}else{var i=t/this.getLength();l.isZero(i)&&this.getAngle(),this.set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=c.read(arguments),e=this.getLength()*t.getLength();if(l.isZero(e))return NaN;var i=this.dot(t)/e;return Math.acos(i<-1?-1:i>1?1:i)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this.set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=c.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=c.read(arguments),e=t.x-this.x,i=t.y-this.y,n=e*e+i*i,s=r.read(arguments);return s?n:Math.sqrt(n)},normalize:function(t){t===e&&(t=1);var i=this.getLength(),n=0!==i?t/i:0,r=new c(this.x*n,this.y*n);return n>=0&&(r._angle=this._angle),r},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var i=e?this.subtract(e):this,n=Math.sin(t),r=Math.cos(t);return i=new c(i.x*r-i.y*n,i.x*n+i.y*r),e?i.add(e):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=c.read(arguments);return new c(this.x+t.x,this.y+t.y)},subtract:function(){var t=c.read(arguments);return new c(this.x-t.x,this.y-t.y)},multiply:function(){var t=c.read(arguments);return new c(this.x*t.x,this.y*t.y)},divide:function(){var t=c.read(arguments);return new c(this.x/t.x,this.y/t.y)},modulo:function(){var t=c.read(arguments);return new c(this.x%t.x,this.y%t.y)},negate:function(){return new c(-this.x,-this.y)},isInside:function(){return g.read(arguments).contains(this)},isClose:function(){var t=c.read(arguments),e=r.read(arguments);return this.getDistance(t)<=e},isCollinear:function(){var t=c.read(arguments);return c.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=c.read(arguments);return c.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){return l.isZero(this.x)&&l.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var t=c.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=c.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=c.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new c(t.x*e,t.y*e)},statics:{min:function(){var t=c.read(arguments),e=c.read(arguments);return new c(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=c.read(arguments),e=c.read(arguments);return new c(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new c(Math.random(),Math.random())},isCollinear:function(t,e,i,n){return Math.abs(t*n-e*i)<=1e-7*Math.sqrt((t*t+e*e)*(i*i+n*n))},isOrthogonal:function(t,e,i,n){return Math.abs(t*i+e*n)<=1e-7*Math.sqrt((t*t+e*e)*(i*i+n*n))}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new c(e(this.x),e(this.y))}},{})),f=c.extend({initialize:function(t,e,i,n){this._x=t,this._y=e,this._owner=i,this._setter=n},set:function(t,e,i){return this._x=t,this._y=e,i||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner.changeSelection(this._getSelection(),t)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),d=r.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var i=typeof t;if("number"===i){var n="number"==typeof e;this.width=t,this.height=n?e:t,this.__read&&(this.__read=n?2:1)}else if("undefined"===i||null===t)this.width=this.height=0,this.__read&&(this.__read=null===t?1:0);else{var r="string"===i?t.split(/[\s,]+/)||[]:t;Array.isArray(r)?(this.width=r[0],this.height=r.length>1?r[1]:r[0]):"width"in r?(this.width=r.width,this.height=r.height):"x"in r?(this.width=r.x,this.height=r.y):(this.width=this.height=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1)}},set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new d(this.width,this.height)},toString:function(){var t=h.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=d.read(arguments);return new d(this.width+t.width,this.height+t.height)},subtract:function(){var t=d.read(arguments);return new d(this.width-t.width,this.height-t.height)},multiply:function(){var t=d.read(arguments);return new d(this.width*t.width,this.height*t.height)},divide:function(){var t=d.read(arguments);return new d(this.width/t.width,this.height/t.height)},modulo:function(){var t=d.read(arguments);return new d(this.width%t.width,this.height%t.height)},negate:function(){return new d(-this.width,-this.height)},isZero:function(){return l.isZero(this.width)&&l.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new d(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new d(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new d(Math.random(),Math.random())}}},r.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new d(e(this.width),e(this.height))}},{})),_=d.extend({initialize:function(t,e,i,n){this._width=t,this._height=e,this._owner=i,this._setter=n},set:function(t,e,i){return this._width=t,this._height=e,i||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),g=r.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(t,i,n,s){var a=typeof t,o=0;if("number"===a?(this.x=t,this.y=i,this.width=n,this.height=s,o=4):"undefined"===a||null===t?(this.x=this.y=this.width=this.height=0,o=null===t?1:0):1===arguments.length&&(Array.isArray(t)?(this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3],o=1):t.x!==e||t.width!==e?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,o=1):t.from===e&&t.to===e&&(this.x=this.y=this.width=this.height=0,this._set(t),o=1)),!o){var h=c.readNamed(arguments,"from"),l=r.peek(arguments);if(this.x=h.x,this.y=h.y,l&&l.x!==e||r.hasNamed(arguments,"to")){var u=c.readNamed(arguments,"to");this.width=u.x-h.x,this.height=u.y-h.y,this.width<0&&(this.x=u.x,this.width=-this.width),this.height<0&&(this.y=u.y,this.height=-this.height)}else{var f=d.read(arguments);this.width=f.width,this.height=f.height}o=arguments.__index}this.__read&&(this.__read=o)},set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},clone:function(){return new g(this.x,this.y,this.width,this.height)},equals:function(t){var e=r.isPlainValue(t)?g.read(arguments):t;return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height||!1},toString:function(){var t=h.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){var e=t?c:f;return new e(this.x,this.y,this,"setPoint")},setPoint:function(){var t=c.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){var e=t?d:_;return new e(this.width,this.height,this,"setSize")},setSize:function(){var t=d.read(arguments);this._fixX&&(this.x+=(this.width-t.width)*this._fixX),this._fixY&&(this.y+=(this.height-t.height)*this._fixY),this.width=t.width,this.height=t.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(t){this._fixW||(this.width-=t-this.x),this.x=t,this._fixX=0},getTop:function(){return this.y},setTop:function(t){this._fixH||(this.height-=t-this.y),this.y=t,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(t){this._fixX!==e&&1!==this._fixX&&(this._fixW=0),this._fixW?this.x=t-this.width:this.width=t-this.x,this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(t){this._fixY!==e&&1!==this._fixY&&(this._fixH=0),this._fixH?this.y=t-this.height:this.height=t-this.y,this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(t){this.x=t-.5*this.width,this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(t){this.y=t-.5*this.height,this._fixY=.5},getCenter:function(t){var e=t?c:f;return new e(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=c.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&t.width!==e||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(g.read(arguments)):this._containsPoint(c.read(arguments))},_containsPoint:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=g.read(arguments);return t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x+this.width&&t.y<this.y+this.height},touches:function(){var t=g.read(arguments);return t.x+t.width>=this.x&&t.y+t.height>=this.y&&t.x<=this.x+this.width&&t.y<=this.y+this.height},intersect:function(){var t=g.read(arguments),e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new g(e,i,n-e,r-i)},unite:function(){var t=g.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new g(e,i,n-e,r-i)},include:function(){var t=c.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new g(e,i,n-e,r-i)},expand:function(){var t=d.read(arguments),e=t.width,i=t.height;return new g(this.x-e/2,this.y-i/2,this.width+e,this.height+i)},scale:function(t,i){return this.expand(this.width*t-this.width,this.height*(i===e?t:i)-this.height)}},r.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var i=t.join(""),n=/^[RL]/.test(i);e>=4&&(t[1]+=n?"Y":"X");var r=t[n?0:1],s=t[n?1:0],a="get"+r,o="get"+s,h="set"+r,l="set"+s,u="get"+i,d="set"+i;this[u]=function(t){var e=t?c:f;return new e(this[a](),this[o](),this,d)},this[d]=function(){var t=c.read(arguments);this[h](t.x),this[l](t.y)}},{beans:!0})),p=g.extend({initialize:function(t,e,i,n,r,s){this.set(t,e,i,n,!0),this._owner=r,this._setter=s},set:function(t,e,i,n,r){return this._x=t,this._y=e,this._width=i,this._height=n,r||this._owner[this._setter](this),this}},new function(){var t=g.prototype;return r.each(["x","y","width","height"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._dontNotify||this._owner[this._setter](this)}},r.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var i="set"+e;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var e=this._owner;e.changeSelection&&e.changeSelection(2,t)}}))}),v=r.extend({_class:"Matrix",initialize:function t(e){var i=arguments.length,n=!0;if(6===i?this.set.apply(this,arguments):1===i?e instanceof t?this.set(e._a,e._b,e._c,e._d,e._tx,e._ty):Array.isArray(e)?this.set.apply(this,e):n=!1:0===i?this.reset():n=!1,!n)throw new Error("Unsupported matrix parameters")},set:function(t,e,i,n,r,s,a){return this._a=t,this._b=e,this._c=i,this._d=n,this._tx=r,this._ty=s,a||this._changed(),this},_serialize:function(t,e){return r.serialize(this.getValues(),t,!0,e)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(9))},clone:function(){return new v(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=h.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,e){var i=this._owner;return!!i&&(i.transform(null,!0,r.pick(t,!0),e),this.isIdentity())},translate:function(){var t=c.read(arguments),e=t.x,i=t.y;return this._tx+=e*this._a+i*this._c,
this._ty+=e*this._b+i*this._d,this._changed(),this},scale:function(){var t=c.read(arguments),e=c.read(arguments,0,{readNull:!0});return e&&this.translate(e),this._a*=t.x,this._b*=t.x,this._c*=t.y,this._d*=t.y,e&&this.translate(e.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=c.read(arguments,1),i=e.x,n=e.y,r=Math.cos(t),s=Math.sin(t),a=i-i*r+n*s,o=n-i*s-n*r,h=this._a,l=this._b,u=this._c,f=this._d;return this._a=r*h+s*u,this._b=r*l+s*f,this._c=-s*h+r*u,this._d=-s*l+r*f,this._tx+=a*h+o*u,this._ty+=a*l+o*f,this._changed(),this},shear:function(){var t=c.read(arguments),e=c.read(arguments,0,{readNull:!0});e&&this.translate(e);var i=this._a,n=this._b;return this._a+=t.y*this._c,this._b+=t.y*this._d,this._c+=t.x*i,this._d+=t.x*n,e&&this.translate(e.negate()),this._changed(),this},skew:function(){var t=c.read(arguments),e=c.read(arguments,0,{readNull:!0}),i=Math.PI/180,n=new c(Math.tan(t.x*i),Math.tan(t.y*i));return this.shear(n,e)},append:function(t){if(t){var e=this._a,i=this._b,n=this._c,r=this._d,s=t._a,a=t._c,o=t._b,h=t._d,l=t._tx,u=t._ty;this._a=s*e+o*n,this._c=a*e+h*n,this._b=s*i+o*r,this._d=a*i+h*r,this._tx+=l*e+u*n,this._ty+=l*i+u*r,this._changed()}return this},prepend:function(t){if(t){var e=this._a,i=this._b,n=this._c,r=this._d,s=this._tx,a=this._ty,o=t._a,h=t._c,l=t._b,u=t._d,c=t._tx,f=t._ty;this._a=o*e+h*i,this._c=o*n+h*r,this._b=l*e+u*i,this._d=l*n+u*r,this._tx=o*s+h*a+c,this._ty=l*s+u*a+f,this._changed()}return this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,e=this._b,i=this._c,n=this._d,r=this._tx,s=this._ty,a=t*n-e*i,o=null;return a&&!isNaN(a)&&isFinite(r)&&isFinite(s)&&(this._a=n/a,this._b=-e/a,this._c=-i/a,this._d=t/a,this._tx=(i*s-n*r)/a,this._ty=(e*r-t*s)/a,o=this),o},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new v(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,e,i){return arguments.length<3?this._transformPoint(c.read(arguments)):this._transformCoordinates(t,e,i)},_transformPoint:function(t,e,i){var n=t.x,r=t.y;return e||(e=new c),e.set(n*this._a+r*this._c+this._tx,n*this._b+r*this._d+this._ty,i)},_transformCoordinates:function(t,e,i){for(var n=0,r=2*i;n<r;n+=2){var s=t[n],a=t[n+1];e[n]=s*this._a+a*this._c+this._tx,e[n+1]=s*this._b+a*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,i=t.y,n=e+t.width,r=i+t.height,s=[e,i,n,i,n,r,e,r];return this._transformCoordinates(s,s,4)},_transformBounds:function(t,e,i){for(var n=this._transformCorners(t),r=n.slice(0,2),s=r.slice(),a=2;a<8;a++){var o=n[a],h=1&a;o<r[h]?r[h]=o:o>s[h]&&(s[h]=o)}return e||(e=new g),e.set(r[0],r[1],s[0]-r[0],s[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(c.read(arguments))},_inverseTransform:function(t,e,i){var n=this._a,r=this._b,s=this._c,a=this._d,o=this._tx,h=this._ty,l=n*a-r*s,u=null;if(l&&!isNaN(l)&&isFinite(o)&&isFinite(h)){var f=t.x-this._tx,d=t.y-this._ty;e||(e=new c),u=e.set((f*a-d*s)/l,(d*n-f*r)/l,i)}return u},decompose:function(){var t,e,i,n=this._a,r=this._b,s=this._c,a=this._d,o=n*a-r*s,h=Math.sqrt,l=Math.atan2,u=180/Math.PI;if(0!==n||0!==r){var f=h(n*n+r*r);t=Math.acos(n/f)*(r>0?1:-1),e=[f,o/f],i=[l(n*s+r*a,f*f),0]}else if(0!==s||0!==a){var d=h(s*s+a*a);t=Math.asin(s/d)*(a>0?1:-1),e=[o/d,d],i=[0,l(n*s+r*a,d*d)]}else t=0,i=e=[0,0];return{translation:this.getTranslation(),rotation:t*u,scaling:new c(e),skewing:new c(i[0]*u,i[1]*u)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new c(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},r.each(["a","b","c","d","tx","ty"],function(t){var e=r.capitalize(t),i="_"+t;this["get"+e]=function(){return this[i]},this["set"+e]=function(t){this[i]=t,this._changed()}},{})),m=r.extend({_class:"Line",initialize:function(t,e,i,n,r){var s=!1;arguments.length>=4?(this._px=t,this._py=e,this._vx=i,this._vy=n,s=r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,s=i),s||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new c(this._px,this._py)},getVector:function(){return new c(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return m.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return m.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(m.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0))},isCollinear:function(t){return c.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return c.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,i,n,r,s,a,o,h,u){h||(i-=t,n-=e,a-=r,o-=s);var f=i*o-n*a;if(!l.isZero(f)){var d=t-r,_=e-s,g=(a*_-o*d)/f,p=(i*_-n*d)/f,v=1e-12,m=-v,y=1+v;if(u||m<g&&g<y&&m<p&&p<y)return u||(g=g<=0?0:g>=1?1:g),new c(t+g*i,e+g*n)}},getSide:function(t,e,i,n,r,s,a,o){a||(i-=t,n-=e);var h=r-t,l=s-e,u=h*n-l*i;return 0!==u||o||(u=(h*i+h*i)/(i*i+n*n),u>=0&&u<=1&&(u=0)),u<0?-1:u>0?1:0},getSignedDistance:function(t,e,i,n,r,s,a){return a||(i-=t,n-=e),0===i?n>0?r-t:t-r:0===n?i<0?s-e:e-s:((r-t)*n-(s-e)*i)/Math.sqrt(i*i+n*n)}}}),y=o.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(t){o.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new U(null,null,this),this._view=H.create(this,t||tt.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(t,e){return r.serialize(this._children,t,!0,e)},_changed:function(t,e){if(1&t){var i=this._view;i&&(i._needsUpdate=!0,!i._requested&&i._autoUpdate&&i.requestUpdate())}var n=this._changes;if(n&&e){var r=this._changesById,s=e._id,a=r[s];a?a.flags|=t:n.push(r[s]={item:e,flags:t})}},clear:function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e].remove()},isEmpty:function(){return 0===this._children.length},remove:function t(){return!!t.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.initialize(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new w({project:this,insert:!0})},getSymbolDefinitions:function(){var t=[],e={};return this.getItems({class:A,match:function(i){var n=i._definition,r=n._id;return e[r]||(e[r]=!0,t.push(n)),!1}}),t},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var t=this._selectionItems,e=[];for(var i in t){var n=t[i],r=n._selection;1&r&&n.isInserted()?e.push(n):r||this._updateSelection(n)}return e},_updateSelection:function(t){var e=t._id,i=this._selectionItems;t._selection?i[e]!==t&&(this._selectionCount++,i[e]=t):i[e]===t&&(this._selectionCount--,delete i[e])},selectAll:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t=this._selectionItems;for(var e in t)t[e].setFullySelected(!1)},addLayer:function(t){return this.insertLayer(e,t)},insertLayer:function(t,e){if(e instanceof w){e._remove(!1,!0),r.splice(this._children,[e],t,0),e._setProject(this,!0);var i=e._name;i&&e.setName(i),this._changes&&e._changed(5),this._activeLayer||(this._activeLayer=e)}else e=null;return e},_insertItem:function(t,i,n,r){return i=this.insertLayer(t,i)||(this._activeLayer||this._insertItem(e,new w(x.NO_INSERT),!0,!0)).insertChild(t,i,n),r&&i.activate&&i.activate(),i},getItems:function(t){return x._getItems(this,t)},getItem:function(t){return x._getItems(this,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var e=this._activeLayer;return r.importJSON(t,e&&e.isEmpty()&&e)},removeOn:function(t){var e=this._removeSets;if(e){"mouseup"===t&&(e.mousedrag=null);var i=e[t];if(i){for(var n in i){var r=i[n];for(var s in e){var a=e[s];a&&a!=i&&delete a[r._id]}r.remove()}e[t]=null}}},draw:function(t,e,i){this._updateVersion++,t.save(),e.applyToContext(t);for(var n=this._children,s=new r({offset:new c(0,0),pixelRatio:i,viewMatrix:e.isIdentity()?null:e,matrices:[new v],updateMatrix:!0}),a=0,o=n.length;a<o;a++)n[a].draw(t,s);if(t.restore(),this._selectionCount>0){t.save(),t.strokeWidth=1;var h=this._selectionItems,l=this._scope.settings.handleSize,u=this._updateVersion;for(var f in h)h[f]._drawSelection(t,e,l,h,u);t.restore()}}}),x=r.extend(s,{statics:{extend:function t(e){return e._serializeFields&&(e._serializeFields=r.set({},this.prototype._serializeFields,e._serializeFields)),t.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new v,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}}},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return r.each(t,function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function(){},_initialize:function(t,i){var n=t&&r.isPlainObject(t),s=n&&t.internal===!0,a=this._matrix=new v,o=n&&t.project||paper.project,h=paper.settings;return this._id=s?null:u.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&h.applyMatrix,i&&a.translate(i),a._owner=this,this._style=new U(o._currentStyle,this,o),s||n&&t.insert===!1||!h.insertItems&&(!n||t.insert!==!0)?this._setProject(o):(n&&t.parent||o)._insertItem(e,this,!0,!0),n&&t!==x.NO_INSERT&&r.filter(this,t,{internal:!0,insert:!0,project:!0,parent:!0}),n},_serialize:function(t,e){function i(i){for(var a in i){var o=s[a];r.equals(o,"leading"===a?1.2*i.fontSize:i[a])||(n[a]=r.serialize(o,t,"data"!==a,e))}}var n={},s=this;return i(this._serializeFields),this instanceof b||i(this._style._defaults),[this._class,n]},_changed:function(t){var i=this._symbol,n=this._parent||i,r=this._project;8&t&&(this._bounds=this._position=this._decomposed=this._globalMatrix=e),n&&40&t&&x._clearBoundsCache(n),2&t&&x._clearBoundsCache(this),r&&r._changed(t,this),i&&i._changed(t)},set:function(t){return t&&this._set(t),this},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var i=this._getOwner();if(t&&i){var n=i._children,r=i._namedChildren;(r[t]=r[t]||[]).push(this),t in n||(n[t]=this)}this._name=t||e,this._changed(128)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},r.each(["locked","visible","blendMode","opacity","guide"],function(t){var e=r.capitalize(t),t="_"+t;this["get"+e]=function(){return this[t]},this["set"+e]=function(e){e!=this[t]&&(this[t]=e,this._changed("_locked"===t?128:129))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(t){if(t!==this._selection){this._selection=t;var e=this._project;e&&(e._updateSelection(this),this._changed(129))}},changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,i=t.length;e<i;e++)if(t[e].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var e=this._children,i=0,n=e.length;i<n;i++)e[i].setSelected(t);this.changeSelection(1,t)},isFullySelected:function(){var t=this._children,e=!!(1&this._selection);if(t&&e){for(var i=0,n=t.length;i<n;i++)if(!t[i].isFullySelected())return!1;return!0}return e},setFullySelected:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++)e[i].setFullySelected(t);this.changeSelection(1,t)},isClipMask:function(){return this._clipMask},setClipMask:function(t){this._clipMask!=(t=!!t)&&(this._clipMask=t,t&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var e=this._position,i=t?c:f;if(!e){var n=this._pivot;e=this._position=n?this._matrix._transformPoint(n):this.getBounds().getCenter(!0)}return new i(e.x,e.y,this,"setPosition")},setPosition:function(){this.translate(c.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(t){var e=this._pivot;if(e){var i=t?c:f;e=new i(e.x,e.y,this,"setPivot")}return e},setPivot:function(){this._pivot=c.read(arguments,0,{clone:!0,readNull:!0}),this._position=e}},r.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(t,e){this[e]=function(e){return this.getBounds(e,t)}},{beans:!0,getBounds:function(t,e){var i=e||t instanceof v,n=r.set({},i?e:t,this._boundsOptions);n.stroke&&!this.getStrokeScaling()||(n.cacheItem=this);var s=this._getCachedBounds(i&&t,n);return 0===arguments.length?new p(s.x,s.y,s.width,s.height,this,"setBounds"):s},setBounds:function(){var t=g.read(arguments),e=this.getBounds(),i=this._matrix,n=new v,r=t.getCenter();n.translate(r),t.width==e.width&&t.height==e.height||(i.isInvertible()||(i.initialize(i._backup||(new v).translate(i.getTranslation())),e=this.getBounds()),n.scale(0!==e.width?t.width/e.width:0,0!==e.height?t.height/e.height:0)),r=e.getCenter(),n.translate(-r.x,-r.y),this.transform(n)},_getBounds:function(t,e){var i=this._children;return i&&0!==i.length?(x._updateBoundsCache(this,e.cacheItem),x._getBounds(i,t,e)):new g},_getCachedBounds:function(t,e){t=t&&t._orNullIfIdentity();var i=e.internal,n=e.cacheItem,r=i?null:this._matrix._orNullIfIdentity(),s=n&&(!t||t.equals(r))&&[e.stroke?1:0,e.handle?1:0,i?1:0].join("");if(x._updateBoundsCache(this._parent||this._symbol,n),s&&this._bounds&&s in this._bounds)return this._bounds[s].rect.clone();var a=this._getBounds(t||r,e);if(s){this._bounds||(this._bounds={});this._bounds[s]={rect:a.clone(),internal:e.internal}}return a},_getStrokeMatrix:function(t,e){var i=this.getStrokeScaling()?null:e&&e.internal?this:this._parent||this._symbol&&this._symbol._item,n=i?i.getViewMatrix().invert():t;return n&&n._shiftless()},statics:{_updateBoundsCache:function(t,e){if(t&&e){var i=e._id,n=t._boundsCache=t._boundsCache||{ids:{},list:[]};n.ids[i]||(n.list.push(e),n.ids[i]=e)}},_clearBoundsCache:function(t){var i=t._boundsCache;if(i){t._bounds=t._position=t._boundsCache=e;for(var n=0,r=i.list,s=r.length;n<s;n++){var a=r[n];a!==t&&(a._bounds=a._position=e,a._boundsCache&&x._clearBoundsCache(a))}}},_getBounds:function(t,e,i){var n=1/0,r=-n,s=n,a=r;i=i||{};for(var o=0,h=t.length;o<h;o++){var l=t[o];if(l._visible&&!l.isEmpty()){var u=l._getCachedBounds(e&&e.appended(l._matrix),i);n=Math.min(u.x,n),s=Math.min(u.y,s),r=Math.max(u.x+u.width,r),a=Math.max(u.y+u.height,a)}}return isFinite(n)?new g(n,s,r-n,a-s):new g}}}),{beans:!0,_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();null!=e&&null!=t&&this.rotate(t-e)},getScaling:function(t){var e=this._decompose(),i=e&&e.scaling,n=t?c:f;return i&&new n(i.x,i.y,this,"setScaling")},setScaling:function(){var t=this.getScaling(),e=c.read(arguments,0,{clone:!0,readNull:!0});t&&e&&this.scale(e.x/t.x,e.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},getGlobalMatrix:function(t){var e=this._globalMatrix,i=this._project._updateVersion;if(e&&e._updateVersion!==i&&(e=null),!e){e=this._globalMatrix=this._matrix.clone();var n=this._parent;n&&e.prepend(n.getGlobalMatrix(!0)),e._updateVersion=i}return t?e:e.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function t(e){t.base.call(this,e);for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._installEvents(e)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof w)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t,e){this.removeChildren(),this.addChildren(t,e)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return r.equals(this._children,t._children)},clone:function(t){var i=new this.constructor(x.NO_INSERT),n=this._children,s=r.pick(t?t.insert:e,t===e||t===!0),a=r.pick(t?t.deep:e,!0);n&&i.copyAttributes(this),n&&!a||i.copyContent(this),n||i.copyAttributes(this),s&&i.insertAbove(this);var o=this._name,h=this._parent;if(o&&h){for(var n=h._children,l=o,u=1;n[o];)o=l+" "+u++;o!==l&&i.setName(o)}return i},copyContent:function(t){for(var e=t._children,i=0,n=e&&e.length;i<n;i++)this.addChild(e[i].clone(!1),!0)},copyAttributes:function(t,e){this.setStyle(t._style);for(var i=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],n=0,s=i.length;n<s;n++){var a=i[n];t.hasOwnProperty(a)&&(this[a]=t[a])}e||this._matrix.initialize(t._matrix),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var o=t._data,h=t._name;this._data=o?r.clone(o):null,h&&this.setName(h)},rasterize:function(t,i){var n=this.getStrokeBounds(),s=(t||this.getView().getResolution())/72,a=n.getTopLeft().floor(),o=n.getBottomRight().ceil(),h=new d(o.subtract(a)),l=new S(x.NO_INSERT);if(!h.isZero()){var u=tt.getCanvas(h.multiply(s)),c=u.getContext("2d"),f=(new v).scale(s).translate(a.negate());c.save(),f.applyToContext(c),this.draw(c,new r({matrices:[f]})),c.restore(),l.setCanvas(u)}return l.transform((new v).translate(a.add(h.divide(2))).scale(1/s)),(i===e||i)&&l.insertAbove(this),l},contains:function(){return!!this._contains(this._matrix._inverseTransform(c.read(arguments)))},_contains:function(t){var e=this._children;if(e){for(var i=e.length-1;i>=0;i--)if(e[i].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return g.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new F.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof x&&this._asPathItem().getIntersections(t._asPathItem(),null,e,!0).length>0}},new function(){function t(){return this._hitTest(c.read(arguments),M.getOptions(arguments))}function e(){var t=c.read(arguments),e=M.getOptions(arguments),i=e.match,n=[];return e=r.set({},e,{match:function(t){i&&!i(t)||n.push(t)}}),this._hitTest(t,e),n}function i(t,e,i,n){var r=this._children;if(r)for(var s=r.length-1;s>=0;s--){var a=r[s],o=a!==n&&a._hitTest(t,e,i);if(o)return o}return null}return y.inject({hitTest:t,hitTestAll:e,_hitTest:i}),{hitTest:t,hitTestAll:e,_hitTestChildren:i}},{_hitTest:function(t,e,i){function n(t){return!g||t&&g(t)?t:null}function s(e,i){var n=c["get"+i]();if(t.subtract(n).divide(u).length<=1)return new M(e,p,{name:r.hyphenate(i),point:n})}if(this._locked||!this._visible||this._guide&&!e.guides||this.isEmpty())return null;var a=this._matrix,o=i?i.appended(a):this.getGlobalMatrix().prepend(this.getView()._matrix),h=this.getStrokeScaling()?null:o.inverted()._shiftless(),l=Math.max(e.tolerance,1e-6),u=e._tolerancePadding=new d(F._getStrokePadding(l,h));if(t=a._inverseTransform(t),!t||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(u.multiply(2))._containsPoint(t))return null;var c,f,_=!(e.guides&&!this._guide||e.selected&&!this.isSelected()||e.type&&e.type!==r.hyphenate(this._class)||e.class&&!(this instanceof e.class)),g=e.match,p=this;if(_&&(e.center||e.bounds)&&this._parent){if(c=this.getInternalBounds(),e.center&&(f=s("center","Center")),!f&&e.bounds)for(var v=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],m=0;m<8&&!f;m++)f=s("bounds",v[m]);f=n(f)}return f||(f=this._hitTestChildren(t,e,o)||_&&n(this._hitTestSelf(t,e,o,h))||null),f&&f.point&&(f.point=a.transform(f.point)),f},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new M("fill",this)},matches:function(t,e){function i(t,e){for(var n in t)if(t.hasOwnProperty(n)){var s=t[n],a=e[n];if(r.isPlainObject(s)&&r.isPlainObject(a)){if(!i(s,a))return!1}else if(!r.equals(s,a))return!1}return!0}var n=typeof t;if("object"===n){for(var s in t)if(t.hasOwnProperty(s)&&!this.matches(s,t[s]))return!1;return!0}if("function"===n)return t(this);if("match"===t)return e(this);var a=/^(empty|editable)$/.test(t)?this["is"+r.capitalize(t)]():"type"===t?r.hyphenate(this._class):this[t];if("class"===t){if("function"==typeof e)return this instanceof e;a=this._class}if("function"==typeof e)return!!e(a);if(e){if(e.test)return e.test(a);if(r.isPlainObject(e))return i(e,a)}return r.equals(a,e)},getItems:function(t){return x._getItems(this,t,this._matrix)},getItem:function(t){return x._getItems(this,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function t(e,i,n,s,a){if(!s){var o="object"==typeof i&&i,h=o&&o.overlapping,l=o&&o.inside,u=h||l,c=u&&g.read([u]);s={items:[],recursive:o&&o.recursive!==!1,inside:!!l,overlapping:!!h,rect:c,path:h&&new F.Rectangle({rectangle:c,insert:!1})},o&&(i=r.filter({},i,{recursive:!0,inside:!0,overlapping:!0}))}var f=e._children,d=s.items,c=s.rect;n=c&&(n||new v);for(var _=0,p=f&&f.length;_<p;_++){var m=f[_],y=n&&n.appended(m._matrix),x=!0;if(c){var u=m.getBounds(y);if(!c.intersects(u))continue;c.contains(u)||s.overlapping&&(u.contains(c)||s.path.intersects(m,y))||(x=!1)}if(x&&m.matches(i)&&(d.push(m),a))break;if(s.recursive!==!1&&t(m,i,y,s,a),a&&d.length>0)break}return d}}},{importJSON:function(t){var e=r.importJSON(t,this);return e!==this?this.addChild(e):e},addChild:function(t,i){return this.insertChild(e,t,i)},insertChild:function(t,e,i){var n=e?this.insertChildren(t,[e],i):null;return n&&n[0]},addChildren:function(t,e){return this.insertChildren(this._children.length,t,e)},insertChildren:function(t,e,i,n){var s=this._children;if(s&&e&&e.length>0){e=Array.prototype.slice.apply(e);for(var a=e.length-1;a>=0;a--){var o=e[a];o&&(!n||o instanceof n)?o._remove(!1,!0):e.splice(a,1)}r.splice(s,e,t,0);for(var h=this._project,l=h._changes,a=0,u=e.length;a<u;a++){var o=e[a],c=o._name;o._parent=this,o._setProject(h,!0),c&&o.setName(c),l&&this._changed(5)}this._changed(11)}else e=null;return e},_insertItem:"#insertChild",_insertAt:function(t,e,i){var n=this;if(n!==t){var r=t&&t._getOwner();r?(n._remove(!1,!0),r._insertItem(t._index+e,n,i)):n=null}return n},insertAbove:function(t,e){return this._insertAt(t,1,e)},insertBelow:function(t,e){return this._insertAt(t,0,e)},sendToBack:function(){var t=this._getOwner();return t?t._insertItem(0,this):null},bringToFront:function(){var t=this._getOwner();return t?t._insertItem(e,this):null},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",copyTo:function(t){return t._insertItem(e,this.clone(!1))},reduce:function(t){var e=this._children;if(e&&1===e.length){var i=e[0].reduce(t);return this._parent?(i.insertAbove(this),this.remove()):i.remove(),i}return this},_removeNamed:function(){var t=this._getOwner();if(t){var e=t._children,i=t._namedChildren,n=this._name,r=i[n],s=r?r.indexOf(this):-1;s!==-1&&(e[n]==this&&delete e[n],r.splice(s,1),r.length?e[n]=r[0]:delete i[n])}},_remove:function(t,e){var i=this._getOwner(),n=this._project,s=this._index;return!!i&&(null!=s&&(n._activeLayer===this&&(n._activeLayer=this.getNextSibling()||this.getPreviousSibling()),r.splice(i._children,null,s,1)),this._name&&this._removeNamed(),this._installEvents(!1),t&&n._changes&&this._changed(5),e&&i._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,e){if(!this._children)return null;t=t||0,e=r.pick(e,this._children.length);for(var i=r.splice(this._children,null,t,e-t),n=i.length-1;n>=0;n--)i[n]._remove(!0,!1);return i.length>0&&this._changed(11),i},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){return!this._children||0===this._children.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){var e=[];do e.unshift(t);while(t=t._parent);return e}for(var i=e(this),n=e(t),r=0,s=Math.min(i.length,n.length);r<s;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(t){return this._getOrder(t)===-1},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e===t)return!0;return!1},isAncestor:function(t){return!!t&&t.isDescendant(this)},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:c).read(arguments),n=c.read(arguments,0,{readNull:!0});return this.transform((new v)[t](i,n||this.getPosition(!0)))}},{translate:function(){var t=new v;return this.transform(t.translate.apply(t,arguments))},transform:function(t,e,i,n){t&&t.isIdentity()&&(t=null);var r=this._matrix,s=(e||this._applyMatrix)&&(!r.isIdentity()||t||e&&i&&this._children);if(!t&&!s)return this;if(t&&(!t.isInvertible()&&r.isInvertible()&&(r._backup=r.getValues()),r.prepend(t)),s=s&&this._transformContent(r,i,n)){var a=this._pivot,o=this._style,h=o.getFillColor(!0),l=o.getStrokeColor(!0);a&&r._transformPoint(a,a,!0),h&&h.transform(r),l&&l.transform(r),r.reset(!0),n&&this._canApplyMatrix&&(this._applyMatrix=!0)}var u=this._bounds,c=this._position;this._changed(9);var f=u&&t&&t.decompose();if(f&&!f.shearing&&f.rotation%90===0){for(var d in u){var _=u[d];if(s||!_.internal){var g=_.rect;t._transformBounds(g,g)}}var p=this._boundsGetter,g=u[p&&p.getBounds||p||"getBounds"];g&&(this._position=g.getCenter(!0)),this._bounds=u}else t&&c&&(this._position=t._transformPoint(c,c));return this},_transformContent:function(t,e,i){var n=this._children;if(n){for(var r=0,s=n.length;r<s;r++)n[r].transform(t,!0,e,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(c.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(c.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(c.read(arguments))},localToParent:function(){return this._matrix._transformPoint(c.read(arguments))},fitBounds:function(t,e){t=g.read(arguments);var i=this.getBounds(),n=i.height/i.width,r=t.height/t.width,s=(e?n>r:n<r)?t.width/i.width:t.height/i.height,a=new g(new c,new d(i.width*s,i.height*s));a.setCenter(t.getCenter()),this.setBounds(a)}}),{_setStyles:function(t,e,i){var n=this._style;if(n.hasFill()&&(t.fillStyle=n.getFillColor().toCanvasStyle(t)),n.hasStroke()){t.strokeStyle=n.getStrokeColor().toCanvasStyle(t),t.lineWidth=n.getStrokeWidth();var r=n.getStrokeJoin(),s=n.getStrokeCap(),a=n.getMiterLimit();if(r&&(t.lineJoin=r),s&&(t.lineCap=s),a&&(t.miterLimit=a),paper.support.nativeDash){var o=n.getDashArray(),h=n.getDashOffset();o&&o.length&&("setLineDash"in t?(t.setLineDash(o),t.lineDashOffset=h):(t.mozDash=o,t.mozDashOffset=h))}}if(n.hasShadow()){var l=e.pixelRatio||1,u=i._shiftless().prepend((new v).scale(l,l)),f=u.transform(new c(n.getShadowBlur(),0)),d=u.transform(this.getShadowOffset());t.shadowColor=n.getShadowColor().toCanvasStyle(t),t.shadowBlur=f.getLength(),t.shadowOffsetX=d.x,t.shadowOffsetY=d.y}},draw:function(t,e,i){var n=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var r=e.matrices,s=e.viewMatrix,a=this._matrix,o=r[r.length-1].appended(a);if(o.isInvertible()){s=s?s.appended(o):o,r.push(o),e.updateMatrix&&(o._updateVersion=n,this._globalMatrix=o);var h,l,u,c=this._blendMode,f=this._opacity,d="normal"===c,_=et.nativeModes[c],g=d&&1===f||e.dontStart||e.clip||(_||d&&f<1)&&this._canComposite(),p=e.pixelRatio||1;if(!g){var v=this.getStrokeBounds(s);if(!v.width||!v.height)return;u=e.offset,l=e.offset=v.getTopLeft().floor(),h=t,t=tt.getContext(v.getSize().ceil().add(1).multiply(p)),1!==p&&t.scale(p,p)}t.save();var m=i?i.appended(a):this._canScaleStroke&&!this.getStrokeScaling(!0)&&s,y=!g&&e.clipItem,x=!m||y;if(g?(t.globalAlpha=f,_&&(t.globalCompositeOperation=c)):x&&t.translate(-l.x,-l.y),x&&(g?a:s).applyToContext(t),y&&e.clipItem.draw(t,e.extend({clip:!0})),m){t.setTransform(p,0,0,p,0,0);var b=e.offset;b&&t.translate(-b.x,-b.y)}this._draw(t,e,s,m),t.restore(),r.pop(),e.clip&&!e.dontFinish&&t.clip(),g||(et.process(c,t,h,f,l.subtract(u).multiply(p)),tt.release(t),e.offset=u)}}},_isUpdated:function(t){var e=this._parent;if(e instanceof q)return e._isUpdated(t);var i=this._updateVersion===t;return!i&&e&&e._visible&&e._isUpdated(t)&&(this._updateVersion=t,i=!0),i},_drawSelection:function(t,e,i,n,r){var s=this._selection,a=1&s,o=2&s||a&&this._selectBounds,h=4&s;if(this._drawSelected||(a=!1),
(a||o||h)&&this._isUpdated(r)){var l,u=this.getSelectedColor(!0)||(l=this.getLayer())&&l.getSelectedColor(!0),c=e.appended(this.getGlobalMatrix(!0)),f=i/2;if(t.strokeStyle=t.fillStyle=u?u.toCanvasStyle(t):"#009dec",a&&this._drawSelected(t,c,n),h){var d=this.getPosition(!0),_=d.x,g=d.y;t.beginPath(),t.arc(_,g,f,0,2*Math.PI,!0),t.stroke();for(var p=[[0,-1],[1,0],[0,1],[-1,0]],v=f,m=i+1,y=0;y<4;y++){var x=p[y],b=x[0],w=x[1];t.moveTo(_+b*v,g+w*v),t.lineTo(_+b*m,g+w*m),t.stroke()}}if(o){var C=c._transformCorners(this.getInternalBounds());t.beginPath();for(var y=0;y<8;y++)t[0===y?"moveTo":"lineTo"](C[y],C[++y]);t.closePath(),t.stroke();for(var y=0;y<8;y++)t.fillRect(C[y]-f,C[++y]-f,i,i)}}},_canComposite:function(){return!1}},r.each(["down","drag","up","move"],function(t){this["removeOn"+r.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var e in t)if(t[e]){var i="mouse"+e,n=this._project,r=n._removeSets=n._removeSets||{};r[i]=r[i]||{},r[i][this._id]=this}return this}})),b=x.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function t(i){t.base.call(this,i),1026&i&&(this._clipItem=e)},_getClipItem:function(){var t=this._clipItem;if(t===e){t=null;for(var i=this._children,n=0,r=i.length;n<r;n++)if(i[n]._clipMask){t=i[n];break}this._clipItem=t}return t},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();e&&e.setClipMask(t)},_getBounds:function t(e,i){var n=this._getClipItem();return n?n._getCachedBounds(e&&e.appended(n._matrix),r.set({},i,{stroke:!1})):t.base.call(this,e,i)},_hitTestChildren:function t(e,i,n){var r=this._getClipItem();return(!r||r.contains(e))&&t.base.call(this,e,i,n,r)},_draw:function(t,e){var i=e.clip,n=!i&&this._getClipItem();e=e.extend({clipItem:n,clip:!1}),i?(t.beginPath(),e.dontStart=e.dontFinish=!0):n&&n.draw(t,e.extend({clip:!0}));for(var r=this._children,s=0,a=r.length;s<a;s++){var o=r[s];o!==n&&o.draw(t,e)}}}),w=b.extend({_class:"Layer",initialize:function(){b.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function t(){return this._parent?t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),C=x.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t){this._initialize(t)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&r.equals(this._radius,t._radius)},copyContent:function(t){this.setType(t._type),this.setSize(t._size),this.setRadius(t._radius)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new _(t.width,t.height,this,"setSize")},setSize:function(){var t=d.read(arguments);if(this._size){if(!this._size.equals(t)){var e=this._type,i=t.width,n=t.height;if("rectangle"===e){var r=d.min(this._radius,t.divide(2));this._radius.set(r.width,r.height)}else"circle"===e?(i=n=(i+n)/2,this._radius=i/2):"ellipse"===e&&this._radius.set(i/2,n/2);this._size.set(i,n),this._changed(9)}}else this._size=t.clone()},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new _(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;var i=2*t;this._radius=t,this._size.set(i,i)}else if(t=d.read(arguments),this._radius){if(this._radius.equals(t))return;if(this._radius.set(t.width,t.height),"rectangle"===e){var i=d.max(this._size,t.multiply(2));this._size.set(i.width,i.height)}else"ellipse"===e&&this._size.set(2*t.width,2*t.height)}else this._radius=t.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var i=new(F[r.capitalize(this._type)])({center:new c,size:this._size,radius:this._radius,insert:!1});return i.copyAttributes(this),paper.settings.applyMatrix&&i.setApplyMatrix(!0),(t===e||t)&&i.insertAbove(this),i},toShape:"#clone",_draw:function(t,e,i,n){var r=this._style,s=r.hasFill(),a=r.hasStroke(),o=e.dontFinish||e.clip,h=!n;if(s||a||o){var l=this._type,u=this._radius,c="circle"===l;if(e.dontStart||t.beginPath(),h&&c)t.arc(0,0,u,0,2*Math.PI,!0);else{var f=c?u:u.width,d=c?u:u.height,_=this._size,g=_.width,p=_.height;if(h&&"rectangle"===l&&0===f&&0===d)t.rect(-g/2,-p/2,g,p);else{var v=g/2,m=p/2,y=.44771525016920644,x=f*y,b=d*y,w=[-v,-m+d,-v,-m+b,-v+x,-m,-v+f,-m,v-f,-m,v-x,-m,v,-m+b,v,-m+d,v,m-d,v,m-b,v-x,m,v-f,m,-v+f,m,-v+x,m,-v,m-b,-v,m-d];n&&n.transform(w,w,32),t.moveTo(w[0],w[1]),t.bezierCurveTo(w[2],w[3],w[4],w[5],w[6],w[7]),v!==f&&t.lineTo(w[8],w[9]),t.bezierCurveTo(w[10],w[11],w[12],w[13],w[14],w[15]),m!==d&&t.lineTo(w[16],w[17]),t.bezierCurveTo(w[18],w[19],w[20],w[21],w[22],w[23]),v!==f&&t.lineTo(w[24],w[25]),t.bezierCurveTo(w[26],w[27],w[28],w[29],w[30],w[31])}}t.closePath()}o||!s&&!a||(this._setStyles(t,e,i),s&&(t.fill(r.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),a&&t.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var i=new g(this._size).setCenter(0,0),n=this._style,r=e.stroke&&n.hasStroke()&&n.getStrokeWidth();return t&&(i=t._transformBounds(i)),r?i.expand(F._getStrokePadding(r,this._getStrokeMatrix(t,e))):i}},new function(){function t(t,e,i){var n=t._radius;if(!n.isZero())for(var r=t._size.divide(2),s=0;s<4;s++){var a=new c(1&s?1:-1,s>1?1:-1),o=a.multiply(r),h=o.subtract(a.multiply(n)),l=new g(o,h);if((i?l.expand(i):l).contains(e))return h}}function e(t,e,i,n){var r=t.divide(e);return(!n||r.quadrant===n)&&r.subtract(r.normalize()).multiply(e).divide(i).length<=1}return{_contains:function e(i){if("rectangle"===this._type){var n=t(this,i);return n?i.subtract(n).divide(this._radius).getLength()<=1:e.base.call(this,i)}return i.divide(this.size).getLength()<=.5},_hitTestSelf:function i(n,r,s,a){var o=!1,h=this._style,l=r.stroke&&h.hasStroke(),u=r.fill&&h.hasFill();if(l||u){var c=this._type,f=this._radius,d=l?h.getStrokeWidth()/2:0,_=r._tolerancePadding.add(F._getStrokePadding(d,!h.getStrokeScaling()&&a));if("rectangle"===c){var p=_.multiply(2),v=t(this,n,p);if(v)o=e(n.subtract(v),f,_,v.getQuadrant());else{var m=new g(this._size).setCenter(0,0),y=m.expand(p),x=m.expand(p.negate());o=y._containsPoint(n)&&!x._containsPoint(n)}}else o=e(n,f,_)}return o?new M(l?"stroke":"fill",this):i.base.apply(this,arguments)}}},{statics:new function(){function t(t,e,i,n,s){var a=new C(r.getNamed(s));return a._type=t,a._size=i,a._radius=n,a.translate(e)}return{Circle:function(){var e=c.readNamed(arguments,"center"),i=r.readNamed(arguments,"radius");return t("circle",e,new d(2*i),i,arguments)},Rectangle:function(){var e=g.readNamed(arguments,"rectangle"),i=d.min(d.readNamed(arguments,"radius"),e.getSize(!0).divide(2));return t("rectangle",e.getCenter(!0),e.getSize(!0),i,arguments)},Ellipse:function(){var e=C._readEllipse(arguments),i=e.radius;return t("ellipse",e.center,i.multiply(2),i,arguments)},_readEllipse:function(t){var e,i;if(r.hasNamed(t,"radius"))e=c.readNamed(t,"center"),i=d.readNamed(t,"radius");else{var n=g.readNamed(t,"rectangle");e=n.getCenter(!0),i=n.getSize(!0).divide(2)}return{center:e,radius:i}}}}}),S=x.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},initialize:function(t,i){if(!this._initialize(t,i!==e&&c.read(arguments,1))){var r="string"==typeof t?n.getElementById(t):t;r?this.setImage(r):this.setSource(t)}this._size||(this._size=new d,this._loaded=!1)},_equals:function(t){return this.getSource()===t.getSource()},copyContent:function(t){var e=t._image,i=t._canvas;if(e)this._setImage(e);else if(i){var n=tt.getCanvas(t._size);n.getContext("2d").drawImage(i,0,0),this._setImage(n)}this._crossOrigin=t._crossOrigin},getSize:function(){var t=this._size;return new _(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(){var t=d.read(arguments);if(!t.equals(this._size))if(t.width>0&&t.height>0){var e=this.getElement();this._setImage(tt.getCanvas(t)),e&&this.getContext(!0).drawImage(e,0,0,t.width,t.height)}else this._canvas&&tt.release(this._canvas),this._size=t.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},getLoaded:function(){return this._loaded},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new c(0,0).transform(t),i=new c(1,0).transform(t).subtract(e),n=new c(0,1).transform(t).subtract(e);return new d(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){function e(t){var e=i.getView(),n=t&&t.type||"load";e&&i.responds(n)&&(paper=e._scope,i.emit(n,new W(t)))}var i=this;this._setImage(t),this._loaded?setTimeout(e,0):t&&G.add(t,{load:function(n){i._setImage(t),e(n)},error:e})},_setImage:function(t){this._canvas&&tt.release(this._canvas),t&&t.getContext?(this._image=null,this._canvas=t,this._loaded=!0):(this._image=t,this._canvas=null,this._loaded=!!(t&&t.src&&t.complete)),this._size=new d(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var t=tt.getContext(this._size);try{this._image&&t.drawImage(this._image,0,0),this._canvas=t.canvas}catch(e){tt.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){return this._context||(this._context=this.getCanvas().getContext("2d")),t&&(this._image=null,this._changed(513)),this._context},setContext:function(t){this._context=t},getSource:function(){var t=this._image;return t&&t.src||this.toDataURL()},setSource:function(t){var e=new i.Image,n=this._crossOrigin;n&&(e.crossOrigin=n),e.src=t,this.setImage(e)},getCrossOrigin:function(){var t=this._image;return t&&t.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){this._crossOrigin=t;var e=this._image;e&&(e.crossOrigin=t)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=g.read(arguments),e=tt.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=g.read(arguments),e=new S(x.NO_INSERT);return e._setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.prepend(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=this._image,e=t&&t.src;if(/^data:/.test(e))return e;var i=this.getCanvas();return i?i.toDataURL.apply(i,arguments):null},drawImage:function(t){var e=c.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){var e,i;if(t?t instanceof I?(i=t,e=t.getBounds()):"object"==typeof t&&("width"in t?e=new g(t):"x"in t&&(e=new g(t.x-.5,t.y-.5,1,1))):e=this.getBounds(),!e)return null;var n=32,s=Math.min(e.width,n),a=Math.min(e.height,n),o=S._sampleContext;o?o.clearRect(0,0,n+1,n+1):o=S._sampleContext=tt.getContext(new d(n)),o.save();var h=(new v).scale(s/e.width,a/e.height).translate(-e.x,-e.y);h.applyToContext(o),i&&i.draw(o,new r({clip:!0,matrices:[h]})),this._matrix.applyToContext(o);var l=this.getElement(),u=this._size;l&&o.drawImage(l,-u.width/2,-u.height/2),o.restore();for(var c=o.getImageData(.5,.5,Math.ceil(s),Math.ceil(a)).data,f=[0,0,0],_=0,p=0,m=c.length;p<m;p+=4){var y=c[p+3];_+=y,y/=255,f[0]+=c[p]*y,f[1]+=c[p+1]*y,f[2]+=c[p+2]*y}for(var p=0;p<3;p++)f[p]/=_;return _?B.read(f):null},getPixel:function(){var t=c.read(arguments),e=this.getContext().getImageData(t.x,t.y,1,1).data;return new B("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=c.read(arguments),e=B.read(arguments),i=e._convert("rgb"),n=e._alpha,r=this.getContext(!0),s=r.createImageData(1,1),a=s.data;a[0]=255*i[0],a[1]=255*i[1],a[2]=255*i[2],a[3]=null!=n?255*n:255,r.putImageData(s,t.x,t.y)},createImageData:function(){var t=d.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=g.read(arguments);return t.isEmpty()&&(t=new g(this._size)),this.getContext().getImageData(t.x,t.y,t.width,t.height)},setImageData:function(t){var e=c.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},_getBounds:function(t,e){var i=new g(this._size).setCenter(0,0);return t?t._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new M("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t){var e=this.getElement();e&&(t.globalAlpha=this._opacity,t.drawImage(e,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),A=x.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(t,i){this._initialize(t,i!==e&&c.read(arguments,1))||this.setDefinition(t instanceof k?t:new k(t))},_equals:function(t){return this._definition===t._definition},copyContent:function(t){this.setDefinition(t._definition)},getDefinition:function(){return this._definition},setDefinition:function(t){this._definition=t,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(t,e){var i=this._definition._item;return i._getCachedBounds(i._matrix.prepended(t),e)},_hitTestSelf:function(t,e,i,n){var r=this._definition._item._hitTest(t,e,i);return r&&(r.item=this),r},_draw:function(t,e){this._definition._item.draw(t,e)}}),k=r.extend({_class:"SymbolDefinition",initialize:function(t,e){this._id=u.get(),this.project=paper.project,t&&this.setItem(t,e)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._class,this._item],t,!1,e)})},_changed:function(t){8&t&&x._clearBoundsCache(this),1&t&&this.project._changed(t)},getItem:function(){return this._item},setItem:function(t,e){t._symbol&&(t=t.clone()),this._item&&(this._item._symbol=null),this._item=t,t.remove(),t.setSelected(!1),e||t.setPosition(new c),t._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(t){return new A(this,t)},clone:function(){return new k(this._item.clone(!1))},equals:function(t){return t===this||t&&this._item.equals(t._item)||!1}}),M=r.extend({_class:"HitResult",initialize:function(t,e,i){this.type=t,this.item=e,i&&(i.enumerable=!0,this.inject(i))},statics:{getOptions:function(t){var e=t&&r.read(t);return r.set({type:null,tolerance:paper.settings.hitTolerance,fill:!e,stroke:!e,segments:!e,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1},e)}}}),P=r.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(t,i,n,r,s,a){var o,h,l,u,c=arguments.length;0===c||(1===c?t&&"point"in t?(o=t.point,h=t.handleIn,l=t.handleOut,u=t.selection):o=t:null==t||"object"==typeof t?(o=t,h=i,l=n,u=r):(o=t!==e?[t,i]:null,h=n!==e?[n,r]:null,l=s!==e?[s,a]:null)),new E(o,this,"_point"),new E(h,this,"_handleIn"),new E(l,this,"_handleOut"),u&&this.setSelection(u)},_serialize:function(t,e){var i=this._point,n=this._selection,s=n||this.hasHandles()?[i,this._handleIn,this._handleOut]:i;return n&&s.push(n),r.serialize(s,t,!0,e)},_changed:function(t){var e=this._path;if(e){var i,n=e._curves,r=this._index;n&&(t&&t!==this._point&&t!==this._handleIn||!(i=r>0?n[r-1]:e._closed?n[n.length-1]:null)||i._changed(),t&&t!==this._point&&t!==this._handleOut||!(i=n[r])||i._changed()),e._changed(25)}},getPoint:function(){return this._point},setPoint:function(){var t=c.read(arguments);this._point.set(t.x,t.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(){var t=c.read(arguments);this._handleIn.set(t.x,t.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(){var t=c.read(arguments);this._handleOut.set(t.x,t.y)},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},clearHandles:function(){this._handleIn.set(0,0),this._handleOut.set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var e=this._selection,i=this._path;this._selection=t=t||0,i&&t!==e&&(i._updateSelection(this,e,t),i._changed(129))},changeSelection:function(t,e){var i=this._selection;this.setSelection(e?i|t:i&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this.changeSelection(7,t)},getIndex:function(){return this._index!==e?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(e>0&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new O(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(t,i,n){var r=t||{},s=r.type,a=r.factor,o=this.getPrevious(),h=this.getNext(),l=(o||this)._point,u=this._point,f=(h||this)._point,d=l.getDistance(u),_=u.getDistance(f);if(s&&"catmull-rom"!==s){if("geometric"!==s)throw new Error("Smoothing method '"+s+"' not supported.");if(o&&h){var g=l.subtract(f),p=a===e?.4:a,v=p*d/(d+_);i||this.setHandleIn(g.multiply(v)),n||this.setHandleOut(g.multiply(v-p))}}else{var m=a===e?.5:a,y=Math.pow(d,m),x=y*y,b=Math.pow(_,m),w=b*b;if(!i&&o){var C=2*w+3*b*y+x,S=3*b*(b+y);this.setHandleIn(0!==S?new c((w*l._x+C*u._x-x*f._x)/S-u._x,(w*l._y+C*u._y-x*f._y)/S-u._y):new c)}if(!n&&h){var C=2*x+3*y*b+w,S=3*y*(y+b);this.setHandleOut(0!==S?new c((x*f._x+C*u._x-w*l._x)/S-u._x,(x*f._y+C*u._y-w*l._y)/S-u._y):new c)}}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return 0===this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,i=t._x,n=t._y;t.set(e._x,e._y),e.set(i,n)},reversed:function(){return new P(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new P(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];return this._handleIn.isZero()||t.push("handleIn: "+this._handleIn),this._handleOut.isZero()||t.push("handleOut: "+this._handleOut),"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},interpolate:function(t,e,i){var n=1-i,r=i,s=t._point,a=e._point,o=t._handleIn,h=e._handleIn,l=e._handleOut,u=t._handleOut;this._point.set(n*s._x+r*a._x,n*s._y+r*a._y,!0),this._handleIn.set(n*o._x+r*h._x,n*o._y+r*h._y,!0),this._handleOut.set(n*u._x+r*l._x,n*u._y+r*l._y,!0),this._changed()},_transformCoordinates:function(t,e,i){var n=this._point,r=i&&this._handleIn.isZero()?null:this._handleIn,s=i&&this._handleOut.isZero()?null:this._handleOut,a=n._x,o=n._y,h=2;return e[0]=a,e[1]=o,r&&(e[h++]=r._x+a,e[h++]=r._y+o),s&&(e[h++]=s._x+a,e[h++]=s._y+o),t&&(t._transformCoordinates(e,e,h/2),a=e[0],o=e[1],i?(n._x=a,n._y=o,h=2,r&&(r._x=e[h++]-a,r._y=e[h++]-o),s&&(s._x=e[h++]-a,s._y=e[h++]-o)):(r||(e[h++]=a,e[h++]=o),s||(e[h++]=a,e[h++]=o))),e}}),E=c.extend({initialize:function(t,i,n){var r,s,a;if(t)if((r=t[0])!==e)s=t[1];else{var o=t;(r=o.x)===e&&(o=c.read(arguments),r=o.x),s=o.y,a=o.selected}else r=s=0;this._x=r,this._y=s,this._owner=i,i[n]=this,a&&this.setSelected(!0)},set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){return l.isZero(this._x)&&l.isZero(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner.changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),T=r.extend({_class:"Curve",initialize:function(t,e,i,n,r,s,a,o){var h,l,u,c,f,d,_=arguments.length;3===_?(this._path=t,h=e,l=i):0===_?(h=new P,l=new P):1===_?"segment1"in t?(h=new P(t.segment1),l=new P(t.segment2)):"point1"in t?(u=t.point1,f=t.handle1,d=t.handle2,c=t.point2):Array.isArray(t)&&(u=[t[0],t[1]],c=[t[6],t[7]],f=[t[2]-t[0],t[3]-t[1]],d=[t[4]-t[6],t[5]-t[7]]):2===_?(h=new P(t),l=new P(e)):4===_?(u=t,f=e,d=i,c=n):8===_&&(u=[t,e],c=[a,o],f=[i-t,n-e],d=[r-a,s-o]),this._segment1=h||new P(u,null,f),this._segment2=l||new P(c,d,null)},_serialize:function(t,e){return r.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,e)},_changed:function(){this._length=this._bounds=e},clone:function(){return new T(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},remove:function(){var t=!1;if(this._path){var e=this._segment2,i=e._handleOut;t=e.remove(),t&&this._segment1._handleOut.set(i.x,i.y)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){var t=c.read(arguments);this._segment1._point.set(t.x,t.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(){var t=c.read(arguments);this._segment2._point.set(t.x,t.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){var t=c.read(arguments);this._segment1._handleOut.set(t.x,t.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){var t=c.read(arguments);this._segment2._handleIn.set(t.x,t.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return 0===this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return T.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],i=0;i<8;i+=2)e.push(new c(t[i],t[i+1]));return e},getLength:function(){return null==this._length&&(this._length=T.getLength(this.getValues(),0,1)),this._length},getArea:function(){return T.getArea(this.getValues())},getLine:function(){return new m(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new T(T.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return T.getLength(this.getValues(),t,e)},getIntersections:function(t){return T._getIntersections(this.getValues(),t&&t!==this?t.getValues():null,this,t,[],{})},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:t)},divideAtTime:function(t,e){var i=4e-7,n=1-i,r=null;if(t>=i&&t<=n){var s=T.subdivide(this.getValues(),t),a=s[0],o=s[1],h=e||this.hasHandles(),l=this._segment1,u=this._segment2,f=this._path;h&&(l._handleOut.set(a[2]-a[0],a[3]-a[1]),u._handleIn.set(o[4]-o[6],o[5]-o[7]));var d=a[6],_=a[7],g=new P(new c(d,_),h&&new c(a[4]-d,a[5]-_),h&&new c(o[2]-d,o[3]-_));f?(f.insert(l._index+1,g),r=this.getNext()):(this._segment2=g,this._changed(),r=new T(g,u))}return r},splitAt:function(t){return this._path?this._path.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,i){return this.divideAtTime(t===e?.5:i?t:this.getTimeAt(t))},split:function(t,i){return this.splitAtTime(t===e?.5:i?t:this.getTimeAt(t))},reversed:function(){return new T(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut.set(0,0),this._segment2._handleIn.set(0,0)},statics:{getValues:function(t,e,i){var n=t._point,r=t._handleOut,s=e._handleIn,a=e._point,o=[n._x,n._y,n._x+r._x,n._y+r._y,a._x+s._x,a._y+s._y,a._x,a._y];return i&&i._transformCoordinates(o,o,4),o},subdivide:function(t,i){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7];i===e&&(i=.5);var c=1-i,f=c*n+i*s,d=c*r+i*a,_=c*s+i*o,g=c*a+i*h,p=c*o+i*l,v=c*h+i*u,m=c*f+i*_,y=c*d+i*g,x=c*_+i*p,b=c*g+i*v,w=c*m+i*x,C=c*y+i*b;return[[n,r,f,d,m,y,w,C],[w,C,x,b,p,v,l,u]]},solveCubic:function(t,e,i,n,r,s){var a=t[e],o=t[e+2],h=t[e+4],u=t[e+6],c=0;if(!(a<i&&u<i&&o<i&&h<i||a>i&&u>i&&o>i&&h>i)){var f=3*(o-a),d=3*(h-o)-f,_=u-a-f-d;c=l.solveCubic(_,d,f,a-i,n,r,s)}return c},getTimeOf:function(t,e){var i=new c(t[0],t[1]),n=new c(t[6],t[7]),r=1e-12,s=e.isClose(i,r)?0:e.isClose(n,r)?1:null;if(null!==s)return s;for(var a=[e.x,e.y],o=[],h=2e-7,l=0;l<2;l++)for(var u=T.solveCubic(t,l,a[l],o,0,1),f=0;f<u;f++)if(s=o[f],e.isClose(T.getPoint(t,s),h))return s;return e.isClose(i,h)?0:e.isClose(n,h)?1:null},getNearestTime:function(t,e){function i(i){if(i>=0&&i<=1){var n=e.getDistance(T.getPoint(t,i),!0);if(n<d)return d=n,_=i,!0}}if(T.isStraight(t)){var n=t[0],r=t[1],s=t[6],a=t[7],o=s-n,h=a-r,l=o*o+h*h;if(0===l)return 0;var u=((e.x-n)*o+(e.y-r)*h)/l;return u<1e-12?0:u>.999999999999?1:T.getTimeOf(t,new c(n+u*o,r+u*h))}for(var f=100,d=1/0,_=0,g=0;g<=f;g++)i(g/f);for(var p=1/(2*f);p>4e-7;)i(_-p)||i(_+p)||(p/=2);return _},getPart:function(t,e,i){var n=e>i;if(n){var r=e;e=i,i=r}return e>0&&(t=T.subdivide(t,e)[1]),i<1&&(t=T.subdivide(t,(i-e)/(1-e))[0]),n?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=3*r-2*i-h,c=3*s-2*n-l,f=3*a-2*h-i,d=3*o-2*l-n;return Math.max(u*u,f*f)+Math.max(c*c,d*d)<=16*e*e},getArea:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],h=t[7];return 3*((h-i)*(n+s)-(o-e)*(r+a)+r*(e-s)-n*(i-a)+h*(s+e/3)-o*(a+i/3))/20},getBounds:function(t){for(var e=t.slice(0,2),i=e.slice(),n=[0,0],r=0;r<2;r++)T._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,i,n);return new g(e[0],e[1],i[0]-e[0],i[1]-e[1])},_addBounds:function(t,e,i,n,r,s,a,o,h){function u(t,e){var i=t-e,n=t+e;i<a[r]&&(a[r]=i),n>o[r]&&(o[r]=n)}s/=2;var c=a[r]-s,f=o[r]+s;if(t<c||e<c||i<c||n<c||t>f||e>f||i>f||n>f)if(e<t!=e<n&&i<t!=i<n)u(t,s),u(n,s);else{var d=3*(e-i)-t+n,_=2*(t+i)-4*e,g=e-t,p=l.solveQuadratic(d,_,g,h),v=4e-7,m=1-v;u(n,0);for(var y=0;y<p;y++){var x=h[y],b=1-x;v<x&&x<m&&u(b*b*b*t+3*b*b*x*e+3*b*x*x*i+x*x*x*n,s)}}}}},r.each(["getBounds","getStrokeBounds","getHandleBounds"],function(t){this[t]=function(){this._bounds||(this._bounds={});var e=this._bounds[t];return e||(e=this._bounds[t]=F[t]([this._segment1,this._segment2],!1,this._path)),e.clone()}},{}),r.each({isStraight:function(t,e,i){if(e.isZero()&&i.isZero())return!0;var n=t.getVector(),r=2e-7;if(n.isZero())return!1;if(t.getDistance(e)<r&&t.getDistance(i)<r){var s=n.dot(n),a=n.dot(e)/s,o=n.dot(i)/s;return a>=0&&a<=1&&o<=0&&o>=-1}return!1},isLinear:function(t,e,i){var n=t.getVector().divide(3);return e.equals(n)&&i.negate().equals(n)}},function(t,e){this[e]=function(){var e=this._segment1,i=this._segment2;return t(new m(e._point,i._point),e._handleOut,i._handleIn)},this.statics[e]=function(e){var i=e[0],n=e[1],r=e[6],s=e[7];return t(new m(i,n,r,s),new c(e[2]-i,e[3]-n),new c(e[4]-r,e[5]-s))}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-7},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-7}}),{beans:!1,getLocationAt:function(t,e){return this.getLocationAtTime(e?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&t>=0&&t<=1?new O(this,t):null},getTimeAt:function(t,e){return T.getTimeAt(this.getValues(),t,e)},getParameterAt:"#getTimeAt",getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(c.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return T.getTimeOf(this.getValues(),c.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=c.read(arguments),e=this.getValues(),i=T.getNearestTime(e,t),n=T.getPoint(e,i);return new O(this,i,n,null,t.getDistance(n))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return r.each(t,function(t){this[t+"At"]=function(e,i){var n=this.getValues();return T[t](n,i?e:T.getTimeAt(n,e))},this[t+"AtTime"]=function(e){return T[t](this.getValues(),e)}},{statics:{_evaluateMethods:t}})},new function(){function t(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],h=t[7],l=9*(n-s)+3*(o-e),u=6*(e+s)-12*n,c=3*(n-e),f=9*(r-a)+3*(h-i),d=6*(i+a)-12*r,_=3*(r-i);return function(t){var e=(l*t+u)*t+c,i=(f*t+d)*t+_;return Math.sqrt(e*e+i*i)}}function i(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(t,e,i,n){if(null==e||e<0||e>1)return null;var r=t[0],s=t[1],a=t[2],o=t[3],h=t[4],u=t[5],f=t[6],d=t[7],_=l.isZero;_(a-r)&&_(o-s)&&(a=r,o=s),_(h-f)&&_(u-d)&&(h=f,u=d);var g,p,v=3*(a-r),m=3*(h-a)-v,y=f-r-v-m,x=3*(o-s),b=3*(u-o)-x,w=d-s-x-b;if(0===i)g=0===e?r:1===e?f:((y*e+m)*e+v)*e+r,p=0===e?s:1===e?d:((w*e+b)*e+x)*e+s;else{var C=4e-7,S=1-C;if(e<C?(g=v,p=x):e>S?(g=3*(f-h),p=3*(d-u)):(g=(3*y*e+2*m)*e+v,p=(3*w*e+2*b)*e+x),n){0===g&&0===p&&(e<C||e>S)&&(g=h-a,p=u-o);var A=Math.sqrt(g*g+p*p);A&&(g/=A,p/=A)}if(3===i){var k=6*y*e+2*m,M=6*w*e+2*b,P=Math.pow(g*g+p*p,1.5);g=0!==P?(g*M-p*k)/P:0,p=0}}return 2===i?new c(p,-g):new c(g,p)}return{statics:{getLength:function(n,r,s,a){if(r===e&&(r=0),s===e&&(s=1),T.isStraight(n)){var o=n;s<1&&(o=T.subdivide(o,s)[0],r/=s),r>0&&(o=T.subdivide(o,r)[1]);var h=o[6]-o[0],u=o[7]-o[1];return Math.sqrt(h*h+u*u)}return l.integrate(a||t(n),r,s,i(r,s))},getTimeAt:function(n,r,s){function a(t){return v+=l.integrate(d,s,t,i(s,t)),s=t,v-r}if(s===e&&(s=r<0?1:0),0===r)return s;var o=Math.abs,h=1e-12,u=r>0,c=u?s:0,f=u?1:s,d=t(n),_=T.getLength(n,c,f,d),g=o(r)-_;if(o(g)<h)return u?f:c;if(g>h)return null;var p=r/_,v=0;return l.findRoot(a,d,s+p,c,f,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x}}}},new function(){function t(t,e,i,n,r,s,a,o,h,l,u){var c=!u&&e.excludeStart,f=!u&&e.excludeEnd,d=4e-7,_=1-d;if(null==r&&(r=T.getTimeOf(i,s)),null!==r&&r>=(c?d:0)&&r<=(f?_:1)&&(null==h&&(h=T.getTimeOf(a,l)),null!==h&&h>=(f?d:0)&&h<=(c?_:1))){var g=e.renormalize;if(g){var p=g(r,h);
r=p[0],h=p[1]}var v=new O(n,r,s||T.getPoint(i,r),u),m=new O(o,h,l||T.getPoint(a,h),u),y=v.getPath()===m.getPath()&&v.getIndex()>m.getIndex(),x=y?m:v,b=e.include;v._intersection=m,m._intersection=v,b&&!b(x)||O.insert(t,x,!0)}}function e(r,s,a,o,h,l,u,c,f,d,_,g,p){if(++g>=48||++p>4096)return p;var v,y,x=s[0],b=s[1],w=s[6],C=s[7],S=m.getSignedDistance,A=S(x,b,w,C,s[2],s[3]),k=S(x,b,w,C,s[4],s[5]),M=A*k>0?.75:4/9,P=M*Math.min(0,A,k),E=M*Math.max(0,A,k),O=S(x,b,w,C,r[0],r[1]),I=S(x,b,w,C,r[2],r[3]),F=S(x,b,w,C,r[4],r[5]),q=S(x,b,w,C,r[6],r[7]),z=i(O,I,F,q),R=z[0],L=z[1];if(0===A&&0===k&&0===O&&0===I&&0===F&&0===q||null==(v=n(R,L,P,E))||null==(y=n(R.reverse(),L.reverse(),P,E)))return p;var N=u+(c-u)*v,B=u+(c-u)*y;if(Math.max(d-f,B-N)<1e-9){var j=(N+B)/2,D=(f+d)/2;r=a.getValues(),s=o.getValues(),t(h,l,_?s:r,_?o:a,_?D:j,null,_?r:s,_?a:o,_?j:D,null)}else if(r=T.getPart(r,v,y),y-v>.8)if(B-N>d-f){var U=T.subdivide(r,.5),j=(N+B)/2;p=e(s,U[0],o,a,h,l,f,d,N,j,!_,g,p),p=e(s,U[1],o,a,h,l,f,d,j,B,!_,g,p)}else{var U=T.subdivide(s,.5),D=(f+d)/2;p=e(U[0],r,o,a,h,l,f,D,N,B,!_,g,p),p=e(U[1],r,o,a,h,l,D,d,N,B,!_,g,p)}else p=e(s,r,o,a,h,l,f,d,N,B,!_,g,p);return p}function i(t,e,i,n){var r,s=[0,t],a=[1/3,e],o=[2/3,i],h=[1,n],l=e-(2*t+n)/3,u=i-(t+2*n)/3;if(l*u<0)r=[[s,a,h],[s,o,h]];else{var c=l/u;r=[c>=2?[s,a,h]:c<=.5?[s,o,h]:[s,a,o,h],[s,h]]}return(l||u)<0?r.reverse():r}function n(t,e,i,n){return t[0][1]<i?r(t,!0,i):e[0][1]>n?r(e,!1,n):t[0][0]}function r(t,e,i){for(var n=t[0][0],r=t[0][1],s=1,a=t.length;s<a;s++){var o=t[s][0],h=t[s][1];if(e?h>=i:h<=i)return h===i?o:n+(i-r)*(o-n)/(h-r);n=o,r=h}return null}function s(e,i,n,r,s,a){for(var o=T.isStraight(e),h=o?i:e,u=o?e:i,c=u[0],f=u[1],d=u[6],_=u[7],g=d-c,p=_-f,v=Math.atan2(-p,g),m=Math.sin(v),y=Math.cos(v),x=[],b=0;b<8;b+=2){var w=h[b]-c,C=h[b+1]-f;x.push(w*y-C*m,w*m+C*y)}for(var S=[],A=T.solveCubic(x,1,0,S,0,1),b=0;b<A;b++){var k=S[b],M=T.getPoint(h,k),P=T.getTimeOf(u,M);if(null!==P){var E=T.getPoint(u,P),O=o?P:k,I=o?k:P;(!a.excludeEnd||I>l.CURVETIME_EPSILON)&&t(s,a,e,n,O,o?E:M,i,r,I,o?M:E)}}}function a(e,i,n,r,s,a){var o=m.intersect(e[0],e[1],e[6],e[7],i[0],i[1],i[6],i[7]);o&&t(s,a,e,n,null,o,i,r,null,o)}return{statics:{_getIntersections:function(i,n,r,o,h,l){if(!n)return T._getSelfIntersection(i,r,h,l);var u=2e-7,f=i[0],d=i[1],_=i[6],g=i[7],p=n[0],v=n[1],m=n[6],y=n[7],x=(3*i[2]+f)/4,b=(3*i[3]+d)/4,w=(3*i[4]+_)/4,C=(3*i[5]+g)/4,S=(3*n[2]+p)/4,A=(3*n[3]+v)/4,k=(3*n[4]+m)/4,M=(3*n[5]+y)/4,P=Math.min,E=Math.max;if(!(E(f,x,w,_)+u>P(p,S,k,m)&&P(f,x,w,_)-u<E(p,S,k,m)&&E(d,b,C,g)+u>P(v,A,M,y)&&P(d,b,C,g)-u<E(v,A,M,y)))return h;var O=T.getOverlaps(i,n);if(O){for(var I=0;I<2;I++){var F=O[I];t(h,l,i,r,F[0],null,n,o,F[1],null,!0)}return h}var q=T.isStraight(i),z=T.isStraight(n),R=q&&z,L=h.length;if((R?a:q||z?s:e)(i,n,r,o,h,l,0,1,0,1,0,0,0),R&&h.length>L)return h;var N=new c(f,d),B=new c(_,g),j=new c(p,v),D=new c(m,y);return N.isClose(j,u)&&t(h,l,i,r,0,N,n,o,0,j),!l.excludeStart&&N.isClose(D,u)&&t(h,l,i,r,0,N,n,o,1,D),!l.excludeEnd&&B.isClose(j,u)&&t(h,l,i,r,1,B,n,o,0,j),B.isClose(D,u)&&t(h,l,i,r,1,B,n,o,1,D),h},_getSelfIntersection:function(t,e,i,n){var r=t[0],s=t[1],a=t[2],o=t[3],h=t[4],u=t[5],f=t[6],d=t[7],_=new m(r,s,f,d,!1),g=_.getSide(new c(a,o),!0),p=_.getSide(new c(h,u),!0);if(g===p){var v=(r-h)*(o-d)+(a-f)*(u-s);if(v*g>0)return i}var y=f-3*h+3*a-r,x=h-2*a+r,b=a-r,w=d-3*u+3*o-s,C=u-2*o+s,S=o-s,A=w*b-y*S,k=w*x-y*C,M=C*b-x*S;if(A*A-4*k*M<0){var P,E=[],O=l.solveCubic(y*y+w*w,3*(y*x+w*C),2*(x*x+C*C)+y*b+w*S,x*b+C*S,E,0,1);if(O>0){for(var I=0,F=0;I<O;I++){var q=Math.abs(e.getCurvatureAtTime(E[I]));q>F&&(F=q,P=E[I])}var z=T.subdivide(t,P);n.excludeEnd=!0,n.renormalize=function(t,e){return[t*P,e*(1-P)+P]},T._getIntersections(z[0],z[1],e,e,i,n)}}return i},getOverlaps:function(t,e){function i(t){var e=t[6]-t[0],i=t[7]-t[1];return e*e+i*i}var n=Math.abs,r=4e-7,s=2e-7,a=T.isStraight(t),o=T.isStraight(e),h=a&&o,l=i(t)<i(e),u=l?e:t,f=l?t:e,d=new m(u[0],u[1],u[6],u[7]);if(d.getDistance(new c(f[0],f[1]))<s&&d.getDistance(new c(f[6],f[7]))<s)!h&&d.getDistance(new c(u[2],u[3]))<s&&d.getDistance(new c(u[4],u[5]))<s&&d.getDistance(new c(f[2],f[3]))<s&&d.getDistance(new c(f[4],f[5]))<s&&(a=o=h=!0);else if(h)return null;if(a^o)return null;for(var _=[t,e],g=[],p=0,v=0;p<2&&g.length<2;p+=0===v?0:1,v^=1){var y=T.getTimeOf(_[1^p],new c(_[p][0===v?0:6],_[p][0===v?1:7]));if(null!=y){var x=0===p?[v,y]:[y,v];(0===g.length||n(x[0]-g[0][0])>r&&n(x[1]-g[0][1])>r)&&g.push(x)}if(1===p&&0===g.length)break}if(2!==g.length)g=null;else if(!h){var b=T.getPart(t,g[0][0],g[1][0]),w=T.getPart(e,g[0][1],g[1][1]);(n(w[2]-b[2])>s||n(w[3]-b[3])>s||n(w[4]-b[4])>s||n(w[5]-b[5])>s)&&(g=null)}return g}}}}),O=r.extend({_class:"CurveLocation",beans:!0,initialize:function(t,e,i,n,r){if(e>.9999996){var s=t.getNext();s&&(e=0,t=s)}this._setCurve(t),this._time=e,this._point=i||t.getPointAtTime(e),this._overlap=n,this._distance=r,this._intersection=this._next=this._previous=null},_setCurve:function(t){var e=t._path;this._path=e,this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this.getCurve(),e=this._segment;if(!e){var i=this.getTime();0===i?e=t._segment1:1===i?e=t._segment2:null!=i&&(e=t.getPartLength(0,i)<t.getPartLength(i,1)?t._segment1:t._segment2),this._segment=e}return e},getCurve:function(){function t(t){var e=t&&t.getCurve();if(e&&null!=(i._time=e.getTimeOf(i._point)))return i._setCurve(e),i._segment=t,e}var e=this._path,i=this;return e&&e._version!==this._version&&(this._time=this._curve=this._offset=null),this._curve||t(this._segment)||t(this._segment1)||t(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),e=this._time;return t&&null==e?this._time=t.getTimeOf(this._point):e},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),i=this.getIndex();if(e&&null!=i)for(var n=e.getCurves(),r=0;r<i;r++)t+=n[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this.getCurve(),e=this.getTime();return null!=e&&t&&t.getPartLength(0,e)},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=null;return t&&(e=t.divideAtTime(this.getTime()),e&&this._setSegment(e._segment1)),e},split:function(){var t=this.getCurve();return t?t.splitAtTime(this.getTime()):null},equals:function(t,e){var i=this===t,n=2e-7;if(!i&&t instanceof O&&this.getPath()===t.getPath()&&this.getPoint().isClose(t.getPoint(),n)){var r=this.getCurve(),s=t.getCurve(),a=Math.abs,o=a((r.isLast()&&s.isFirst()?-1:r.getIndex())+this.getTime()-((s.isLast()&&r.isFirst()?-1:s.getIndex())+t.getTime()));i=(o<4e-7||(o=a(this.getOffset()-t.getOffset()))<n||a(this.getPath().getLength()-o)<n)&&(e||!this._intersection&&!t._intersection||this._intersection&&this._intersection.equals(t._intersection,!0))}return i},toString:function(){var t=[],e=this.getPoint(),i=h.instance;e&&t.push("point: "+e);var n=this.getIndex();null!=n&&t.push("index: "+n);var r=this.getTime();return null!=r&&t.push("time: "+i.number(r)),null!=this._distance&&t.push("distance: "+i.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),i=t.getCurve();return!(e.isStraight()&&i.isStraight()&&e.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){function t(t,e,i){return e<i?t>e&&t<i:t>e||t<i}var e=this._intersection;if(!e)return!1;var i=this.getTime(),n=e.getTime(),r=4e-7,s=1-r,a=i>r&&i<s,o=n>r&&n<s;if(a&&o)return!this.isTouching();var h=this.getCurve(),l=i<=r?h.getPrevious():h,u=e.getCurve(),c=n<=r?u.getPrevious():u;if(i>=s&&(h=h.getNext()),n>=s&&(u=u.getNext()),!(l&&h&&c&&u))return!1;var f=[];a||f.push(l.getLength(),h.getLength()),o||f.push(c.getLength(),u.getLength());var d=this.getPoint(),_=Math.min.apply(Math,f)/64,g=a?h.getTangentAtTime(i):h.getPointAt(_).subtract(d),p=a?g.negate():l.getPointAt(-_).subtract(d),v=o?u.getTangentAtTime(n):u.getPointAt(_).subtract(d),m=o?v.negate():c.getPointAt(-_).subtract(d),y=p.getAngle(),x=g.getAngle(),b=m.getAngle(),w=v.getAngle();return!!(a?t(y,b,w)^t(x,b,w)&&t(y,w,b)^t(x,w,b):t(b,y,x)^t(w,y,x)&&t(b,x,y)^t(w,x,y))},hasOverlap:function(){return!!this._overlap}},r.each(T._evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getCurve(),i=this.getTime();return null!=i&&t&&t[e](i,!0)}},{preserve:!0}),new function(){function t(t,e,i){function n(i,n){for(var s=i+n;s>=-1&&s<=r;s+=n){var a=t[(s%r+r)%r];if(!e.getPoint().isClose(a.getPoint(),2e-7))break;if(e.equals(a))return a}return null}for(var r=t.length,s=0,a=r-1;s<=a;){var o,h=s+a>>>1,l=t[h];if(i&&(o=e.equals(l)?l:n(h,-1)||n(h,1)))return e._overlap&&(o._overlap=o._intersection._overlap=!0),o;var u=e.getPath(),c=l.getPath(),f=u===c?e.getIndex()+e.getTime()-(l.getIndex()+l.getTime()):u._id-c._id;f<0?a=h-1:s=h+1}return t.splice(s,0,e),e}return{statics:{insert:t,expand:function(e){for(var i=e.slice(),n=e.length-1;n>=0;n--)t(i,e[n]._intersection,!1);return i}}}}),I=x.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,initialize:function(){},statics:{create:function(t){var e=(t&&t.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(t)?q:F;return new e(t)}},_asPathItem:function(){return this},setPathData:function(t){function e(t,e){var i=+n[t];return o&&(i+=h[e]),i}function i(t){return new c(e(t,"x"),e(t+1,"y"))}var n,r,s,a=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),o=!1,h=new c,l=new c;this.clear();for(var u=0,f=a&&a.length;u<f;u++){var _=a[u],g=_[0],p=g.toLowerCase();n=_.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var v=n&&n.length;switch(o=g===p,"z"!==r||/[mz]/.test(p)||this.moveTo(h=l),p){case"m":case"l":for(var m="m"===p,y=0;y<v;y+=2)this[0===y&&m?"moveTo":"lineTo"](h=i(y));s=h,m&&(l=h);break;case"h":case"v":for(var x="h"===p?"x":"y",y=0;y<v;y++)h[x]=e(y,x),this.lineTo(h);s=h;break;case"c":for(var y=0;y<v;y+=6)this.cubicCurveTo(i(y),s=i(y+2),h=i(y+4));break;case"s":for(var y=0;y<v;y+=4)this.cubicCurveTo(/[cs]/.test(r)?h.multiply(2).subtract(s):h,s=i(y),h=i(y+2)),r=p;break;case"q":for(var y=0;y<v;y+=4)this.quadraticCurveTo(s=i(y),h=i(y+2));break;case"t":for(var y=0;y<v;y+=2)this.quadraticCurveTo(s=/[qt]/.test(r)?h.multiply(2).subtract(s):h,h=i(y)),r=p;break;case"a":for(var y=0;y<v;y+=7)this.arcTo(h=i(y+5),new d(+n[y],+n[y+1]),+n[y+2],+n[y+4],+n[y+3]);break;case"z":this.closePath(1e-12)}r=p}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=t.isInside(this.getBounds({internal:!0,handle:!0}))&&this._getWinding(t);return!!("evenodd"===this.getFillRule()?1&e:e)},getIntersections:function(t,e,i,n){var r=this===t||!t,s=this._matrix._orNullIfIdentity(),a=r?s:(i||t._matrix)._orNullIfIdentity();if(!r&&!this.getBounds(s).touches(t.getBounds(a)))return[];for(var o,t,h=this.getCurves(),l=r?h:t.getCurves(),u=h.length,c=r?u:l.length,f=[],d=[],_=0;_<c;_++)f[_]=l[_].getValues(a);for(var _=0;_<u;_++){var g=h[_],p=r?f[_]:g.getValues(s),v=g.getPath();v!==t&&(t=v,o=[],d.push(o)),r&&T._getSelfIntersection(p,g,o,{include:e,excludeStart:1===u&&g.getPoint1().equals(g.getPoint2())});for(var m=r?_+1:0;m<c;m++){if(n&&o.length)return o;var y=l[m];T._getIntersections(p,f[m],g,y,o,{include:e,excludeStart:r&&g.getPrevious()===y,excludeEnd:r&&g.getNext()===y})}}o=[];for(var _=0,x=d.length;_<x;_++)o.push.apply(o,d[_]);return o},getCrossings:function(t){return this.getIntersections(t,function(t){return t._overlap||t.isCrossing()})},getNearestLocation:function(){for(var t=c.read(arguments),e=this.getCurves(),i=1/0,n=null,r=0,s=e.length;r<s;r++){var a=e[r].getNearestLocation(t);a._distance<i&&(i=a._distance,n=a)}return n},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t},interpolate:function(t,e,i){var n=!this._children,r=n?"_segments":"_children",s=t[r],a=e[r],o=this[r];if(!s||!a||s.length!==a.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+e);var h=o.length,l=a.length;if(h<l)for(var u=n?P:F,c=h;c<l;c++)this.add(new u);else h>l&&this[n?"removeSegments":"removeChildren"](l,h);for(var c=0;c<l;c++)o[c].interpolate(s[c],a[c],i);n&&(this.setClosed(t._closed),this._changed(9))}}),F=I.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(t){this._closed=!1,this._segments=[],this._version=0;var i=Array.isArray(t)?"object"==typeof t[0]?t:arguments:!t||t.size!==e||t.x===e&&t.point===e?null:arguments;i&&i.length>0?this.setSegments(i):(this._curves=e,this._segmentSelection=0,i||"string"!=typeof t||(this.setPathData(t),t=null)),this._initialize(!i&&t)},_equals:function(t){return this._closed===t._closed&&r.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed;var i=t._clockwise;i!==e&&(this._clockwise=i)},_changed:function t(i){if(t.base.call(this,i),8&i){if(this._length=this._area=this._clockwise=this._monoCurves=e,16&i)this._version++;else if(this._curves)for(var n=0,r=this._curves.length;n<r;n++)this._curves[n]._changed()}else 32&i&&(this._bounds=e)},getStyle:function(){var t=this._parent;return(t instanceof q?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var i=this.isFullySelected();this._segments.length=0,this._segmentSelection=0,this._curves=e,t&&t.length>0&&this._add(P.readAll(t)),i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var i=this._countCurves();t=this._curves=new Array(i);for(var n=0;n<i;n++)t[n]=new T(this,e[n],e[n+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();t&&(this._curves[e-1]=new T(this,this._segments[e-1],this._segments[0]))}this._changed(25)}}},{beans:!0,getPathData:function(t,e){function i(e,i){e._transformCoordinates(t,g),n=g[0],r=g[1],p?(v.push("M"+_.pair(n,r)),p=!1):(o=g[2],l=g[3],o===n&&l===r&&u===s&&c===a?i||v.push("l"+_.pair(n-s,r-a)):v.push("c"+_.pair(u-s,c-a)+" "+_.pair(o-s,l-a)+" "+_.pair(n-s,r-a))),s=n,a=r,u=g[4],c=g[5]}var n,r,s,a,o,l,u,c,f=this._segments,d=f.length,_=new h(e),g=new Array(6),p=!0,v=[];if(0===d)return"";for(var m=0;m<d;m++)i(f[m]);return this._closed&&d>0&&(i(f[0],!0),v.push("z")),v.join("")},isEmpty:function(){return 0===this._segments.length},_transformContent:function(t){for(var e=this._segments,i=new Array(6),n=0,r=e.length;n<r;n++)e[n]._transformCoordinates(t,i,!0);return!0},_add:function(t,e){for(var i=this._segments,n=this._curves,r=t.length,s=null==e,e=s?i.length:e,a=0;a<r;a++){var o=t[a];o._path&&(o=t[a]=o.clone()),o._path=this,o._index=e+a,o._selection&&this._updateSelection(o,0,o._selection)}if(s)i.push.apply(i,t);else{i.splice.apply(i,[e,0].concat(t));for(var a=e+r,h=i.length;a<h;a++)i[a]._index=a}if(n){var l=this._countCurves(),u=e>0&&e+r-1===l?e-1:e,c=u,f=Math.min(u+r,l);t._curves&&(n.splice.apply(n,[u,0].concat(t._curves)),c+=t._curves.length);for(var a=c;a<f;a++)n.splice(a,0,new T(this,null,null));this._adjustCurves(u,f)}return this._changed(25),t},_adjustCurves:function(t,e){for(var i,n=this._segments,r=this._curves,s=t;s<e;s++)i=r[s],i._path=this,i._segment1=n[s],i._segment2=n[s+1]||n[0],i._changed();(i=r[this._closed&&0===t?n.length-1:t-1])&&(i._segment2=n[t]||n[0],i._changed()),(i=r[e])&&(i._segment1=n[e],i._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){return arguments.length>1&&"number"!=typeof t?this._add(P.readAll(arguments)):this._add([P.read(arguments)])[0]},insert:function(t,e){return arguments.length>2&&"number"!=typeof e?this._add(P.readAll(arguments,1),t):this._add([P.read(arguments,1)],t)[0]},addSegment:function(){return this._add([P.read(arguments)])[0]},insertSegment:function(t){return this._add([P.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(P.readAll(t))},insertSegments:function(t,e){return this._add(P.readAll(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,e,i){t=t||0,e=r.pick(e,this._segments.length);var n=this._segments,s=this._curves,a=n.length,o=n.splice(t,e-t),h=o.length;if(!h)return o;for(var l=0;l<h;l++){var u=o[l];u._selection&&this._updateSelection(u,u._selection,0),u._index=u._path=null}for(var l=t,c=n.length;l<c;l++)n[l]._index=l;if(s){for(var f=t>0&&e===a+(this._closed?1:0)?t-1:t,s=s.splice(f,h),l=s.length-1;l>=0;l--)s[l]._path=null;i&&(o._curves=s.slice(1)),this._adjustCurves(f,f)}return this._changed(25),o},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();this._length=e}return this._length},getArea:function(t){var i=t===e,n=this._area;if(!i||null==n){var r=this._segments,s=r.length,a=i?this._closed:t,o=s-1;n=0;for(var h=0,l=a?s:o;h<l;h++)n+=T.getArea(T.getValues(r[h],r[h<o?h+1:0]));i&&(this._area=n)}return n},isClockwise:function(){return this._clockwise!==e?this._clockwise:this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse(),this._clockwise=t},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&t>0&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function t(e){1&e||this._selectSegments(!1),t.base.call(this,e)},_selectSegments:function(t){var e=this._segments,i=e.length,n=t?7:0;this._segmentSelection=n*i;for(var r=0;r<i;r++)e[r]._selection=n},_updateSelection:function(t,e,i){t._selection=i;var n=this._segmentSelection+=i-e;n>0&&this.setSelected(!0)},splitAt:function(t){var e="number"==typeof t?this.getLocationAt(t):t,i=e&&e.index,n=e&&e.time,r=4e-7,s=1-r;n>=s&&(i++,n=0);var a=this.getCurves();if(i>=0&&i<a.length){n>=r&&a[i++].divideAtTime(n);var o,h=this.removeSegments(i,this._segments.length,!0);return this._closed?(this.setClosed(!1),o=this):(o=new F(x.NO_INSERT),o.insertAbove(this,!0),o.copyAttributes(this)),o._add(h,0),this.addSegment(h[0]),o}return null},split:function(t,i){var n,r=i===e?t:(n=this.getCurves()[t])&&n.getLocationAtTime(i);return null!=r?this.splitAt(r):null},join:function(t,e){var i=e||0;if(t&&t!==this){var n=t._segments,r=this.getLastSegment(),s=t.getLastSegment();if(!s)return this;r&&r._point.isClose(s._point,i)&&t.reverse();var a=t.getFirstSegment();if(r&&r._point.isClose(a._point,i))r.setHandleOut(a._handleOut),this._add(n.slice(1));else{var o=this.getFirstSegment();o&&o._point.isClose(a._point,i)&&t.reverse(),s=t.getLastSegment(),o&&o._point.isClose(s._point,i)?(o.setHandleIn(s._handleIn),this._add(n.slice(0,n.length-1),0)):this._add(n.slice())}t._closed&&this._add([n[0]]),t.remove()}var h=this.getFirstSegment(),l=this.getLastSegment();return h!==l&&h._point.isClose(l._point,i)&&(h.setHandleIn(l._handleIn),l.remove(),this.setClosed(!0)),this},reduce:function(t){for(var e=this.getCurves(),i=t&&t.simplify,n=i?2e-7:0,r=e.length-1;r>=0;r--){var s=e[r];!s.hasHandles()&&(s.getLength()<n||i&&s.isCollinear(s.getNext()))&&s.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,i=this._segments.length;t<i;t++){var n=this._segments[t],r=n._handleIn;n._handleIn=n._handleOut,n._handleOut=r,n._index=t}this._curves=null,this._clockwise!==e&&(this._clockwise=!this._clockwise),this._changed(9)},flatten:function(t){for(var e=new z(this,t||.25,256,!0),i=e.parts,n=i.length,r=[],s=0;s<n;s++)r.push(new P(i[s].curve.slice(0,2)));!this._closed&&n>0&&r.push(new P(i[n-1].curve.slice(6))),this.setSegments(r)},simplify:function(t){var e=new R(this).fit(t||2.5);return e&&this.setSegments(e),!!e},smooth:function(t){function i(t,e){var i=t&&t.index;if(null!=i){var r=t.path;if(r&&r!==n)throw new Error(t._class+" "+i+" of "+r+" is not part of "+n);e&&t instanceof T&&i++}else i="number"==typeof t?t:e;return Math.min(i<0&&h?i%o:i<0?i+o:i,o-1)}var n=this,r=t||{},s=r.type||"asymmetric",a=this._segments,o=a.length,h=this._closed,l=h&&r.from===e&&r.to===e,u=i(r.from,0),c=i(r.to,o-1);if(u>c)if(h)u-=o;else{var f=u;u=c,c=f}if(/^(?:asymmetric|continuous)$/.test(s)){var d="asymmetric"===s,_=Math.min,g=c-u+1,p=g-1,v=l?_(g,4):1,m=v,y=v,x=[];if(h||(m=_(1,u),y=_(1,o-c-1)),p+=m+y,p<=1)return;for(var b=0,w=u-m;b<=p;b++,w++)x[b]=a[(w<0?w+o:w)%o]._point;for(var C=x[0]._x+2*x[1]._x,S=x[0]._y+2*x[1]._y,A=2,k=p-1,M=[C],P=[S],E=[A],O=[],I=[],b=1;b<p;b++){var F=b<k,q=F?1:d?1:2,z=F?4:d?2:7,R=F?4:d?3:8,L=F?2:d?0:1,N=q/A;A=E[b]=z-N,C=M[b]=R*x[b]._x+L*x[b+1]._x-N*C,S=P[b]=R*x[b]._y+L*x[b+1]._y-N*S}O[k]=M[k]/E[k],I[k]=P[k]/E[k];for(var b=p-2;b>=0;b--)O[b]=(M[b]-O[b+1])/E[b],I[b]=(P[b]-I[b+1])/E[b];O[p]=(3*x[p]._x-O[k])/2,I[p]=(3*x[p]._y-I[k])/2;for(var b=m,B=p-y,w=u;b<=B;b++,w++){var j=a[w<0?w+o:w],D=j._point,U=O[b]-D._x,V=I[b]-D._y;(l||b<B)&&j.setHandleOut(U,V),(l||b>m)&&j.setHandleIn(-U,-V)}}else for(var b=u;b<=c;b++)a[b<0?b+o:b].smooth(r,!l&&b===u,!l&&b===c)},toShape:function(t){function i(t,e){var i=c[t],n=i.getNext(),r=c[e],s=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&s._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(s._point.subtract(r._point))}function n(t){var e=c[t],i=e.getPrevious(),n=e.getNext();return i._handleOut.isZero()&&e._handleIn.isZero()&&e._handleOut.isZero()&&n._handleIn.isZero()&&e._point.subtract(i._point).isOrthogonal(n._point.subtract(e._point))}function r(t){var e=c[t],i=e.getNext(),n=e._handleOut,r=i._handleIn,s=.5522847498307936;if(n.isOrthogonal(r)){var a=e._point,o=i._point,h=new m(a,n,!0).intersect(new m(o,r,!0),!0);return h&&l.isZero(n.getLength()/h.subtract(a).getLength()-s)&&l.isZero(r.getLength()/h.subtract(o).getLength()-s)}return!1}function s(t,e){return c[t]._point.getDistance(c[e]._point)}if(!this._closed)return null;var a,o,h,u,c=this._segments;if(!this.hasHandles()&&4===c.length&&i(0,2)&&i(1,3)&&n(1)?(a=C.Rectangle,o=new d(s(0,3),s(0,1)),u=c[1]._point.add(c[2]._point).divide(2)):8===c.length&&r(0)&&r(2)&&r(4)&&r(6)&&i(1,5)&&i(3,7)?(a=C.Rectangle,o=new d(s(1,6),s(0,3)),h=o.subtract(new d(s(0,7),s(1,2))).divide(2),u=c[3]._point.add(c[4]._point).divide(2)):4===c.length&&r(0)&&r(1)&&r(2)&&r(3)&&(l.isZero(s(0,2)-s(1,3))?(a=C.Circle,h=s(0,2)/2):(a=C.Ellipse,h=new d(s(2,0)/2,s(3,1)/2)),u=c[1]._point),a){var f=this.getPosition(!0),_=new a({center:f,size:o,radius:h,insert:!1});return _.copyAttributes(this,!0),_._matrix.prepend(this._matrix),_.rotate(u.subtract(f).getAngle()+90),(t===e||t)&&_.insertAbove(this),_}return null},toPath:"#clone",_hitTestSelf:function(t,e,i,n){function r(e,i){return t.subtract(e).divide(i).length<=1}function s(t,i,n){if(!e.selected||i.isSelected()){var s=t._point;if(i!==s&&(i=i.add(s)),r(i,b))return new M(n,g,{segment:t,point:i})}}function a(t,i){return(i||e.segments)&&s(t,t._point,"segment")||!i&&e.handles&&(s(t,t._handleIn,"handle-in")||s(t,t._handleOut,"handle-out"))}function o(t){f.add(t)}function h(e){if(("round"!==l||"round"!==u)&&(f=new F({internal:!0,closed:!0}),y||e._index>0&&e._index<m-1?"round"!==l&&(e._handleIn.isZero()||e._handleOut.isZero())&&F._addBevelJoin(e,l,A,c,null,n,o,!0):"round"!==u&&F._addSquareCap(e,u,A,null,n,o,!0),!f.isEmpty())){var i;return f.contains(t)||(i=f.getNearestLocation(t))&&r(i.getPoint(),x)}return r(e._point,b)}var l,u,c,f,d,_,g=this,p=this.getStyle(),v=this._segments,m=v.length,y=this._closed,x=e._tolerancePadding,b=x,w=e.stroke&&p.hasStroke(),C=e.fill&&p.hasFill(),S=e.curves,A=w?p.getStrokeWidth()/2:C&&e.tolerance>0||S?0:null;if(null!==A&&(A>0?(l=p.getStrokeJoin(),u=p.getStrokeCap(),c=A*p.getMiterLimit(),b=b.add(F._getStrokePadding(A,n))):l=u="round"),!e.ends||e.segments||y){if(e.segments||e.handles)for(var k=0;k<m;k++)if(_=a(v[k]))return _}else if(_=a(v[0],!0)||a(v[m-1],!0))return _;if(null!==A){if(d=this.getNearestLocation(t)){var P=d.getTime();0===P||1===P&&m>1?h(d.getSegment())||(d=null):r(d.getPoint(),b)||(d=null)}if(!d&&"miter"===l&&m>1)for(var k=0;k<m;k++){var E=v[k];if(t.getDistance(E._point)<=c&&h(E)){d=E.getLocation();break}}}return!d&&C&&this._contains(t)||d&&!w&&!S?new M("fill",this):d?new M(w?"stroke":"curve",this,{location:d,point:d.getPoint()}):null}},r.each(T._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this.getLocationAt(e);return i&&i[t]()}},{beans:!1,getLocationOf:function(){for(var t=c.read(arguments),e=this.getCurves(),i=0,n=e.length;i<n;i++){var r=e[i].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t){for(var e=this.getCurves(),i=0,n=0,r=e.length;n<r;n++){var s=i,a=e[n];if(i+=a.getLength(),i>t)return a.getLocationAt(t-s)}return e.length>0&&t<=this.getLength()?new O(e[e.length-1],1):null}}),new function(){function t(t,e,i,n){function r(e){var i=h[e],n=h[e+1];s==i&&a==n||(t.beginPath(),t.moveTo(s,a),t.lineTo(i,n),t.stroke(),t.beginPath(),t.arc(i,n,o,0,2*Math.PI,!0),t.fill())}for(var s,a,o=n/2,h=new Array(6),l=0,u=e.length;l<u;l++){var c=e[l],f=c._selection;if(c._transformCoordinates(i,h),s=h[0],a=h[1],2&f&&r(2),4&f&&r(4),t.fillRect(s-o,a-o,n,n),!(1&f)){var d=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(s-o+1,a-o+1,n-2,n-2),t.fillStyle=d}}}function e(t,e,i){function n(e){if(i)e._transformCoordinates(i,_),r=_[0],s=_[1];else{var n=e._point;r=n._x,s=n._y}if(g)t.moveTo(r,s),g=!1;else{if(i)h=_[2],l=_[3];else{var f=e._handleIn;h=r+f._x,l=s+f._y}h===r&&l===s&&u===a&&c===o?t.lineTo(r,s):t.bezierCurveTo(u,c,h,l,r,s)}if(a=r,o=s,i)u=_[4],c=_[5];else{var f=e._handleOut;u=a+f._x,c=o+f._y}}for(var r,s,a,o,h,l,u,c,f=e._segments,d=f.length,_=new Array(6),g=!0,p=0;p<d;p++)n(f[p]);e._closed&&d>0&&n(f[0])}return{_draw:function(t,i,n,r){function s(t){return c[(t%f+f)%f]}var a=i.dontStart,o=i.dontFinish||i.clip,h=this.getStyle(),l=h.hasFill(),u=h.hasStroke(),c=h.getDashArray(),f=!paper.support.nativeDash&&u&&c&&c.length;if(a||t.beginPath(),(l||u&&!f||o)&&(e(t,this,r),this._closed&&t.closePath()),!o&&(l||u)&&(this._setStyles(t,i,n),l&&(t.fill(h.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),u)){if(f){a||t.beginPath();var d,_=new z(this,.25,32,!1,r),g=_.length,p=-h.getDashOffset(),v=0;for(p%=g;p>0;)p-=s(v--)+s(v--);for(;p<g;)d=p+s(v++),(p>0||d>0)&&_.drawPart(t,Math.max(p,0),Math.max(d,0)),p=d+s(v++)}t.stroke()}},_drawSelected:function(i,n){i.beginPath(),e(i,this,n),i.stroke(),t(i,this._segments,n,paper.settings.handleSize)}}},new function(){function t(t){var e=t._segments;if(0===e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new P(c.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new P(c.read(arguments))])},cubicCurveTo:function(){var e=c.read(arguments),i=c.read(arguments),n=c.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new P(n,i.subtract(n))])},quadraticCurveTo:function(){var e=c.read(arguments),i=c.read(arguments),n=t(this)._point;this.cubicCurveTo(e.add(n.subtract(e).multiply(1/3)),e.add(i.subtract(e).multiply(1/3)),i)},curveTo:function(){var e=c.read(arguments),i=c.read(arguments),n=r.pick(r.read(arguments),.5),s=1-n,a=t(this)._point,o=e.subtract(a.multiply(s*s)).subtract(i.multiply(n*n)).divide(2*n*s);if(o.isNaN())throw new Error("Cannot put a curve through points with parameter = "+n);this.quadraticCurveTo(o,i)},arcTo:function(){var e,i,n,s,a,o=t(this),h=o._point,u=c.read(arguments),f=r.peek(arguments),_=r.pick(f,!0);if("boolean"==typeof _)var g=h.add(u).divide(2),e=g.add(g.subtract(h).rotate(_?-90:90));else if(r.remain(arguments)<=2)e=u,u=c.read(arguments);else{var p=d.read(arguments),y=l.isZero;if(y(p.width)||y(p.height))return this.lineTo(u);var x=r.read(arguments),_=!!r.read(arguments),b=!!r.read(arguments),g=h.add(u).divide(2),w=h.subtract(g).rotate(-x),C=w.x,S=w.y,A=Math.abs,k=A(p.width),M=A(p.height),E=k*k,T=M*M,O=C*C,I=S*S,F=Math.sqrt(O/E+I/T);if(F>1&&(k*=F,M*=F,E=k*k,T=M*M),F=(E*T-E*I-T*O)/(E*I+T*O),A(F)<1e-12&&(F=0),F<0)throw new Error("Cannot create an arc with the given arguments");i=new c(k*S/M,-M*C/k).multiply((b===_?-1:1)*Math.sqrt(F)).rotate(x).add(g),a=(new v).translate(i).rotate(x).scale(k,M),s=a._inverseTransform(h),n=s.getDirectedAngle(a._inverseTransform(u)),!_&&n>0?n-=360:_&&n<0&&(n+=360)}if(e){var q=new m(h.add(e).divide(2),e.subtract(h).rotate(90),!0),z=new m(e.add(u).divide(2),u.subtract(e).rotate(90),!0),R=new m(h,u),L=R.getSide(e);if(i=q.intersect(z,!0),!i){if(!L)return this.lineTo(u);throw new Error("Cannot create an arc with the given arguments")}s=h.subtract(i),n=s.getDirectedAngle(u.subtract(i));var N=R.getSide(i);0===N?n=L*Math.abs(n):L===N&&(n+=n<0?360:-360)}for(var B=Math.abs(n),j=B>=360?4:Math.ceil(B/90),D=n/j,U=D*Math.PI/360,V=4/3*Math.sin(U)/(1+Math.cos(U)),G=[],H=0;H<=j;H++){var w=u,Z=null;if(H<j&&(Z=s.rotate(90).multiply(V),a?(w=a._transformPoint(s),Z=a._transformPoint(s.add(Z)).subtract(w)):w=i.add(s)),0===H)o.setHandleOut(Z);else{var W=s.rotate(-90).multiply(V);a&&(W=a._transformPoint(s.add(W)).subtract(w)),G.push(new P(w,W,Z))}s=s.rotate(D)}this._add(G)},lineBy:function(){var e=c.read(arguments),i=t(this)._point;this.lineTo(i.add(e))},curveBy:function(){var e=c.read(arguments),i=c.read(arguments),n=r.read(arguments),s=t(this)._point;this.curveTo(s.add(e),s.add(i),n)},cubicCurveBy:function(){var e=c.read(arguments),i=c.read(arguments),n=c.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(i),r.add(n))},quadraticCurveBy:function(){var e=c.read(arguments),i=c.read(arguments),n=t(this)._point;this.quadraticCurveTo(n.add(e),n.add(i))},arcBy:function(){var e=t(this)._point,i=e.add(c.read(arguments)),n=r.pick(r.peek(arguments),!0);"boolean"==typeof n?this.arcTo(i,n):this.arcTo(i,e.add(c.read(arguments)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}},{_getBounds:function(t,e){var i=e.handle?"getHandleBounds":e.stroke?"getStrokeBounds":"getBounds";return F[i](this._segments,this._closed,this,t,e)},statics:{getBounds:function(t,e,i,n,r,s){function a(t){t._transformCoordinates(n,h);for(var e=0;e<2;e++)T._addBounds(l[e],l[e+4],h[e+2],h[e],e,s?s[e]:0,u,c,f);var i=l;l=h,h=i}var o=t[0];if(!o)return new g;for(var h=new Array(6),l=o._transformCoordinates(n,new Array(6)),u=l.slice(0,2),c=u.slice(),f=new Array(2),d=1,_=t.length;d<_;d++)a(t[d]);return e&&a(o),new g(u[0],u[1],c[0]-u[0],c[1]-u[1])},getStrokeBounds:function(t,e,i,n,r){function s(t){p=p.include(t)}function a(t){p=p.unite(b.setCenter(t._point.transform(n)))}function o(t,e){var i=t._handleIn,r=t._handleOut;"round"===e||!i.isZero()&&!r.isZero()&&i.isCollinear(r)?a(t):F._addBevelJoin(t,e,v,x,n,f,s)}function h(t,e){"round"===e?a(t):F._addSquareCap(t,e,v,n,f,s)}var l=i.getStyle(),u=l.hasStroke(),c=l.getStrokeWidth(),f=u&&i._getStrokeMatrix(n,r),_=u&&F._getStrokePadding(c,f),p=F.getBounds(t,e,i,n,r,_);if(!u)return p;for(var v=c/2,m=l.getStrokeJoin(),y=l.getStrokeCap(),x=v*l.getMiterLimit(),b=new g(new d(_)),w=t.length-(e?0:1),C=1;C<w;C++)o(t[C],m);return e?o(t[0],m):w>0&&(h(t[0],y),h(t[t.length-1],y)),p},_getStrokePadding:function(t,e){if(!e)return[t,t];var i=new c(t,0).transform(e),n=new c(0,t).transform(e),r=i.getAngleInRadians(),s=i.getLength(),a=n.getLength(),o=Math.sin(r),h=Math.cos(r),l=Math.tan(r),u=Math.atan2(a*l,s),f=Math.atan2(a,l*s);
return[Math.abs(s*Math.cos(u)*h+a*Math.sin(u)*o),Math.abs(a*Math.sin(f)*h+s*Math.cos(f)*o)]},_addBevelJoin:function(t,e,i,n,r,s,a,o){var h=t.getCurve(),l=h.getPrevious(),u=h.getPointAtTime(0),f=l.getNormalAtTime(1),d=h.getNormalAtTime(0),_=f.getDirectedAngle(d)<0?-i:i;if(f.setLength(_),d.setLength(_),r&&r._transformPoint(u,u),s&&(s._transformPoint(f,f),s._transformPoint(d,d)),o&&(a(u),a(u.add(f))),"miter"===e){var g=new m(u.add(f),new c(-f.y,f.x),!0).intersect(new m(u.add(d),new c(-d.y,d.x),!0),!0);if(g&&u.getDistance(g)<=n&&(a(g),!o))return}o||a(u.add(f)),a(u.add(d))},_addSquareCap:function(t,e,i,n,r,s,a){var o=t._point,h=t.getLocation(),l=h.getNormal().multiply(i);n&&n._transformPoint(o,o),r&&r._transformPoint(l,l),a&&(s(o.subtract(l)),s(o.add(l))),"square"===e&&(o=o.add(l.rotate(0===h.getTime()?-90:90))),s(o.add(l)),s(o.subtract(l))},getHandleBounds:function(t,e,i,n,r){var s,a,o=i.getStyle(),h=r.stroke&&o.hasStroke();if(h){var l=i._getStrokeMatrix(n,r),u=o.getStrokeWidth()/2,c=u;"miter"===o.getStrokeJoin()&&(c=u*o.getMiterLimit()),"square"===o.getStrokeCap()&&(c=Math.max(c,u*Math.sqrt(2))),s=F._getStrokePadding(u,l),a=F._getStrokePadding(c,l)}for(var f=new Array(6),d=1/0,_=-d,p=d,v=_,m=0,y=t.length;m<y;m++){var x=t[m];x._transformCoordinates(n,f);for(var b=0;b<6;b+=2){var w=0===b?a:s,C=w?w[0]:0,S=w?w[1]:0,A=f[b],k=f[b+1],M=A-C,P=A+C,E=k-S,T=k+S;M<d&&(d=M),P>_&&(_=P),E<p&&(p=E),T>v&&(v=T)}}return new g(d,p,_-d,v-p)}}});F.inject({statics:new function(){function t(t,e,i){var n=r.getNamed(i),s=new F(n&&n.insert===!1&&x.NO_INSERT);return s._add(t),s._closed=e,s.set(n)}function e(e,i,r){for(var s=new Array(4),a=0;a<4;a++){var o=n[a];s[a]=new P(o._point.multiply(i).add(e),o._handleIn.multiply(i),o._handleOut.multiply(i))}return t(s,!0,r)}var i=.5522847498307936,n=[new P([-1,0],[0,i],[0,-i]),new P([0,-1],[-i,0],[i,0]),new P([1,0],[0,-i],[0,i]),new P([0,1],[i,0],[-i,0])];return{Line:function(){return t([new P(c.readNamed(arguments,"from")),new P(c.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var t=c.readNamed(arguments,"center"),i=r.readNamed(arguments,"radius");return e(t,new d(i),arguments)},Rectangle:function(){var e,n=g.readNamed(arguments,"rectangle"),r=d.readNamed(arguments,"radius",0,{readNull:!0}),s=n.getBottomLeft(!0),a=n.getTopLeft(!0),o=n.getTopRight(!0),h=n.getBottomRight(!0);if(!r||r.isZero())e=[new P(s),new P(a),new P(o),new P(h)];else{r=d.min(r,n.getSize(!0).divide(2));var l=r.width,u=r.height,c=l*i,f=u*i;e=[new P(s.add(l,0),null,[-c,0]),new P(s.subtract(0,u),[0,f]),new P(a.add(0,u),null,[0,-f]),new P(a.add(l,0),[-c,0],null),new P(o.subtract(l,0),null,[c,0]),new P(o.add(0,u),[0,-f],null),new P(h.subtract(0,u),null,[0,f]),new P(h.subtract(l,0),[c,0])]}return t(e,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=C._readEllipse(arguments);return e(t.center,t.radius,arguments)},Oval:"#Ellipse",Arc:function(){var t=c.readNamed(arguments,"from"),e=c.readNamed(arguments,"through"),i=c.readNamed(arguments,"to"),n=r.getNamed(arguments),s=new F(n&&n.insert===!1&&x.NO_INSERT);return s.moveTo(t),s.arcTo(e,i),s.set(n)},RegularPolygon:function(){for(var e=c.readNamed(arguments,"center"),i=r.readNamed(arguments,"sides"),n=r.readNamed(arguments,"radius"),s=360/i,a=i%3===0,o=new c(0,a?-n:n),h=a?-1:.5,l=new Array(i),u=0;u<i;u++)l[u]=new P(e.add(o.rotate((u+h)*s)));return t(l,!0,arguments)},Star:function(){for(var e=c.readNamed(arguments,"center"),i=2*r.readNamed(arguments,"points"),n=r.readNamed(arguments,"radius1"),s=r.readNamed(arguments,"radius2"),a=360/i,o=new c(0,-1),h=new Array(i),l=0;l<i;l++)h[l]=new P(e.add(o.rotate(a*l).multiply(l%2?s:n)));return t(h,!0,arguments)}}}});var q=I.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function t(i,n,r){for(var s=n.length-1;s>=0;s--){var a=n[s];a instanceof q&&(n=n.slice(),n.splice.apply(n,[s,1].concat(a.removeChildren())),a.remove())}n=t.base.call(this,i,n,r,F);for(var s=0,o=!r&&n&&n.length;s<o;s++){var a=n[s];a._clockwise===e&&a.setClockwise(0===a._index)}return n},reduce:function t(e){for(var i=this._children,n=i.length-1;n>=0;n--){var r=i[n].reduce(e);r.isEmpty()&&r.remove()}if(0===i.length){var r=new F(x.NO_INSERT);return r.copyAttributes(this),r.insertAbove(this),this.remove(),r}return t.base.call(this)},isClockwise:function(){var t=this.getFirstChild();return t&&t.isClockwise()},setClockwise:function(t){this.isClockwise()^!!t&&this.reverse()},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getFirstCurve()},getArea:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getArea();return e}},{beans:!0,getPathData:function(t,e){for(var i=this._children,n=[],r=0,s=i.length;r<s;r++){var a=i[r],o=a._matrix;n.push(a.getPathData(t&&!o.isIdentity()?t.appended(o):t,e))}return n.join(" ")}},{_hitTestChildren:function t(e,i,n){return t.base.call(this,e,i.class===F||"path"===i.type?i:r.set({},i,{fill:!1}),n)},_draw:function(t,e,i,n){var r=this._children;if(0!==r.length){e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var s=0,a=r.length;s<a;s++)r[s].draw(t,e,n);if(!e.clip){this._setStyles(t,e,i);var o=this._style;o.hasFill()&&(t.fill(o.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),o.hasStroke()&&t.stroke()}}},_drawSelected:function(t,e,i){for(var n=this._children,r=0,s=n.length;r<s;r++){var a=n[r],o=a._matrix;i[a._id]||a._drawSelected(t,o.isIdentity()?e:e.appended(o))}}},new function(){function t(t,e){var i=t._children;if(e&&0===i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}return r.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){this[e]=function(){var i=t(this,!0);i[e].apply(i,arguments)}},{moveTo:function(){var e=t(this),i=e&&e.isEmpty()?e:new F(x.NO_INSERT);i!==e&&this.addChild(i),i.moveTo.apply(i,arguments)},moveBy:function(){var e=t(this,!0),i=e&&e.getLastSegment(),n=c.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(e){t(this,!0).closePath(e)}})},r.each(["reverse","flatten","simplify","smooth"],function(t){this[t]=function(e){for(var i,n=this._children,r=0,s=n.length;r<s;r++)i=n[r][t](e)||i;return i}},{}));I.inject(new function(){function t(t,e){var i=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return e?i.resolveCrossings():i}function e(t,e,i,n,r){var s=new t(x.NO_INSERT);return s.addChildren(e,!0),i&&(s=s.reduce({simplify:!0})),s.insertAbove(r&&n.isSibling(r)&&n.getIndex()<r.getIndex()?r:n),s.copyAttributes(n,!0),s}function i(i,r,s){function o(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];g.push.apply(g,n._segments),p.push.apply(p,n._getMonoCurves()),n._overlapsOnly=n._validOverlapsOnly=!0}}var l=f[s];if(l[s]=!0,!i._children&&!i._closed)return n(i,r,l);var c=t(i,!0),d=r&&i!==r&&t(r,!0);d&&(l.subtract||l.exclude)^(d.isClockwise()^c.isClockwise())&&d.reverse();var _=a(O.expand(c.getCrossings(d))),g=[],p=[];o(c._children||[c]),d&&o(d._children||[d]);for(var v=0,m=_.length;v<m;v++)h(_[v]._segment,c,d,p,l);for(var v=0,m=g.length;v<m;v++){var y=g[v],x=y._intersection;if(null==y._winding&&h(y,c,d,p,l),!x||!x._overlap){var b=y._path;b._overlapsOnly=!1,l[y._winding]&&(b._validOverlapsOnly=!1)}}return e(q,u(g,l),!0,i,r)}function n(i,n,r){function s(t){if(o.contains(t.getPointAt(t.getLength()/2))^l)return u.unshift(t),!0}if(!n||!n._children&&!n._closed||!r.subtract&&!r.intersect)return null;for(var a=t(i,!1),o=t(n,!1),h=a.getCrossings(o),l=r.subtract,u=[],c=h.length-1;c>=0;c--){var f=h[c].split();f&&(s(f)&&f.getFirstSegment().setHandleIn(0,0),a.getLastSegment().setHandleOut(0,0))}return s(a),e(b,u,!1,i,n)}function s(t,e){for(var i=t;i;){if(i===e)return;i=i._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;t._next=e,e._previous=t}}function a(t,e){for(var i,n,r=e&&[],a=4e-7,o=1-a,h=!1,l=[],u=t.length-1;u>=0;u--){var c=t[u];if(e){if(!e(c))continue;r.unshift(c)}var f,d=c._curve,_=c._time,g=_;if(d!==i?h=!d.hasHandles():n>=a&&n<=o&&(_/=n),_<a)f=d._segment1;else if(_>o)f=d._segment2;else{var p=d.divideAtTime(_,!0);h&&l.push(d,p),f=p._segment1}c._setSegment(f);var v=f._intersection,m=c._intersection;if(v){s(v,m);for(var y=v;y;)s(y._intersection,v),y=y._next}else f._intersection=m;i=d,n=g}for(var u=0,x=l.length;u<x;u++)l[u].clearHandles();return r||t}function o(t,e,i){var n=2e-7,r=t.x,s=t.y,a=0,h=0,l=e.length,u=[],f=Math.abs;if(i){for(var d=-(1/0),_=1/0,g=s-n,p=s+n,v=0;v<l;v++)for(var m=e[v].values,y=T.solveCubic(m,0,r,u,0,1),x=y-1;x>=0;x--){var b=T.getPoint(m,u[x]).y;b<g&&b>d?d=b:b>p&&b<_&&(_=b)}d=(d+s)/2,_=(_+s)/2,d>-(1/0)&&(a=o(new c(r,d),e).winding),_<1/0&&(h=o(new c(r,_),e).winding)}else{for(var w,C,S=r-n,A=r+n,k=0,M=0,P=!1,v=0;v<l;v++){var E=e[v],O=E.winding,m=E.values,I=m[1],F=m[7];if(E.last&&(w=E.last.winding,C=E.last.values[6],P=!1),s>=I&&s<=F||s>=F&&s<=I)if(O){var q=s===I?m[0]:s===F?m[6]:1===T.solveCubic(m,1,s,u,0,1)?T.getPoint(m,u[0]).x:null;null!=q&&(q>=S&&q<=A?P=!0:s===I&&O===w||s===I&&(r-q)*(r-C)<0||(q<S?a+=O:q>A&&(h+=O))),w=O,C=m[6]}else(r-m[0])*(r-m[6])<=0&&(P=!0);P&&(v>=l-1||e[v+1].last)&&(k+=1,M-=1)}0===a&&0===h&&(a=k,h=M)}return{winding:Math.max(f(a),f(h)),contour:!a^!h}}function h(t,e,i,n,r){var s,a=[],h=t,l=0;do{var u=t.getCurve(),c=u.getLength();a.push({segment:t,curve:u,length:c}),l+=c,t=t.getNext()}while(t&&!t._intersection&&t!==h);for(var c=l/2,f=0,d=a.length;f<d;f++){var _=a[f],g=_.length;if(c<=g){var u=_.curve,p=u._path,v=p._parent,m=u.getTimeAt(c),y=u.getPointAtTime(m),x=Math.abs(u.getTangentAtTime(m).y)<1e-7;v instanceof q&&(p=v),s=r.subtract&&i&&(p===e&&i._getWinding(y,x)||p===i&&!e._getWinding(y,x))?{winding:0}:o(y,n,x);break}c-=g}for(var f=a.length-1;f>=0;f--){var b=a[f].segment;b._winding=s.winding,b._contour=s.contour}}function u(t,e){function i(t,i){return!(!t||t._visited||!(!e||e[t._winding]||!i&&e.unite&&t._contour))}function n(t){return t===a||t===o}function s(t,r){if(!t._next)return t;for(;t;){var s=t._segment,a=s.getNext(),o=a&&a._intersection;if(s!==r&&(n(s)||n(a)||!s._visited&&!a._visited&&(!e||i(s)&&(i(a)||o&&i(o._segment)))))return t;t=t._next}return null}for(var a,o,h=[],u=0,c=t.length;u<c;u++){var f,d=null,_=!1,g=t[u],p=g._intersection;if(!g._visited&&g._path._overlapsOnly){var v=g._path,m=p._segment._path,y=v._segments,b=m._segments;if(r.equals(y,b)){(e.unite||e.intersect)&&v.getArea()&&h.push(v.clone(!1));for(var w=0,C=y.length;w<C;w++)y[w]._visited=b[w]._visited=!0}}if(i(g,!0)&&(g._path._validOverlapsOnly||!p||!p._overlap)){for(a=o=null;;){p=p&&s(p,g)||p;var S=p&&p._segment;if(n(g)?_=!0:S&&(n(S)?(_=!0,g=S):i(S,i(g,!0))&&(e&&(e.intersect||e.subtract)&&(g._visited=!0),g=S)),_||g._visited){g._visited=!0;break}if(g._path._validOverlapsOnly&&!i(g))break;d||(d=new F(x.NO_INSERT),a=g,o=S);var A=g.getNext();d.add(new P(g._point,f,A&&g._handleOut)),g._visited=!0,g=A||g._path.getFirstSegment(),f=A&&A._handleIn,p=g._intersection}if(_)d.firstSegment.setHandleIn(f),d.setClosed(!0);else if(d){var k=d.getArea(!0);Math.abs(k)>=2e-7&&console.error("Boolean operation resulted in open path","segments =",d._segments.length,"length =",d.getLength(),"area=",k),d=null}d&&(d._segments.length>8||!l.isZero(d.getArea()))&&(h.push(d),d=null)}}return h}var f={unite:{1:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0}};return{_getWinding:function(t,e){return o(t,this._getMonoCurves(),e).winding},unite:function(t){return i(this,t,"unite")},intersect:function(t){return i(this,t,"intersect")},subtract:function(t){return i(this,t,"subtract")},exclude:function(t){return i(this,t,"exclude")},divide:function(t){return e(b,[this.subtract(t),this.intersect(t)],!0,this,t)},resolveCrossings:function(){function t(t){var e=t&&t._intersection;return e&&e._overlap}var e=this._children,i=e||[this],n=!1,s=!1,o=this.getIntersections(null,function(t){return t._overlap&&(n=!0)||t.isCrossing()&&(s=!0)});if(o=O.expand(o),n)for(var h=a(o,function(t){return t._overlap}),l=h.length-1;l>=0;l--){var c=h[l]._segment,f=c.getPrevious(),d=c.getNext();if(c._path&&t(f)&&t(d)){c.remove(),f._handleOut.set(0,0),d._handleIn.set(0,0);var _=f.getCurve();_.isStraight()&&0===_.getLength()&&f.remove()}}s&&(a(o,n&&function(t){var e=t.getCurve(),i=t._intersection._curve,n=t._segment;return!!(e&&i&&e._path&&i._path)||void(n&&(n._intersection=null))}),i=u(r.each(i,function(t){this.push.apply(this,t._segments)},[])));var g,p=i.length;if(p>1){i=i.slice().sort(function(t,e){return e.getBounds().getArea()-t.getBounds().getArea()});for(var v=i[0],m=[v],y={},b="nonzero"===this.getFillRule(),w=b&&r.each(i,function(t){this.push(t.isClockwise()?1:-1)},[]),l=1;l<p;l++){for(var C=i[l],S=C.getInteriorPoint(),A=!1,k=null,M=!1,P=l-1;P>=0&&!k;P--)if(i[P].contains(S)){if(b&&!A&&(w[l]+=w[P],w[l]&&w[P])){M=y[l]=!0;break}A=!0,k=!y[P]&&i[P]}M||(C.setClockwise(k?!k.isClockwise():v.isClockwise()),m.push(C))}i=m,p=m.length}return p>1&&e?(i!==e&&this.setChildren(i,!0),g=this):1!==p||e||(i[0]!==this&&this.setSegments(i[0].removeSegments()),g=this),g||(g=new q(x.NO_INSERT),g.addChildren(i,!0),g=g.reduce(),g.copyAttributes(this),this.replaceWith(g)),g}}}),F.inject({_getMonoCurves:function(){function t(t){var e=t[1],r=t[7],s=Math.abs((e-r)/(t[0]-t[6]))<2e-7?0:e>r?-1:1,a={values:t,winding:s};n.push(a),s&&(i=a)}function e(e){if(0!==T.getLength(e)){var i=e[1],n=e[3],r=e[5],s=e[7];if(T.isStraight(e)||i>=n==n>=r&&n>=r==r>=s)t(e);else{var a=3*(n-r)-i+s,o=2*(i+r)-4*n,h=n-i,u=4e-7,c=1-u,f=[],d=l.solveQuadratic(a,o,h,f,u,c);if(d<1)t(e);else{f.sort();var _=f[0],g=T.subdivide(e,_);t(g[0]),d>1&&(_=(f[1]-_)/(1-_),g=T.subdivide(g[1],_),t(g[0])),t(g[1])}}}}var i,n=this._monoCurves;if(!n){n=this._monoCurves=[];for(var r=this.getCurves(),s=this._segments,a=0,o=r.length;a<o;a++)e(r[a].getValues());if(!this._closed&&s.length>1){var h=s[s.length-1]._point,u=s[0]._point,c=h._x,f=h._y,d=u._x,_=u._y;e([c,f,c,f,d,_,d,_])}n.length>0&&(n[0].last=i)}return n},getInteriorPoint:function(){var t=this.getBounds(),e=t.getCenter(!0);if(!this.contains(e)){for(var i=this._getMonoCurves(),n=[],r=e.y,s=[],a=0,o=i.length;a<o;a++){var h=i[a].values;if(1===i[a].winding&&r>h[1]&&r<=h[7]||r>=h[7]&&r<h[1])for(var l=T.solveCubic(h,1,r,n,0,1),u=l-1;u>=0;u--)s.push(T.getPoint(h,n[u]).x)}s.sort(function(t,e){return t-e}),e.x=(s[0]+s[1])/2}return e}}),q.inject({_getMonoCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i]._getMonoCurves());return e}});var z=r.extend({_class:"PathIterator",initialize:function(t,e,i,n,r){function s(t,e){var i=T.getValues(t,e,r);h.push(i),a(i,t._index,0,1)}function a(t,i,r,s){if(!(s-r>c)||n&&T.isStraight(t)||T.isFlatEnough(t,e||.25)){var o=t[6]-t[0],h=t[7]-t[1],f=Math.sqrt(o*o+h*h);f>0&&(u+=f,l.push({offset:u,curve:t,index:i,time:s}))}else{var d=T.subdivide(t,.5),_=(r+s)/2;a(d[0],i,r,_),a(d[1],i,_,s)}}for(var o,h=[],l=[],u=0,c=1/(i||32),f=t._segments,d=f[0],_=1,g=f.length;_<g;_++)o=f[_],s(d,o),d=o;t._closed&&s(o,f[0]),this.curves=h,this.parts=l,this.length=u,this.index=0},_get:function(t){for(var e,i=this.index;e=i,!(0===i||this.parts[--i].offset<t););for(var n=this.parts.length;e<n;e++){var r=this.parts[e];if(r.offset>=t){this.index=e;var s=this.parts[e-1],a=s&&s.index===r.index?s.time:0,o=s?s.offset:0;return{index:r.index,time:a+(r.time-a)*(t-o)/(r.offset-o)}}}var r=this.parts[this.parts.length-1];return{index:r.index,time:1}},drawPart:function(t,e,i){for(var n=this._get(e),r=this._get(i),s=n.index,a=r.index;s<=a;s++){var o=T.getPart(this.curves[s],s===n.index?n.time:0,s===r.index?r.time:1);s===n.index&&t.moveTo(o[0],o[1]),t.bezierCurveTo.apply(t,o.slice(2))}}},r.each(T._evaluateMethods,function(t){this[t+"At"]=function(e){var i=this._get(e);return T[t](this.curves[i.index],i.time)}},{})),R=r.extend({initialize:function(t){for(var e,i=this.points=[],n=t._segments,r=t._closed,s=0,a=n.length;s<a;s++){var o=n[s].point;e&&e.equals(o)||i.push(e=o.clone())}r&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=r},fit:function(t){var e=this.points,i=e.length,n=null;return i>0&&(n=[new P(e[0])],i>1&&(this.fitCubic(n,t,0,i-1,e[1].subtract(e[0]),e[i-2].subtract(e[i-1])),this.closed&&(n.shift(),n.pop()))),n},fitCubic:function(t,e,i,n,r,s){var a=this.points;if(n-i===1){var o=a[i],h=a[n],l=o.getDistance(h)/3;return void this.addCurve(t,[o,o.add(r.normalize(l)),h.add(s.normalize(l)),h])}for(var u,c=this.chordLengthParameterize(i,n),f=Math.max(e,e*e),d=!0,_=0;_<=4;_++){var g=this.generateBezier(i,n,c,r,s),p=this.findMaxError(i,n,g,c);if(p.error<e&&d)return void this.addCurve(t,g);if(u=p.index,p.error>=f)break;d=this.reparameterize(i,n,c,g),f=p.error}var v=a[u-1].subtract(a[u+1]);this.fitCubic(t,e,i,u,r,v),this.fitCubic(t,e,u,n,v.negate(),s)},addCurve:function(t,e){var i=t[t.length-1];i.setHandleOut(e[1].subtract(e[0])),t.push(new P(e[3],e[2].subtract(e[3])))},generateBezier:function(t,e,i,n,r){for(var s=1e-12,a=Math.abs,o=this.points,h=o[t],l=o[e],u=[[0,0],[0,0]],c=[0,0],f=0,d=e-t+1;f<d;f++){var _=i[f],g=1-_,p=3*_*g,v=g*g*g,m=p*g,y=p*_,x=_*_*_,b=n.normalize(m),w=r.normalize(y),C=o[t+f].subtract(h.multiply(v+m)).subtract(l.multiply(y+x));u[0][0]+=b.dot(b),u[0][1]+=b.dot(w),u[1][0]=u[0][1],u[1][1]+=w.dot(w),c[0]+=b.dot(C),c[1]+=w.dot(C)}var S,A,k=u[0][0]*u[1][1]-u[1][0]*u[0][1];if(a(k)>s){var M=u[0][0]*c[1]-u[1][0]*c[0],P=c[0]*u[1][1]-c[1]*u[0][1];S=P/k,A=M/k}else{var E=u[0][0]+u[0][1],T=u[1][0]+u[1][1];S=A=a(E)>s?c[0]/E:a(T)>s?c[1]/T:0}var O,I,F=l.getDistance(h),q=s*F;if(S<q||A<q)S=A=F/3;else{var z=l.subtract(h);O=n.normalize(S),I=r.normalize(A),O.dot(z)-I.dot(z)>F*F&&(S=A=F/3,O=I=null)}return[h,h.add(O||n.normalize(S)),l.add(I||r.normalize(A)),l]},reparameterize:function(t,e,i,n){for(var r=t;r<=e;r++)i[r-t]=this.findRoot(n,this.points[r],i[r-t]);for(var r=1,s=i.length;r<s;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(t,e,i){for(var n=[],r=[],s=0;s<=2;s++)n[s]=t[s+1].subtract(t[s]).multiply(3);for(var s=0;s<=1;s++)r[s]=n[s+1].subtract(n[s]).multiply(2);var a=this.evaluate(3,t,i),o=this.evaluate(2,n,i),h=this.evaluate(1,r,i),l=a.subtract(e),u=o.dot(o)+l.dot(h);return Math.abs(u)<1e-6?i:i-l.dot(o)/u},evaluate:function(t,e,i){for(var n=e.slice(),r=1;r<=t;r++)for(var s=0;s<=t-r;s++)n[s]=n[s].multiply(1-i).add(n[s+1].multiply(i));return n[0]},chordLengthParameterize:function(t,e){for(var i=[0],n=t+1;n<=e;n++)i[n-t]=i[n-t-1]+this.points[n].getDistance(this.points[n-1]);for(var n=1,r=e-t;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(t,e,i,n){for(var r=Math.floor((e-t+1)/2),s=0,a=t+1;a<e;a++){var o=this.evaluate(3,i,n[a-t]),h=o.subtract(this.points[a]),l=h.x*h.x+h.y*h.y;l>=s&&(s=l,r=a)}return{error:s,index:r}}}),L=x.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(t){this._content="",this._lines=[];var i=t&&r.isPlainObject(t)&&t.x===e&&t.y===e;this._initialize(i&&t,!i&&c.read(arguments))},_equals:function(t){return this._content===t._content},copyContent:function(t){this.setContent(t._content)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),N=L.extend({_class:"PointText",initialize:function(){L.apply(this,arguments)},getPoint:function(){var t=this._matrix.getTranslation();return new f(t.x,t.y,this,"setPoint")},setPoint:function(){var t=c.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t,e,i){if(this._content){this._setStyles(t,e,i);var n=this._lines,r=this._style,s=r.hasFill(),a=r.hasStroke(),o=r.getLeading(),h=t.shadowColor;t.font=r.getFontStyle(),t.textAlign=r.getJustification();for(var l=0,u=n.length;l<u;l++){t.shadowColor=h;var c=n[l];s&&(t.fillText(c,0,0),t.shadowColor="rgba(0,0,0,0)"),a&&t.strokeText(c,0,0),t.translate(0,o)}}},_getBounds:function(t,e){var i=this._style,n=this._lines,r=n.length,s=i.getJustification(),a=i.getLeading(),o=this.getView().getTextWidth(i.getFontStyle(),n),h=0;"left"!==s&&(h-=o/("center"===s?2:1));var l=new g(h,r?-.75*a:0,o,r*a);return t?t._transformBounds(l,l):l}}),B=r.extend(new function(){function t(t){var n,r=t.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(r){n=[0,0,0];for(var s=0;s<3;s++){var o=r[s+1];n[s]=parseInt(1==o.length?o+o:o,16)/255}}else if(r=t.match(/^rgba?\((.*)\)$/)){n=r[1].split(",");for(var s=0,h=n.length;s<h;s++){var o=+n[s];n[s]=s<3?o/255:o}}else if(i){var l=a[t];if(!l){e||(e=tt.getContext(1,1),e.globalCompositeOperation="copy"),e.fillStyle="rgba(0,0,0,0)",e.fillStyle=t,e.fillRect(0,0,1,1);var u=e.getImageData(0,0,1,1).data;l=a[t]=[u[0]/255,u[1]/255,u[2]/255]}n=l.slice()}else n=[0,0,0];return n}var e,n={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},s={},a={},o=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],l={"rgb-hsb":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),s=n-r,a=0===s?0:60*(n==t?(e-i)/s+(e<i?6:0):n==e?(i-t)/s+2:(t-e)/s+4);return[a,0===n?0:s/n,n]},"hsb-rgb":function(t,e,i){t=(t/60%6+6)%6;var n=Math.floor(t),r=t-n,n=o[n],s=[i,i*(1-e),i*(1-e*r),i*(1-e*(1-r))];return[s[n[0]],s[n[1]],s[n[2]]]},"rgb-hsl":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),s=n-r,a=0===s,o=a?0:60*(n==t?(e-i)/s+(e<i?6:0):n==e?(i-t)/s+2:(t-e)/s+4),h=(n+r)/2,l=a?0:h<.5?s/(n+r):s/(2-n-r);return[o,l,h]},"hsl-rgb":function(t,e,i){if(t=(t/360%1+1)%1,0===e)return[i,i,i];for(var n=[t+1/3,t,t-1/3],r=i<.5?i*(1+e):i+e-i*e,s=2*i-r,a=[],o=0;o<3;o++){var h=n[o];h<0&&(h+=1),h>1&&(h-=1),a[o]=6*h<1?s+6*(r-s)*h:2*h<1?r:3*h<2?s+(r-s)*(2/3-h)*6:s}return a},"rgb-gray":function(t,e,i){return[.2989*t+.587*e+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return r.each(n,function(t,e){s[e]=[],r.each(t,function(t,i){var a=r.capitalize(t),o=/^(hue|saturation)$/.test(t),h=s[e][i]="gradient"===t?function(t){var e=this._components[0];return t=j.read(Array.isArray(t)?t:arguments,0,{readNull:!0}),e!==t&&(e&&e._removeOwner(this),t&&t._addOwner(this)),t}:"gradient"===e?function(){return c.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:t};this["get"+a]=function(){return this._type===e||o&&/^hs[bl]$/.test(this._type)?this._components[i]:this._convert(e)[i]},this["set"+a]=function(t){this._type===e||o&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(e),this._properties=n[e],this._type=e),this._components[i]=h.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function e(i){var r,a,o,h,l=Array.prototype.slice,u=arguments,c=this.__read,f=0;Array.isArray(i)&&(u=i,i=u[0]);var d=null!=i&&typeof i;if("string"===d&&i in n&&(r=i,i=u[1],Array.isArray(i)?(a=i,o=u[2]):(c&&(f=1),u=l.call(u,1),d=typeof i)),!a){if(h="number"===d?u:"object"===d&&null!=i.length?i:null){r||(r=h.length>=3?"rgb":"gray");var _=n[r].length;o=h[_],c&&(f+=h===arguments?_+(null!=o?1:0):1),h.length>_&&(h=l.call(h,0,_))}else if("string"===d)r="rgb",a=t(i),4===a.length&&(o=a[3],a.length--);else if("object"===d)if(i.constructor===e){if(r=i._type,a=i._components.slice(),o=i._alpha,"gradient"===r)for(var g=1,p=a.length;g<p;g++){var v=a[g];v&&(a[g]=v.clone())}}else if(i.constructor===j)r="gradient",h=u;else{r="hue"in i?"lightness"in i?"hsl":"hsb":"gradient"in i||"stops"in i||"radial"in i?"gradient":"gray"in i?"gray":"rgb";var m=n[r],y=s[r];this._components=a=[];for(var g=0,p=m.length;g<p;g++){var x=i[m[g]];null==x&&0===g&&"gradient"===r&&"stops"in i&&(x={stops:i.stops,radial:i.radial}),x=y[g].call(this,x),null!=x&&(a[g]=x)}o=i.alpha}c&&r&&(f=1)}if(this._type=r||"rgb",!a){this._components=a=[];for(var y=s[this._type],g=0,p=y.length;g<p;g++){var x=y[g].call(this,h&&h[g]);null!=x&&(a[g]=x)}}this._components=a,this._properties=n[this._type],this._alpha=o,c&&(this.__read=f)},_set:"#initialize",_serialize:function(t,e){var i=this.getComponents();return r.serialize(/^(gray|rgb)$/.test(this._type)?i:[this._type].concat(i),t,!0,e)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(65)},_convert:function(t){var e;return this._type===t?this._components.slice():(e=l[this._type+"-"+t])?e.apply(this,this._components):l["rgb-"+t].apply(this,l[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new B(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=n[t],this._type=t},getComponents:function(){var t=this._components.slice();return null!=this._alpha&&t.push(this._alpha),t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var e=r.isPlainValue(t,!0)?B.read(arguments):t;return e===this||e&&this._class===e._class&&this._type===e._type&&this._alpha===e._alpha&&r.equals(this._components,e._components)||!1},toString:function(){for(var t=this._properties,e=[],i="gradient"===this._type,n=h.instance,r=0,s=t.length;r<s;r++){var a=this._components[r];null!=a&&e.push(t[r]+": "+(i?a:n.number(a)))}return null!=this._alpha&&e.push("alpha: "+n.number(this._alpha)),"{ "+e.join(", ")+" }"},toCSS:function(t){function e(t){return Math.round(255*(t<0?0:t>1?1:t))}var i=this._convert("rgb"),n=t||null==this._alpha?1:this._alpha;return i=[e(i[0]),e(i[1]),e(i[2])],n<1&&i.push(n<0?0:n),t?"#"+((1<<24)+(i[0]<<16)+(i[1]<<8)+i[2]).toString(16).slice(1):(4==i.length?"rgba(":"rgb(")+i.join(",")+")"},toCanvasStyle:function(t){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var e,i=this._components,n=i[0],r=n._stops,s=i[1],a=i[2];if(n._radial){var o=a.getDistance(s),h=i[3];if(h){var l=h.subtract(s);l.getLength()>o&&(h=s.add(l.normalize(o-.1)))}var u=h||s;e=t.createRadialGradient(u.x,u.y,0,s.x,s.y,o)}else e=t.createLinearGradient(s.x,s.y,a.x,a.y);for(var c=0,f=r.length;c<f;c++){var d=r[c];e.addColorStop(d._offset||c/(f-1),d._color.toCanvasStyle())}return this._canvasStyle=e},transform:function(t){if("gradient"===this._type){for(var e=this._components,i=1,n=e.length;i<n;i++){var r=e[i];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:n,random:function(){var t=Math.random;return new B(t(),t(),t())}}})},new function(){var t={add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}};return r.each(t,function(t,e){this[e]=function(e){e=B.read(arguments);for(var i=this._type,n=this._components,r=e._convert(i),s=0,a=n.length;s<a;s++)r[s]=t(n[s],r[s]);return new B(i,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),j=r.extend({_class:"Gradient",initialize:function(t,e){this._id=u.get(),t&&this._set(t)&&(t=e=null),this._stops||this.setStops(t||["white","black"]),null==this._radial&&this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,e){return e.add(this,function(){return r.serialize([this._stops,this._radial],t,!0,e)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){this._owners||(this._owners=[]),this._owners.push(t)},_removeOwner:function(t){var i=this._owners?this._owners.indexOf(t):-1;i!=-1&&(this._owners.splice(i,1),0===this._owners.length&&(this._owners=e))},clone:function(){for(var t=[],e=0,i=this._stops.length;e<i;e++)t[e]=this._stops[e].clone();return new j(t,this._radial)},getStops:function(){return this._stops},setStops:function(t){if(t.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var i=this._stops;if(i)for(var n=0,r=i.length;n<r;n++)i[n]._owner=e;i=this._stops=D.readAll(t,0,{clone:!0});for(var n=0,r=i.length;n<r;n++)i[n]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class){var e=this._stops,i=t._stops,n=e.length;if(n===i.length){for(var r=0;r<n;r++)if(!e[r].equals(i[r]))return!1;return!0}}return!1}}),D=r.extend({_class:"GradientStop",initialize:function(t,i){var n=t,r=i;"object"==typeof t&&i===e&&(Array.isArray(t)&&"number"!=typeof t[0]?(n=t[0],r=t[1]):("color"in t||"offset"in t||"rampPoint"in t)&&(n=t.color,r=t.offset||t.rampPoint||0)),this.setColor(n),this.setOffset(r)},clone:function(){return new D(this._color.clone(),this._offset)},_serialize:function(t,e){var i=this._color,n=this._offset;return r.serialize(null==n?[i]:[i,n],t,!0,e)},_changed:function(){this._owner&&this._owner._changed(65)},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){var t=B.read(arguments,0,{clone:!0});t&&(t._owner=this),this._color=t,this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._offset==t._offset||!1}}),U=r.extend(new function(){var t={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new c,selectedColor:null},i=r.set({},t,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),n=r.set({},i,{fillColor:new B}),s={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},a={beans:!0},o={_class:"Style",beans:!0,initialize:function(e,r,s){this._values={},this._owner=r,this._project=r&&r._project||s||paper.project,this._defaults=!r||r instanceof b?i:r instanceof L?n:t,e&&this.set(e)}};return r.each(i,function(t,i){var n=/Color$/.test(i),h="shadowOffset"===i,l=r.capitalize(i),u=s[i],f="set"+l,d="get"+l;o[f]=function(t){var r=this._owner,s=r&&r._children;if(s&&s.length>0&&!(r instanceof q))for(var a=0,o=s.length;a<o;a++)s[a]._style[f](t);else if(i in this._defaults){var h=this._values[i];h!==t&&(n&&(h&&h._owner!==e&&(h._owner=e),t&&t.constructor===B&&(t._owner&&(t=t.clone()),t._owner=r)),this._values[i]=t,r&&r._changed(u||65))}},o[d]=function(t){var s,a=this._owner,o=a&&a._children;if(i in this._defaults&&(!o||0===o.length||t||a instanceof q)){var s=this._values[i];if(s===e)s=this._defaults[i],s&&s.clone&&(s=s.clone());else{var l=n?B:h?c:null;!l||s&&s.constructor===l||(this._values[i]=s=l.read([s],0,{readNull:!0,clone:!0}),s&&n&&(s._owner=a))}}else if(o)for(var u=0,f=o.length;u<f;u++){var _=o[u]._style[d]();if(0===u)s=_;else if(!r.equals(s,_))return e}return s},a[d]=function(t){return this._style[d](t)},a[f]=function(t){this._style[f](t)}}),r.each({Font:"FontFamily",WindingRule:"FillRule"},function(t,e){var i="get"+e,n="set"+e;o[i]=a[i]="#get"+t,o[n]=a[n]="#set"+t}),x.inject(a),o},{set:function(t){var e=t instanceof U,i=e?t._values:t;if(i)for(var n in i)if(n in this._defaults){var r=i[n];this[n]=r&&e&&r.clone?r.clone():r}},equals:function(t){return t===this||t&&this._class===t._class&&r.equals(this._values,t._values)||!1},hasFill:function(){var t=this.getFillColor();return!!t&&t.alpha>0},
hasStroke:function(){var t=this.getStrokeColor();return!!t&&t.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var t=this.getShadowColor();return!!t&&t.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var t=this.getFontSize();return this.getFontWeight()+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function t(){var e=t.base.call(this),i=this.getFontSize();return/pt|em|%|px/.test(i)&&(i=this.getView().getPixelSize(i)),null!=e?e:1.2*i}}),V=new function(){function t(t,e,i,n){for(var r=["","webkit","moz","Moz","ms","o"],s=e[0].toUpperCase()+e.substring(1),a=0;a<6;a++){var o=r[a],h=o?o+s:e;if(h in t){if(!i)return t[h];t[h]=n;break}}}return{getStyles:function(t){var e=t&&9!==t.nodeType?t.ownerDocument:t,i=e&&e.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(t,e){var i,n=t.ownerDocument,r=n.body,s=n.documentElement;try{i=t.getBoundingClientRect()}catch(t){i={left:0,top:0,width:0,height:0}}var a=i.left-(s.clientLeft||r.clientLeft||0),o=i.top-(s.clientTop||r.clientTop||0);if(!e){var h=n.defaultView;a+=h.pageXOffset||s.scrollLeft||r.scrollLeft,o+=h.pageYOffset||s.scrollTop||r.scrollTop}return new g(a,o,i.width,i.height)},getViewportBounds:function(t){var e=t.ownerDocument,i=e.defaultView,n=e.documentElement;return new g(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(t,e){return V.getBounds(t,e).getPoint()},getSize:function(t){return V.getBounds(t,!0).getSize()},isInvisible:function(t){return V.getSize(t).equals(new d(0,0))},isInView:function(t){return!V.isInvisible(t)&&V.getViewportBounds(t).intersects(V.getBounds(t,!0))},isInserted:function(t){return n.body.contains(t)},getPrefixed:function(e,i){return e&&t(e,i)},setPrefixed:function(e,i,n){if("object"==typeof i)for(var r in i)t(e,r,!0,i[r]);else t(e,i,!0,n)}}},G={add:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.addEventListener(r[s],n,!1)},remove:function(t,e){if(t)for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.removeEventListener(r[s],n,!1)},getPoint:function(t){var e=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new c(e.pageX||e.clientX+n.documentElement.scrollLeft,e.pageY||e.clientY+n.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return G.getPoint(t).subtract(V.getOffset(e||G.getTarget(t)))}};G.requestAnimationFrame=new function(){function t(){var e=s;s=[];for(var i=0,a=e.length;i<a;i++)e[i]();r=n&&s.length,r&&n(t)}var e,n=V.getPrefixed(i,"requestAnimationFrame"),r=!1,s=[];return function(i){s.push(i),n?r||(n(t),r=!0):e||(e=setInterval(t,1e3/60))}};var H=r.extend(s,{_class:"View",initialize:function t(e,r){function s(t){return r[t]||parseInt(r.getAttribute(t),10)}function o(){var t=V.getSize(r);return t.isNaN()||t.isZero()?new d(s("width"),s("height")):t}var h;if(i&&r){this._id=r.getAttribute("id"),null==this._id&&r.setAttribute("id",this._id="view-"+t._id++),G.add(r,this._viewEvents);var l="none";if(V.setPrefixed(r.style,{userDrag:l,userSelect:l,touchCallout:l,contentZooming:l,tapHighlightColor:"rgba(0,0,0,0)"}),a.hasAttribute(r,"resize")){var u=this;G.add(i,this._windowEvents={resize:function(){u.setViewSize(o())}})}if(h=o(),a.hasAttribute(r,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var c=this._stats.domElement,f=c.style,_=V.getOffset(r);f.position="absolute",f.left=_.x+"px",f.top=_.y+"px",n.body.appendChild(c)}}else h=new d(r),r=null;this._project=e,this._scope=e._scope,this._element=r,this._pixelRatio||(this._pixelRatio=i&&i.devicePixelRatio||1),this._setElementSize(h.width,h.height),this._viewSize=h,t._views.push(this),t._viewsById[this._id]=this,(this._matrix=new v)._owner=this,this._zoom=1,t._focused||(t._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!paper.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;H._focused===this&&(H._focused=null),H._views.splice(H._views.indexOf(this),1),delete H._viewsById[this._id];var t=this._project;return t._view===this&&(t._view=null),G.remove(this._element,this._viewEvents),G.remove(i,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:r.each(x._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(t){this[t]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(t){this._autoUpdate=t,t&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var t=this;G.requestAnimationFrame(function(){if(t._requested=!1,t._animate){t.requestUpdate();var e=t._element;V.getPrefixed(n,"hidden")&&"true"!==a.getAttribute(e,"keepalive")||!V.isInView(e)||t._handleFrame()}t._autoUpdate&&t.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){paper=this._scope;var t=Date.now()/1e3,e=this._last?t-this._last:0;this._last=t,this.emit("frame",new r({delta:e,time:this._time+=e,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(t,e){var i=this._frameItems;e?(i[t._id]={item:t,time:0,count:0},1===++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete i[t._id],0===--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(t){for(var e in this._frameItems){var i=this._frameItems[e];i.item.emit("frame",new r(t,{time:i.time+=t.delta,count:i.count++}))}},_changed:function(){this._project._changed(2049),this._bounds=null},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new _(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=d.read(arguments),e=t.width,i=t.height,n=t.subtract(this._viewSize);n.isZero()||(this._setElementSize(e,i),this._viewSize.set(e,i),this.emit("resize",{size:t,delta:n}),this._changed(),this._autoUpdate&&this.requestUpdate())},_setElementSize:function(t,e){var i=this._element;i&&(i.width!==t&&(i.width=t),i.height!==e&&(i.height=e))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new g(new c,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=c.read(arguments);this.translate(this.getCenter().subtract(t))},getZoom:function(){return this._zoom},setZoom:function(t){this.transform((new v).scale(t/this._zoom,this.getCenter())),this._zoom=t},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},isVisible:function(){return V.isInView(this._element)},isInserted:function(){return V.isInserted(this._element)},getPixelSize:function(t){var e,i=this._element;if(i){var r=i.parentNode,s=n.createElement("div");s.style.fontSize=t,r.appendChild(s),e=parseFloat(V.getStyles(s).fontSize),r.removeChild(s)}else e=parseFloat(e);return e},getTextWidth:function(t,e){return 0}},r.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var i=(e?r:c).read(arguments),n=c.read(arguments,0,{readNull:!0});return this.transform((new v)[t](i,n||this.getCenter(!0)))}},{translate:function(){var t=new v;return this.transform(t.translate.apply(t,arguments))},transform:function(t){this._matrix.append(t)},scrollBy:function(){this.translate(c.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(c.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(c.read(arguments))},getEventPoint:function(t){return this.viewToProject(G.getOffset(t,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){n&&"string"==typeof e&&(e=n.getElementById(e));var r=i?Z:H;return new r(t,e)}}},new function(){function t(t){var e=G.getTarget(t);return e.getAttribute&&H._viewsById[e.getAttribute("id")]}function e(){var t=H._focused;if(!t||!t.isVisible())for(var e=0,i=H._views.length;e<i;e++)if((t=H._views[e]).isVisible()){H._focused=h=t;break}}function r(t,e,i){t._handleMouseEvent("mousemove",e,i)}function s(t,e,i,n,r,s,a){function o(t,i){if(t.responds(i)){if(h||(h=new J(i,n,r,e||t,s?r.subtract(s):null)),t.emit(i,h)&&(k=!0,h.prevented&&(M=!0),h.stopped))return l=!0}else{var a=P[i];if(a)return o(t,a)}}for(var h,l=!1;t&&t!==a&&!o(t,i);)t=t._parent;return l}function a(t,e,i,n,r,a){return t._project.removeOn(i),M=k=!1,w&&s(w,null,i,n,r,a)||e&&e!==w&&!e.isDescendant(w)&&s(e,null,P[i]||i,n,r,a,w)||s(t,w||e||t,i,n,r,a)}if(i){var o,h,l,u,c,f=!1,d=!1,_=i.navigator;_.pointerEnabled||_.msPointerEnabled?(l="pointerdown MSPointerDown",u="pointermove MSPointerMove",c="pointerup pointercancel MSPointerUp MSPointerCancel"):(l="touchstart",u="touchmove",c="touchend touchcancel","ontouchstart"in i&&_.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(l+=" mousedown",u+=" mousemove",c+=" mouseup"));var g={},p={mouseout:function(t){var e=H._focused,i=G.getRelatedTarget(t);if(e&&(!i||"HTML"===i.nodeName)){var n=G.getOffset(t,e._element),s=n.x,a=Math.abs,o=a(s),h=1<<25,l=o-h;n.x=a(l)<o?l*(s<0?-1:1):s,r(e,t,e.viewToProject(n))}},scroll:e};g[l]=function(e){var i=H._focused=t(e);f||(f=!0,i._handleMouseEvent("mousedown",e))},p[u]=function(i){var n=H._focused;if(!d){var s=t(i);s?n!==s&&(n&&r(n,i),o||(o=n),n=H._focused=h=s):h&&h===n&&(o&&!o.isInserted()&&(o=null),n=H._focused=o,o=null,e())}n&&r(n,i)},p[l]=function(){d=!0},p[c]=function(t){var e=H._focused;e&&f&&e._handleMouseEvent("mouseup",t),d=f=!1},G.add(n,p),G.add(i,{load:e});var v,m,y,x,b,w,C,S,A,k=!1,M=!1,P={doubleclick:"click",mousedrag:"mousemove"},E=!1,T={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:g,_handleMouseEvent:function(t,e,i){function n(t){return r.virtual[t]||u.responds(t)||l&&l.responds(t)}var r=this._itemEvents,o=r.native[t],h="mousemove"===t,l=this._scope.tool,u=this;h&&f&&n("mousedrag")&&(t="mousedrag"),i||(i=this.getEventPoint(e));var c=this.getBounds().contains(i),d=o&&c&&u._project.hitTest(i,{tolerance:0,fill:!0,stroke:!0}),_=d&&d.item||null,g=!1,p={};p[t.substr(5)]=!0,o&&_!==b&&(b&&s(b,null,"mouseleave",e,i),_&&s(_,null,"mouseenter",e,i),b=_),E^c&&(s(this,null,c?"mouseenter":"mouseleave",e,i),v=c?this:null,g=!0),!c&&!p.drag||i.equals(y)||(a(this,_,h?t:"mousemove",e,i,y),g=!0),E=c,(p.down&&c||p.up&&m)&&(a(this,_,t,e,i,m),p.down?(A=_===C&&Date.now()-S<300,x=C=_,w=!M&&_,m=i):p.up&&(M||_!==x||(S=Date.now(),a(this,_,A?"doubleclick":"click",e,i,m),A=!1),x=w=null),E=!1,g=!0),y=i,g&&l&&(k=l._handleMouseEvent(t,e,i,p)||k),(k&&!p.move||p.down&&n("mouseup"))&&e.preventDefault()},_handleKeyEvent:function(t,e,i,n){function r(r){r.responds(t)&&(paper=a,r.emit(t,s=s||new X(t,e,i,n)))}var s,a=this._scope,o=a.tool;this.isVisible()&&(r(this),o&&o.responds(t)&&r(o))},_countItemEvent:function(t,e){var i=this._itemEvents,n=i.native,r=i.virtual;for(var s in T)n[s]=(n[s]||0)+(T[s][t]||0)*e;r[t]=(r[t]||0)+e},statics:{updateFocus:e}}}}),Z=H.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof i.HTMLCanvasElement)){var n=d.read(arguments,1);if(n.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+[].slice.call(arguments,1));e=tt.getCanvas(n)}var r=this._context=e.getContext("2d");if(r.save(),this._pixelRatio=1,!/^off|false$/.test(a.getAttribute(e,"hidpi"))){var s=i.devicePixelRatio||1,o=V.getPrefixed(r,"backingStorePixelRatio")||1;this._pixelRatio=s/o}H.call(this,t,e),this._needsUpdate=!0},remove:function t(){return this._context.restore(),t.base.call(this)},_setElementSize:function t(e,i){var n=this._pixelRatio;if(t.base.call(this,e*n,i*n),1!==n){var r=this._element,s=this._context;if(!a.hasAttribute(r,"resize")){var o=r.style;o.width=e+"px",o.height=i+"px"}s.restore(),s.save(),s.scale(n,n)}},getPixelSize:function t(e){var i,n=paper.agent;if(n&&n.firefox)i=t.base.call(this,e);else{var r=this._context,s=r.font;r.font=e+" serif",i=parseFloat(r.font),r.font=s}return i},getTextWidth:function(t,e){var i=this._context,n=i.font,r=0;i.font=t;for(var s=0,a=e.length;s<a;s++)r=Math.max(r,i.measureText(e[s]).width);return i.font=n,r},update:function(){if(!this._needsUpdate)return!1;var t=this._project,e=this._context,i=this._viewSize;return e.clearRect(0,0,i.width+1,i.height+1),t&&t.draw(e,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),W=r.extend({_class:"Event",initialize:function(t){this.event=t,this.type=t&&t.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return Y.modifiers}}),X=W.extend({_class:"KeyEvent",initialize:function(t,e,i,n){this.type=t,this.event=e,this.key=i,this.character=n},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),Y=new function(){function t(t){var e=t.key||t.keyIdentifier;return e=/^U\+/.test(e)?String.fromCharCode(parseInt(e.substr(2),16)):/^Arrow[A-Z]/.test(e)?e.substr(5):"Unidentified"===e?String.fromCharCode(t.keyCode):e,o[e]||(e.length>1?r.hyphenate(e):e.toLowerCase())}function e(t,i,n,a){var o,h=H._focused;if(l[i]=t,t?u[i]=n:delete u[i],i.length>1&&(o=r.camelize(i))in c){c[o]=t;var f=paper&&paper.agent;if("meta"===o&&f&&f.mac)if(t)s={};else{for(var d in s)d in u&&e(!1,d,s[d],a);s=null}}else t&&s&&(s[i]=n);h&&h._handleKeyEvent(t?"keydown":"keyup",a,i,n)}var s,a,o={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},h={tab:"\t",space:" ",enter:"\r"},l={},u={},c=new r({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var t=paper&&paper.agent;return t&&t.mac?this.meta:this.control}}});return G.add(n,{keydown:function(i){var n=t(i),r=paper&&paper.agent;n.length>1||r&&r.chrome&&(i.altKey||r.mac&&i.metaKey||!r.mac&&i.ctrlKey)?e(!0,n,h[n]||(n.length>1?"":n),i):a=n},keypress:function(i){if(a){var n=t(i),r=i.charCode,s=r>=32?String.fromCharCode(r):n.length>1?"":n;n!==a&&(n=s.toLowerCase()),e(!0,n,s,i),a=null}},keyup:function(i){var n=t(i);n in u&&e(!1,n,u[n],i)}}),G.add(i,{blur:function(t){for(var i in u)e(!1,i,u[i],t)}}),{modifiers:c,isDown:function(t){return!!l[t]}}},J=W.extend({_class:"MouseEvent",initialize:function(t,e,i,n,r){this.type=t,this.event=e,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),$=W.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,i){this.tool=t,this.type=e,this.event=i},_choosePoint:function(t,e){return t?t:e?e.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,i=e._parent;/^(Group|CompoundPath)$/.test(i._class);)e=i,i=i._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),K=o.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(t){o.call(this),this._moveCount=-1,this._downCount=-1,this._set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance&&(this._maxDistance=t)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance&&(this._minDistance=t)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_handleMouseEvent:function(t,e,i,n){function r(t,e){var r=i,s=a?c._point:c._downPoint||r;if(a){if(c._moveCount&&r.equals(s))return!1;if(s&&(null!=t||null!=e)){var o=r.subtract(s),h=o.getLength();if(h<(t||0))return!1;e&&(r=s.add(o.normalize(Math.min(h,e))))}c._moveCount++}return c._point=r,c._lastPoint=s||r,n.down&&(c._moveCount=-1,c._downPoint=r,c._downCount++),!0}function s(){o&&(u=c.emit(t,new $(c,t,e))||u)}paper=this._scope,n.drag&&!this.responds(t)&&(t="mousemove");var a=n.move||n.drag,o=this.responds(t),h=this.minDistance,l=this.maxDistance,u=!1,c=this;if(n.down)r(),s();else if(n.up)r(null,l),s();else if(o)for(;r(h,l);)s();return u}}),Q={request:function(t){var e=new i.XMLHttpRequest;return e.open((t.method||"get").toUpperCase(),t.url,r.pick(t.async,!0)),t.mimeType&&e.overrideMimeType(t.mimeType),e.onload=function(){var i=e.status;0===i||200===i?t.onLoad&&t.onLoad.call(e,e.responseText):e.onerror()},e.onerror=function(){var i=e.status,n='Could not load "'+t.url+'" (Status: '+i+")";if(!t.onError)throw new Error(n);t.onError(n,i)},e.send(null)}},tt={canvases:[],getCanvas:function(t,e){if(!i)return null;var r,s=!0;"object"==typeof t&&(e=t.height,t=t.width),this.canvases.length?r=this.canvases.pop():(r=n.createElement("canvas"),s=!1);var a=r.getContext("2d");if(!a)throw new Error("Canvas "+r+" is unable toprovide a 2D context.");return r.width===t&&r.height===e?s&&a.clearRect(0,0,t+1,e+1):(r.width=t,r.height=e),a.save(),r},getContext:function(t,e){var i=this.getCanvas(t,e);return i?i.getContext("2d"):null},release:function(t){var e=t&&t.canvas?t.canvas:t;e&&e.getContext&&(e.getContext("2d").restore(),this.canvases.push(e))}},et=new function(){function t(t,e,i){return.2989*t+.587*e+.114*i}function e(e,i,n,r){var s=r-t(e,i,n);d=e+s,_=i+s,g=n+s;var r=t(d,_,g),a=p(d,_,g),o=v(d,_,g);if(a<0){var h=r-a;d=r+(d-r)*r/h,_=r+(_-r)*r/h,g=r+(g-r)*r/h}if(o>255){var l=255-r,u=o-r;d=r+(d-r)*l/u,_=r+(_-r)*l/u,g=r+(g-r)*l/u}}function i(t,e,i){return v(t,e,i)-p(t,e,i)}function n(t,e,i,n){var r,s=[t,e,i],a=v(t,e,i),o=p(t,e,i);o=o===t?0:o===e?1:2,a=a===t?0:a===e?1:2,r=0===p(o,a)?1===v(o,a)?2:1:0,s[a]>s[o]?(s[r]=(s[r]-s[o])*n/(s[a]-s[o]),s[a]=n):s[r]=s[a]=0,s[o]=0,d=s[0],_=s[1],g=s[2]}var s,a,o,h,l,u,c,f,d,_,g,p=Math.min,v=Math.max,m=Math.abs,y={multiply:function(){d=l*s/255,_=u*a/255,g=c*o/255},screen:function(){d=l+s-l*s/255,_=u+a-u*a/255,g=c+o-c*o/255},overlay:function(){d=l<128?2*l*s/255:255-2*(255-l)*(255-s)/255,_=u<128?2*u*a/255:255-2*(255-u)*(255-a)/255,g=c<128?2*c*o/255:255-2*(255-c)*(255-o)/255},"soft-light":function(){var t=s*l/255;d=t+l*(255-(255-l)*(255-s)/255-t)/255,t=a*u/255,_=t+u*(255-(255-u)*(255-a)/255-t)/255,t=o*c/255,g=t+c*(255-(255-c)*(255-o)/255-t)/255},"hard-light":function(){d=s<128?2*s*l/255:255-2*(255-s)*(255-l)/255,_=a<128?2*a*u/255:255-2*(255-a)*(255-u)/255,g=o<128?2*o*c/255:255-2*(255-o)*(255-c)/255},"color-dodge":function(){d=0===l?0:255===s?255:p(255,255*l/(255-s)),_=0===u?0:255===a?255:p(255,255*u/(255-a)),g=0===c?0:255===o?255:p(255,255*c/(255-o))},"color-burn":function(){d=255===l?255:0===s?0:v(0,255-255*(255-l)/s),_=255===u?255:0===a?0:v(0,255-255*(255-u)/a),g=255===c?255:0===o?0:v(0,255-255*(255-c)/o)},darken:function(){d=l<s?l:s,_=u<a?u:a,g=c<o?c:o},lighten:function(){d=l>s?l:s,_=u>a?u:a,g=c>o?c:o},difference:function(){d=l-s,d<0&&(d=-d),_=u-a,_<0&&(_=-_),g=c-o,g<0&&(g=-g)},exclusion:function(){d=l+s*(255-l-l)/255,_=u+a*(255-u-u)/255,g=c+o*(255-c-c)/255},hue:function(){n(s,a,o,i(l,u,c)),e(d,_,g,t(l,u,c))},saturation:function(){n(l,u,c,i(s,a,o)),e(d,_,g,t(l,u,c))},luminosity:function(){e(l,u,c,t(s,a,o))},color:function(){e(s,a,o,t(l,u,c))},add:function(){d=p(l+s,255),_=p(u+a,255),g=p(c+o,255)},subtract:function(){d=v(l-s,0),_=v(u-a,0),g=v(c-o,0)},average:function(){d=(l+s)/2,_=(u+a)/2,g=(c+o)/2},negation:function(){d=255-m(255-s-l),_=255-m(255-a-u),g=255-m(255-o-c)}},x=this.nativeModes=r.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),b=tt.getContext(1,1);b&&(r.each(y,function(t,e){var i="darken"===e,n=!1;b.save();try{b.fillStyle=i?"#300":"#a00",b.fillRect(0,0,1,1),b.globalCompositeOperation=e,b.globalCompositeOperation===e&&(b.fillStyle=i?"#a00":"#300",b.fillRect(0,0,1,1),n=b.getImageData(0,0,1,1).data[0]!==i?170:51)}catch(t){}b.restore(),x[e]=n}),tt.release(b)),this.process=function(t,e,i,n,r){var p=e.canvas,v="normal"===t;if(v||x[t])i.save(),i.setTransform(1,0,0,1,0,0),i.globalAlpha=n,v||(i.globalCompositeOperation=t),i.drawImage(p,r.x,r.y),i.restore();else{var m=y[t];if(!m)return;for(var b=i.getImageData(r.x,r.y,p.width,p.height),w=b.data,C=e.getImageData(0,0,p.width,p.height).data,S=0,A=w.length;S<A;S+=4){s=C[S],l=w[S],a=C[S+1],u=w[S+1],o=C[S+2],c=w[S+2],h=C[S+3],f=w[S+3],m();var k=h*n/255,M=1-k;w[S]=k*d+M*l,w[S+1]=k*_+M*u,w[S+2]=k*g+M*c,w[S+3]=h*n+M*f}i.putImageData(b,r.x,r.y)}}},it=new function(){function t(t,e,s){return i(n.createElementNS(r,t),e,s)}function e(t,e){var i=o[e],n=i?t.getAttributeNS(i,e):t.getAttribute(e);return"null"===n?null:n}function i(t,e,i){for(var n in e){var r=e[n],s=o[n];"number"==typeof r&&i&&(r=i.number(r)),s?t.setAttributeNS(s,n,r):t.setAttribute(n,r)}return t}var r="http://www.w3.org/2000/svg",s="http://www.w3.org/2000/xmlns",a="http://www.w3.org/1999/xlink",o={href:a,xlink:s,xmlns:s+"/","xmlns:xlink":s+"/"};return{svg:r,xmlns:s,xlink:a,create:t,get:e,set:i}},nt=r.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,e){return!e&&(t instanceof I||t instanceof C||t instanceof L)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(t,e){var i=r.capitalize(e),n=t[2];this[e]={type:t[1],property:e,attribute:t[0],toSVG:n,fromSVG:n&&r.each(n,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+i,set:"set"+i}},{});return new function(){function t(t,e,i){var n=new r,s=t.getTranslation();if(e){t=t._shiftless();var a=t._inverseTransform(s);n[i?"cx":"x"]=a.x,n[i?"cy":"y"]=a.y,s=null}if(!t.isIdentity()){var o=t.decompose();if(o){var h=[],u=o.rotation,c=o.scaling,f=o.skewing;s&&!s.isZero()&&h.push("translate("+S.point(s)+")"),u&&h.push("rotate("+S.number(u)+")"),l.isZero(c.x-1)&&l.isZero(c.y-1)||h.push("scale("+S.point(c)+")"),f&&f.x&&h.push("skewX("+S.number(f.x)+")"),f&&f.y&&h.push("skewY("+S.number(f.y)+")"),n.transform=h.join(" ")}else n.transform="matrix("+t.getValues().join(",")+")"}return n}function e(e,i){for(var n=t(e._matrix),r=e._children,s=it.create("g",n,S),a=0,o=r.length;a<o;a++){var h=r[a],l=w(h,i);if(l)if(h.isClipMask()){var u=it.create("clipPath");u.appendChild(l),m(h,u,"clip"),it.set(s,{"clip-path":"url(#"+u.id+")"})}else s.appendChild(l)}return s}function n(e,i){var n=t(e._matrix,!0),r=e.getSize(),s=e.getImage();return n.x-=r.width/2,n.y-=r.height/2,n.width=r.width,n.height=r.height,n.href=i.embedImages===!1&&s&&s.src||e.toDataURL(),it.create("image",n,S)}function s(e,i){var n=i.matchShapes;if(n){var r=e.toShape(!1);if(r)return a(r,i)}var s,o=e._segments,h=o.length,l=t(e._matrix);if(n&&h>=2&&!e.hasHandles())if(h>2){s=e._closed?"polygon":"polyline";for(var u=[],c=0;c<h;c++)u.push(S.point(o[c]._point));l.points=u.join(" ")}else{s="line";var f=o[0]._point,d=o[1]._point;l.set({x1:f.x,y1:f.y,x2:d.x,y2:d.y})}else s="path",l.d=e.getPathData(null,i.precision);return it.create(s,l,S)}function a(e){var i=e._type,n=e._radius,r=t(e._matrix,!0,"rectangle"!==i);if("rectangle"===i){i="rect";var s=e._size,a=s.width,o=s.height;r.x-=a/2,r.y-=o/2,r.width=a,r.height=o,n.isZero()&&(n=null)}return n&&("circle"===i?r.r=n:(r.rx=n.width,r.ry=n.height)),it.create(i,r,S)}function o(e,i){var n=t(e._matrix),r=e.getPathData(null,i.precision);return r&&(n.d=r),it.create("path",n,S)}function c(e,i){var n=t(e._matrix,!0),r=e._definition,s=p(r,"symbol"),a=r._item,o=a.getBounds();return s||(s=it.create("symbol",{viewBox:S.rectangle(o)}),s.appendChild(w(a,i)),m(r,s,"symbol")),n.href="#"+s.id,n.x+=o.x,n.y+=o.y,n.width=o.width,n.height=o.height,n.overflow="visible",it.create("use",n,S)}function f(t){var e=p(t,"color");if(!e){var i,n=t.getGradient(),r=n._radial,s=t.getOrigin(),a=t.getDestination();if(r){i={cx:s.x,cy:s.y,r:s.getDistance(a)};var o=t.getHighlight();o&&(i.fx=o.x,i.fy=o.y)}else i={x1:s.x,y1:s.y,x2:a.x,y2:a.y};i.gradientUnits="userSpaceOnUse",e=it.create((r?"radial":"linear")+"Gradient",i,S);for(var h=n._stops,l=0,u=h.length;l<u;l++){var c=h[l],f=c._color,d=f.getAlpha();i={offset:c._offset||l/(u-1)},f&&(i["stop-color"]=f.toCSS(!0)),d<1&&(i["stop-opacity"]=d),e.appendChild(it.create("stop",i,S))}m(t,e,"color")}return"url(#"+e.id+")"}function d(e){var i=it.create("text",t(e._matrix,!0),S);return i.textContent=e._content,i}function _(t,e,i){var n={},s=!i&&t.getParent(),a=[];return null!=t._name&&(n.id=t._name),r.each(nt,function(e){var i=e.get,o=e.type,h=t[i]();if(e.exportFilter?e.exportFilter(t,h):!s||!r.equals(s[i](),h)){if("color"===o&&null!=h){var l=h.getAlpha();l<1&&(n[e.attribute+"-opacity"]=l)}"style"===o?a.push(e.attribute+": "+h):n[e.attribute]=null==h?"none":"color"===o?h.gradient?f(h,t):h.toCSS(!0):"array"===o?h.join(","):"lookup"===o?e.toSVG[h]:h}}),a.length&&(n.style=a.join(";")),1===n.opacity&&delete n.opacity,t._visible||(n.visibility="hidden"),it.set(e,n,S)}function p(t,e){A||(A={ids:{},svgs:{}});var i=t._id||t.__id||(t.__id=u.get("svg"));return t&&A.svgs[e+"-"+i]}function m(t,e,i){A||p();var n=A.ids[i]=(A.ids[i]||0)+1;e.id=i+"-"+n,A.svgs[i+"-"+(t._id||t.__id)]=e}function b(t,e){var n=t,r=null;if(A){n="svg"===t.nodeName.toLowerCase()&&t;for(var s in A.svgs)r||(n||(n=it.create("svg"),n.appendChild(t)),r=n.insertBefore(it.create("defs"),n.firstChild)),r.appendChild(A.svgs[s]);A=null}return e.asString?(new i.XMLSerializer).serializeToString(n):n}function w(t,e,i){var n=k[t._class],r=n&&n(t,e);if(r){var s=e.onExport;s&&(r=s(t,r,e)||r);var a=JSON.stringify(t._data);a&&"{}"!==a&&"null"!==a&&r.setAttribute("data-paper-data",a)}return r&&_(t,r,i)}function C(t){return t||(t={}),S=new h(t.precision),t}var S,A,k={Group:e,Layer:e,Raster:n,Path:s,Shape:a,CompoundPath:o,SymbolItem:c,PointText:d};x.inject({exportSVG:function(t){return t=C(t),b(w(this,t,!0),t)}}),y.inject({exportSVG:function(e){e=C(e);var i=this._children,n=this.getView(),s=r.pick(e.bounds,"view"),a=e.matrix||"view"===s&&n._matrix,o=a&&v.read([a]),h="view"===s?new g([0,0],n.getViewSize()):"content"===s?x._getBounds(i,o,{stroke:!0}):g.read([s],0,{readNull:!0}),l={version:"1.1",xmlns:it.svg,"xmlns:xlink":it.xlink};h&&(l.width=h.width,l.height=h.height,(h.x||h.y)&&(l.viewBox=S.rectangle(h)));var u=it.create("svg",l,S),c=u;o&&!o.isIdentity()&&(c=u.appendChild(it.create("g",t(o),S)));for(var f=0,d=i.length;f<d;f++)c.appendChild(w(i[f],e,!0));return b(u,e)}})},new function(){function t(t,e,i,n,r){var s=it.get(t,e),a=null==s?n?null:i?"":0:i?s:parseFloat(s);return/%\s*$/.test(s)?a/100*(r?1:E[/x|^width/.test(e)?"width":"height"]):a}function s(e,i,n,r,s){return i=t(e,i||"x",!1,r,s),n=t(e,n||"y",!1,r,s),!r||null!=i&&null!=n?new c(i,n):null}function a(e,i,n,r,s){return i=t(e,i||"width",!1,r,s),n=t(e,n||"height",!1,r,s),!r||null!=i&&null!=n?new d(i,n):null}function o(t,e,i){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?A(t)||t:"lookup"===e?i[t]:t}function h(t,e,i,n){var r=t.childNodes,s="clippath"===e,a="defs"===e,o=new b,h=o._project,l=h._currentStyle,u=[];if(s||a||(o=w(o,t,n),h._currentStyle=o._style.clone()),n)for(var c=t.querySelectorAll("defs"),f=0,d=c.length;f<d;f++)M(c[f],i,!1);for(var f=0,d=r.length;f<d;f++){var _,g=r[f];1!==g.nodeType||/^defs$/i.test(g.nodeName)||!(_=M(g,i,!1))||_ instanceof k||u.push(_)}return o.addChildren(u),s&&(o=w(o.reduce(),t,n)),h._currentStyle=l,(s||a)&&(o.remove(),o=null),o}function l(t,e){for(var i=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,s=i.length;r<s;r+=2)n.push(new c(parseFloat(i[r]),parseFloat(i[r+1])));var a=new F(n);return"polygon"===e&&a.closePath(),a}function u(t){return I.create(t.getAttribute("d"))}function f(e,i){var n,r=(t(e,"href",!0)||"").substring(1),a="radialgradient"===i;if(r)n=T[r].getGradient(),n._radial^a&&(n=n.clone(),n._radial=a);else{for(var o=e.childNodes,h=[],l=0,u=o.length;l<u;l++){var c=o[l];1===c.nodeType&&h.push(w(new D,c))}n=new j(h,a)}var f,d,_,g="userSpaceOnUse"!==t(e,"gradientUnits",!0);a?(f=s(e,"cx","cy",!1,g),d=f.add(t(e,"r",!1,!1,g),0),_=s(e,"fx","fy",!0,g)):(f=s(e,"x1","y1",!1,g),d=s(e,"x2","y2",!1,g));var p=w(new B(n,f,d,_),e);return p._scaleToBounds=g,null}function _(t,e,i,n){if(t.transform){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),s=new v,a=0,o=r.length;a<o;a++){var h=r[a];if(!h)break;for(var l=h.split(/\(\s*/),u=l[0],c=l[1].split(/[\s,]+/g),f=0,d=c.length;f<d;f++)c[f]=parseFloat(c[f]);switch(u){case"matrix":s.append(new v(c[0],c[1],c[2],c[3],c[4],c[5]));break;case"rotate":s.rotate(c[0],c[1],c[2]);break;case"translate":s.translate(c[0],c[1]);break;case"scale":s.scale(c);break;case"skewX":s.skew(c[0],0);break;case"skewY":s.skew(0,c[0])}}t.transform(s)}}function p(t,e,i){var n="fill-opacity"===i?"getFillColor":"getStrokeColor",r=t[n]&&t[n]();r&&r.setAlpha(parseFloat(e))}function m(t,i,n){var s=t.attributes[i],a=s&&s.value;if(!a){var o=r.camelize(i);a=t.style[o],a||n.node[o]===n.parent[o]||(a=n.node[o])}return a?"none"===a?null:a:e}function w(t,i,n){var s=i.parentNode,a={node:V.getStyles(i)||{},parent:!n&&!/^defs$/i.test(s.tagName)&&V.getStyles(s)||{}};return r.each(q,function(n,r){var s=m(i,r,a);t=s!==e&&n(t,s,r,i,a)||t}),t}function A(t){var e=t&&t.match(/\((?:["'#]*)([^"')]+)/),n=e&&T[e[1].replace(i.location.href.split("#")[0]+"#","")];return n&&n._scaleToBounds&&(n=n.clone(),n._scaleToBounds=!0),n}function M(t,e,i){var s,o,h,l=t.nodeName.toLowerCase(),u="#document"!==l,c=n.body;
i&&u&&(E=a(t,null,null,!0)||paper.getView().getSize(),s=it.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),o=t.parentNode,h=t.nextSibling,s.appendChild(t),c.appendChild(s));var f=paper.settings,d=f.applyMatrix,_=f.insertItems;f.applyMatrix=!1,f.insertItems=!1;var g=O[l],p=g&&g(t,l,e,i)||null;if(f.insertItems=_,f.applyMatrix=d,p){!u||p instanceof b||(p=w(p,t,i));var v=e.onImport,m=u&&t.getAttribute("data-paper-data");v&&(p=v(t,p,e)||p),e.expandShapes&&p instanceof C&&(p.remove(),p=p.toPath()),m&&(p._data=JSON.parse(m))}return s&&(c.removeChild(s),o&&(h?o.insertBefore(t,h):o.appendChild(t))),i&&(T={},p&&r.pick(e.applyMatrix,d)&&p.matrix.apply(!0,!0)),p}function P(t,r,s){function a(n){try{var a="object"==typeof n?n:(new i.DOMParser).parseFromString(n,"image/svg+xml");if(!a.nodeName)throw a=null,new Error("Unsupported SVG source: "+t);paper=h,l=M(a,r,!0),r&&r.insert===!1||s._insertItem(e,l);var u=r.onLoad;u&&u(l,n)}catch(t){o(t)}}function o(t,e){var i=r.onError;if(!i)throw new Error(t);i(t,e)}if(!t)return null;r="function"==typeof r?{onLoad:r}:r||{};var h=paper,l=null;if("string"!=typeof t||/^.*</.test(t)){if("undefined"!=typeof File&&t instanceof File){var u=new FileReader;return u.onload=function(){a(u.result)},u.onerror=function(){o(u.error)},u.readAsText(t)}a(t)}else{var c=n.getElementById(t);c?a(c):Q.request({url:t,async:!0,onLoad:a,onError:o})}return l}var E,T={},O={"#document":function(t,e,i,n){for(var r=t.childNodes,s=0,a=r.length;s<a;s++){var o=r[s];if(1===o.nodeType)return M(o,i,n)}},g:h,svg:h,clippath:h,polygon:l,polyline:l,path:u,lineargradient:f,radialgradient:f,image:function(e){var i=new S(t(e,"href",!0));return i.on("load",function(){var t=a(e);this.setSize(t);var i=this._matrix._transformPoint(s(e).add(t.divide(2)));this.translate(i)}),i},symbol:function(t,e,i,n){return new k(h(t,e,i,n),!0)},defs:h,use:function(e){var i=(t(e,"href",!0)||"").substring(1),n=T[i],r=s(e);return n?n instanceof k?n.place(r):n.clone().translate(r):null},circle:function(e){return new C.Circle(s(e,"cx","cy"),t(e,"r"))},ellipse:function(t){return new C.Ellipse({center:s(t,"cx","cy"),radius:a(t,"rx","ry")})},rect:function(t){return new C.Rectangle(new g(s(t),a(t)),a(t,"rx","ry"))},line:function(t){return new F.Line(s(t,"x1","y1"),s(t,"x2","y2"))},text:function(t){var e=new N(s(t).add(s(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e}},q=r.set(r.each(nt,function(t){this[t.attribute]=function(e,i){if(e[t.set]&&(e[t.set](o(i,t.type,t.fromSVG)),"color"===t.type)){var n=e[t.get]();if(n){if(n._scaleToBounds){var r=e.getBounds();n.transform((new v).translate(r.getPoint()).scale(r.getSize()))}e instanceof C&&n.transform((new v).translate(e.getPosition(!0).negate()))}}}},{}),{id:function(t,e){T[e]=t,t.setName&&t.setName(e)},"clip-path":function(t,e){var i=A(e);if(i){if(i=i.clone(),i.setClipMask(!0),!(t instanceof b))return new b(i,t);t.insertChild(0,i)}},gradientTransform:_,transform:_,"fill-opacity":p,"stroke-opacity":p,visibility:function(t,e){t.setVisible&&t.setVisible("visible"===e)},display:function(t,e){t.setVisible&&t.setVisible(null!==e)},"stop-color":function(t,e){t.setColor&&t.setColor(e)},"stop-opacity":function(t,e){t._color&&t._color.setAlpha(parseFloat(e))},offset:function(t,e){if(t.setOffset){var i=e.match(/(.*)%$/);t.setOffset(i?i[1]/100:parseFloat(e))}},viewBox:function(t,e,i,n,r){var s,h,l=new g(o(e,"array")),u=a(n,null,null,!0);if(t instanceof b){var c=u?u.divide(l.getSize()):1,h=(new v).scale(c).translate(l.getPoint().negate());s=t}else t instanceof k&&(u&&l.setSize(u),s=t._item);if(s){if("visible"!==m(n,"overflow",r)){var f=new C.Rectangle(l);f.setClipMask(!0),s.addChild(f)}h&&s.transform(h)}}});x.inject({importSVG:function(t,e){return P(t,e,this)}}),y.inject({importSVG:function(t,e){return this.activate(),P(t,e,this)}})},r.exports.PaperScript=function(){function t(t,e,i){var n=v[e];if(t&&t[n]){var r=t[n](i);return"!="===e?!r:r}switch(e){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i;case"%":return t%i;case"==":return t==i;case"!=":return t!=i}}function e(t,e){var i=m[t];if(i&&e&&e[i])return e[i]();switch(t){case"+":return+e;case"-":return-e}}function s(t,e){return p.acorn.parse(t,e)}function o(t,e){function r(t){for(var e=0,i=f.length;e<i;e++){var n=f[e];if(n[0]>=t)break;t+=n[1]}return t}function a(e){return t.substring(r(e.range[0]),r(e.range[1]))}function o(e,i){return t.substring(r(e.range[1]),r(i.range[0]))}function h(e,i){for(var n=r(e.range[0]),s=r(e.range[1]),a=0,o=f.length-1;o>=0;o--)if(n>f[o][0]){a=o+1;break}f.splice(a,0,[n,i.length-s+n]),t=t.substring(0,n)+i+t.substring(s)}function l(t,e){if(t){for(var i in t)if("range"!==i&&"loc"!==i){var n=t[i];if(Array.isArray(n))for(var r=0,s=n.length;r<s;r++)l(n[r],t);else n&&"object"==typeof n&&l(n,t)}switch(t.type){case"UnaryExpression":if(t.operator in m&&"Literal"!==t.argument.type){var u=a(t.argument);h(t,'$__("'+t.operator+'", '+u+")")}break;case"BinaryExpression":if(t.operator in v&&"Literal"!==t.left.type){var c=a(t.left),f=a(t.right),d=o(t.left,t.right),_=t.operator;h(t,"__$__("+c+","+d.replace(new RegExp("\\"+_),'"'+_+'"')+", "+f+")")}break;case"UpdateExpression":case"AssignmentExpression":var g=e&&e.type;if(!("ForStatement"===g||"BinaryExpression"===g&&/^[=!<>]/.test(e.operator)||"MemberExpression"===g&&e.computed))if("UpdateExpression"===t.type){var u=a(t.argument),p="__$__("+u+', "'+t.operator[0]+'", 1)',y=u+" = "+p;t.prefix||"AssignmentExpression"!==g&&"VariableDeclarator"!==g||(a(e.left||e.id)===u&&(y=p),y=u+"; "+y),h(t,y)}else if(/^.=$/.test(t.operator)&&"Literal"!==t.left.type){var c=a(t.left),f=a(t.right);h(t,c+" = __$__("+c+', "'+t.operator[0]+'", '+f+")")}}}}function u(t){var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(t=(Math.abs(t)<<1)+(t<0?1:0);t||!e;){var n=31&t;t>>=5,t&&(n|=32),e+=i[n]}return e}if(!t)return"";e=e||{};var c,f=[],d=e.url||"",_=paper.agent,g=_.versionNumber,p=!1,y=e.sourceMaps,x=e.source||t,b=/\r\n|\n|\r/gm,w=e.offset||0;if(y&&(_.chrome&&g>=30||_.webkit&&g>=537.76||_.firefox&&g>=23||_.node)){if(_.node)w-=2;else if(i&&d&&!i.location.href.indexOf(d)){var C=n.getElementsByTagName("html")[0].innerHTML;w=C.substr(0,C.indexOf(t)+1).match(b).length+1}p=w>0&&!(_.chrome&&g>=36||_.safari&&g>=600||_.firefox&&g>=40||_.node);var S=["AA"+u(p?0:w)+"A"];S.length=(t.match(b)||[]).length+1+(p?w:0),c={version:3,file:d,names:[],mappings:S.join(";AACA"),sourceRoot:"",sources:[d],sourcesContent:[x]}}return l(s(t,{ranges:!0})),c&&(p&&(t=new Array(w+1).join("\n")+t),/^(inline|both)$/.test(y)&&(t+="\n//# sourceMappingURL=data:application/json;base64,"+i.btoa(unescape(encodeURIComponent(JSON.stringify(c))))),t+="\n//# sourceURL="+(d||"paperscript")),{url:d,source:x,code:t,map:c}}function h(i,s,a){function h(t,e){for(var n in t)!e&&/^_/.test(n)||!new RegExp("([\\b\\s\\W]|^)"+n.replace(/\$/g,"\\$")+"\\b").test(i)||(g.push(n),p.push(t[n]))}paper=s;var l,u=s.getView(),f=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(i)&&!/\bnew\s+Tool\b/.test(i)?new K:null,d=f?f._events:[],_=["onFrame","onResize"].concat(d),g=[],p=[],v="object"==typeof i?i:o(i,a);i=v.code,h({__$__:t,$__:e,paper:s,view:u,tool:f},!0),h(s),_=r.each(_,function(t){new RegExp("\\s+"+t+"\\b").test(i)&&(g.push(t),this.push(t+": "+t))},[]).join(", "),_&&(i+="\nreturn { "+_+" };");var m=paper.agent;if(n&&(m.chrome||m.firefox&&m.versionNumber<40)){var y=n.createElement("script"),x=n.head||n.getElementsByTagName("head")[0];m.firefox&&(i="\n"+i),y.appendChild(n.createTextNode("paper._execute = function("+g+") {"+i+"\n}")),x.appendChild(y),l=paper._execute,delete paper._execute,x.removeChild(y)}else l=Function(g,i);var b=l.apply(s,p)||{};return r.each(d,function(t){var e=b[t];e&&(f[t]=e)}),u&&(b.onResize&&u.setOnResize(b.onResize),u.emit("resize",{size:u.size,delta:new c}),b.onFrame&&u.setOnFrame(b.onFrame),u.requestUpdate()),v}function l(t){if(/^text\/(?:x-|)paperscript$/.test(t.type)&&"true"!==a.getAttribute(t,"ignore")){var e=a.getAttribute(t,"canvas"),i=n.getElementById(e),r=t.src||t.getAttribute("data-src"),s=a.hasAttribute(t,"async"),o="data-paper-scope";if(!i)throw new Error('Unable to find canvas with id "'+e+'"');var l=a.get(i.getAttribute(o))||(new a).setup(i);return i.setAttribute(o,l._id),r?Q.request({url:r,async:s,mimeType:"text/plain",onLoad:function(t){h(t,l,r)}}):h(t.innerHTML,l,t.baseURI),t.setAttribute("data-paper-ignore","true"),l}}function u(){r.each(n&&n.getElementsByTagName("script"),l)}function f(t){return t?l(t):u()}var _,g,p=this;!function(t,e){return"object"==typeof _&&"object"==typeof module?e(_):"function"==typeof g&&g.amd?g(["exports"],e):void e(t.acorn||(t.acorn={}))}(this,function(t){"use strict";function e(t){ct=t||{};for(var e in gt)Object.prototype.hasOwnProperty.call(ct,e)||(ct[e]=gt[e]);_t=ct.sourceFile||null}function i(t,e){var i=pt(ft,t);e+=" ("+i.line+":"+i.column+")";var n=new SyntaxError(e);throw n.pos=t,n.loc=i,n.raisedAt=vt,n}function n(t){function e(t){if(1==t.length)return i+="return str === "+JSON.stringify(t[0])+";";i+="switch(str){";for(var e=0;e<t.length;++e)i+="case "+JSON.stringify(t[e])+":";i+="return true}return false;"}t=t.split(" ");var i="",n=[];t:for(var r=0;r<t.length;++r){for(var s=0;s<n.length;++s)if(n[s][0].length==t[r].length){n[s].push(t[r]);continue t}n.push([t[r]])}if(n.length>3){n.sort(function(t,e){return e.length-t.length}),i+="switch(str.length){";for(var r=0;r<n.length;++r){var a=n[r];i+="case "+a[0].length+":",e(a)}i+="}"}else e(t);return new Function("str",i)}function r(){this.line=At,this.column=vt-kt}function s(){At=1,vt=kt=0,St=!0,l()}function a(t,e){yt=vt,ct.locations&&(bt=new r),wt=t,l(),Ct=e,St=t.beforeExpr}function o(){var t=ct.onComment&&ct.locations&&new r,e=vt,n=ft.indexOf("*/",vt+=2);if(-1===n&&i(vt-2,"Unterminated comment"),vt=n+2,ct.locations){Je.lastIndex=e;for(var s;(s=Je.exec(ft))&&s.index<vt;)++At,kt=s.index+s[0].length}ct.onComment&&ct.onComment(!0,ft.slice(e+2,n),e,vt,t,ct.locations&&new r)}function h(){for(var t=vt,e=ct.onComment&&ct.locations&&new r,i=ft.charCodeAt(vt+=2);dt>vt&&10!==i&&13!==i&&8232!==i&&8233!==i;)++vt,i=ft.charCodeAt(vt);ct.onComment&&ct.onComment(!1,ft.slice(t+2,vt),t,vt,e,ct.locations&&new r)}function l(){for(;dt>vt;){var t=ft.charCodeAt(vt);if(32===t)++vt;else if(13===t){++vt;var e=ft.charCodeAt(vt);10===e&&++vt,ct.locations&&(++At,kt=vt)}else if(10===t||8232===t||8233===t)++vt,ct.locations&&(++At,kt=vt);else if(t>8&&14>t)++vt;else if(47===t){var e=ft.charCodeAt(vt+1);if(42===e)o();else{if(47!==e)break;h()}}else if(160===t)++vt;else{if(!(t>=5760&&Ge.test(String.fromCharCode(t))))break;++vt}}}function u(){var t=ft.charCodeAt(vt+1);return t>=48&&57>=t?S(!0):(++vt,a(xe))}function c(){var t=ft.charCodeAt(vt+1);return St?(++vt,b()):61===t?x(Se,2):x(we,1)}function f(){var t=ft.charCodeAt(vt+1);return 61===t?x(Se,2):x(Re,1)}function d(t){var e=ft.charCodeAt(vt+1);return e===t?x(124===t?Me:Pe,2):61===e?x(Se,2):x(124===t?Ee:Oe,1)}function _(){var t=ft.charCodeAt(vt+1);return 61===t?x(Se,2):x(Te,1)}function g(t){var e=ft.charCodeAt(vt+1);return e===t?45==e&&62==ft.charCodeAt(vt+2)&&Ye.test(ft.slice(Pt,vt))?(vt+=3,h(),l(),y()):x(Ae,2):61===e?x(Se,2):x(ze,1)}function p(t){var e=ft.charCodeAt(vt+1),i=1;return e===t?(i=62===t&&62===ft.charCodeAt(vt+2)?3:2,61===ft.charCodeAt(vt+i)?x(Se,i+1):x(qe,i)):33==e&&60==t&&45==ft.charCodeAt(vt+2)&&45==ft.charCodeAt(vt+3)?(vt+=4,h(),l(),y()):(61===e&&(i=61===ft.charCodeAt(vt+2)?3:2),x(Fe,i))}function v(t){var e=ft.charCodeAt(vt+1);return 61===e?x(Ie,61===ft.charCodeAt(vt+2)?3:2):x(61===t?Ce:ke,1)}function m(t){switch(t){case 46:return u();case 40:return++vt,a(ge);case 41:return++vt,a(pe);case 59:return++vt,a(me);case 44:return++vt,a(ve);case 91:return++vt,a(ce);case 93:return++vt,a(fe);case 123:return++vt,a(de);case 125:return++vt,a(_e);case 58:return++vt,a(ye);case 63:return++vt,a(be);case 48:var e=ft.charCodeAt(vt+1);if(120===e||88===e)return C();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return S(!1);case 34:case 39:return A(t);case 47:return c(t);case 37:case 42:return f();case 124:case 38:return d(t);case 94:return _();case 43:case 45:return g(t);case 60:case 62:return p(t);case 61:case 33:return v(t);case 126:return x(ke,1)}return!1}function y(t){if(t?vt=mt+1:mt=vt,ct.locations&&(xt=new r),t)return b();if(vt>=dt)return a(Nt);var e=ft.charCodeAt(vt);if($e(e)||92===e)return P();var n=m(e);if(n===!1){var s=String.fromCharCode(e);if("\\"===s||We.test(s))return P();i(vt,"Unexpected character '"+s+"'")}return n}function x(t,e){var i=ft.slice(vt,vt+e);vt+=e,a(t,i)}function b(){for(var t,e,n="",r=vt;;){vt>=dt&&i(r,"Unterminated regular expression");var s=ft.charAt(vt);if(Ye.test(s)&&i(r,"Unterminated regular expression"),t)t=!1;else{if("["===s)e=!0;else if("]"===s&&e)e=!1;else if("/"===s&&!e)break;t="\\"===s}++vt}var n=ft.slice(r,vt);++vt;var o=M();o&&!/^[gmsiy]*$/.test(o)&&i(r,"Invalid regexp flag");try{var h=new RegExp(n,o)}catch(t){t instanceof SyntaxError&&i(r,t.message),i(t)}return a(zt,h)}function w(t,e){for(var i=vt,n=0,r=0,s=null==e?1/0:e;s>r;++r){var a,o=ft.charCodeAt(vt);if(a=o>=97?o-97+10:o>=65?o-65+10:o>=48&&57>=o?o-48:1/0,a>=t)break;++vt,n=n*t+a}return vt===i||null!=e&&vt-i!==e?null:n}function C(){vt+=2;var t=w(16);return null==t&&i(mt+2,"Expected hexadecimal number"),$e(ft.charCodeAt(vt))&&i(vt,"Identifier directly after number"),a(qt,t)}function S(t){var e=vt,n=!1,r=48===ft.charCodeAt(vt);t||null!==w(10)||i(e,"Invalid number"),46===ft.charCodeAt(vt)&&(++vt,w(10),n=!0);var s=ft.charCodeAt(vt);69!==s&&101!==s||(s=ft.charCodeAt(++vt),43!==s&&45!==s||++vt,null===w(10)&&i(e,"Invalid number"),n=!0),$e(ft.charCodeAt(vt))&&i(vt,"Identifier directly after number");var o,h=ft.slice(e,vt);return n?o=parseFloat(h):r&&1!==h.length?/[89]/.test(h)||It?i(e,"Invalid number"):o=parseInt(h,8):o=parseInt(h,10),a(qt,o)}function A(t){vt++;for(var e="";;){vt>=dt&&i(mt,"Unterminated string constant");var n=ft.charCodeAt(vt);if(n===t)return++vt,a(Rt,e);if(92===n){n=ft.charCodeAt(++vt);var r=/^[0-7]+/.exec(ft.slice(vt,vt+3));for(r&&(r=r[0]);r&&parseInt(r,8)>255;)r=r.slice(0,-1);if("0"===r&&(r=null),++vt,r)It&&i(vt-2,"Octal literal in strict mode"),e+=String.fromCharCode(parseInt(r,8)),vt+=r.length-1;else switch(n){case 110:e+="\n";break;case 114:e+="\r";break;case 120:e+=String.fromCharCode(k(2));break;case 117:e+=String.fromCharCode(k(4));break;case 85:e+=String.fromCharCode(k(8));break;case 116:e+="\t";break;case 98:e+="\b";break;case 118:e+="\v";break;case 102:e+="\f";break;case 48:e+="\0";break;case 13:10===ft.charCodeAt(vt)&&++vt;case 10:ct.locations&&(kt=vt,++At);break;default:e+=String.fromCharCode(n)}}else 13!==n&&10!==n&&8232!==n&&8233!==n||i(mt,"Unterminated string constant"),e+=String.fromCharCode(n),++vt}}function k(t){var e=w(16,t);return null===e&&i(mt,"Bad character escape sequence"),e}function M(){Ne=!1;for(var t,e=!0,n=vt;;){var r=ft.charCodeAt(vt);if(Ke(r))Ne&&(t+=ft.charAt(vt)),++vt;else{if(92!==r)break;Ne||(t=ft.slice(n,vt)),Ne=!0,117!=ft.charCodeAt(++vt)&&i(vt,"Expecting Unicode escape sequence \\uXXXX"),++vt;var s=k(4),a=String.fromCharCode(s);a||i(vt-1,"Invalid Unicode escape"),(e?$e(s):Ke(s))||i(vt-4,"Invalid Unicode escape"),t+=a}e=!1}return Ne?t:ft.slice(n,vt)}function P(){var t=M(),e=Lt;return!Ne&&Ve(t)&&(e=ue[t]),a(e,t)}function E(){Mt=mt,Pt=yt,Et=bt,y()}function T(t){if(It=t,vt=mt,ct.locations)for(;kt>vt;)kt=ft.lastIndexOf("\n",kt-2)+1,--At;l(),y()}function O(){this.type=null,this.start=mt,this.end=null}function I(){this.start=xt,this.end=null,null!==_t&&(this.source=_t)}function F(){var t=new O;return ct.locations&&(t.loc=new I),ct.directSourceFile&&(t.sourceFile=ct.directSourceFile),ct.ranges&&(t.range=[mt,0]),t}function q(t){var e=new O;return e.start=t.start,ct.locations&&(e.loc=new I,e.loc.start=t.loc.start),ct.ranges&&(e.range=[t.range[0],0]),e}function z(t,e){return t.type=e,t.end=Pt,ct.locations&&(t.loc.end=Et),ct.ranges&&(t.range[1]=Pt),t}function R(t){return ct.ecmaVersion>=5&&"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"use strict"===t.expression.value}function L(t){return wt===t?(E(),!0):void 0}function N(){return!ct.strictSemicolons&&(wt===Nt||wt===_e||Ye.test(ft.slice(Pt,mt)))}function B(){L(me)||N()||D()}function j(t){wt===t?E():D()}function D(){i(mt,"Unexpected token")}function U(t){"Identifier"!==t.type&&"MemberExpression"!==t.type&&i(t.start,"Assigning to rvalue"),It&&"Identifier"===t.type&&Ue(t.name)&&i(t.start,"Assigning to "+t.name+" in strict mode")}function V(t){Mt=Pt=vt,ct.locations&&(Et=new r),Tt=It=null,Ot=[],y();var e=t||F(),i=!0;for(t||(e.body=[]);wt!==Nt;){var n=G();e.body.push(n),i&&R(n)&&T(!0),i=!1}return z(e,"Program")}function G(){(wt===we||wt===Se&&"/="==Ct)&&y(!0);var t=wt,e=F();switch(t){case Bt:case Ut:E();var n=t===Bt;L(me)||N()?e.label=null:wt!==Lt?D():(e.label=ut(),B());for(var r=0;r<Ot.length;++r){var s=Ot[r];if(null==e.label||s.name===e.label.name){if(null!=s.kind&&(n||"loop"===s.kind))break;if(e.label&&n)break}}return r===Ot.length&&i(e.start,"Unsyntactic "+t.keyword),z(e,n?"BreakStatement":"ContinueStatement");case Vt:return E(),B(),z(e,"DebuggerStatement");case Ht:return E(),Ot.push(Qe),e.body=G(),Ot.pop(),j(ie),e.test=H(),B(),z(e,"DoWhileStatement");case Xt:if(E(),Ot.push(Qe),j(ge),wt===me)return W(e,null);if(wt===ee){var a=F();return E(),Y(a,!0),z(a,"VariableDeclaration"),1===a.declarations.length&&L(le)?X(e,a):W(e,a)}var a=J(!1,!0);return L(le)?(U(a),X(e,a)):W(e,a);case Yt:return E(),ht(e,!0);case Jt:return E(),e.test=H(),e.consequent=G(),e.alternate=L(Zt)?G():null,z(e,"IfStatement");case $t:return Tt||ct.allowReturnOutsideFunction||i(mt,"'return' outside of function"),E(),L(me)||N()?e.argument=null:(e.argument=J(),B()),z(e,"ReturnStatement");case Kt:E(),e.discriminant=H(),e.cases=[],j(de),Ot.push(ti);for(var o,h;wt!=_e;)if(wt===jt||wt===Gt){var l=wt===jt;o&&z(o,"SwitchCase"),e.cases.push(o=F()),o.consequent=[],E(),l?o.test=J():(h&&i(Mt,"Multiple default clauses"),h=!0,o.test=null),j(ye)}else o||D(),o.consequent.push(G());return o&&z(o,"SwitchCase"),E(),Ot.pop(),z(e,"SwitchStatement");case Qt:return E(),Ye.test(ft.slice(Pt,mt))&&i(Pt,"Illegal newline after throw"),e.argument=J(),B(),z(e,"ThrowStatement");case te:if(E(),e.block=Z(),e.handler=null,wt===Dt){var u=F();E(),j(ge),u.param=ut(),It&&Ue(u.param.name)&&i(u.param.start,"Binding "+u.param.name+" in strict mode"),j(pe),u.guard=null,u.body=Z(),e.handler=z(u,"CatchClause")}return e.guardedHandlers=Ft,e.finalizer=L(Wt)?Z():null,e.handler||e.finalizer||i(e.start,"Missing catch or finally clause"),z(e,"TryStatement");case ee:return E(),Y(e),B(),z(e,"VariableDeclaration");case ie:return E(),e.test=H(),Ot.push(Qe),e.body=G(),Ot.pop(),z(e,"WhileStatement");case ne:return It&&i(mt,"'with' in strict mode"),E(),e.object=H(),e.body=G(),z(e,"WithStatement");case de:return Z();case me:return E(),z(e,"EmptyStatement");default:var c=Ct,f=J();if(t===Lt&&"Identifier"===f.type&&L(ye)){for(var r=0;r<Ot.length;++r)Ot[r].name===c&&i(f.start,"Label '"+c+"' is already declared");var d=wt.isLoop?"loop":wt===Kt?"switch":null;return Ot.push({name:c,kind:d}),e.body=G(),Ot.pop(),e.label=f,z(e,"LabeledStatement")}return e.expression=f,B(),z(e,"ExpressionStatement")}}function H(){j(ge);var t=J();return j(pe),t}function Z(t){var e,i=F(),n=!0,r=!1;for(i.body=[],j(de);!L(_e);){var s=G();i.body.push(s),n&&t&&R(s)&&(e=r,T(r=!0)),n=!1}return r&&!e&&T(!1),z(i,"BlockStatement")}function W(t,e){return t.init=e,j(me),t.test=wt===me?null:J(),j(me),t.update=wt===pe?null:J(),j(pe),t.body=G(),Ot.pop(),z(t,"ForStatement")}function X(t,e){return t.left=e,t.right=J(),j(pe),t.body=G(),Ot.pop(),z(t,"ForInStatement")}function Y(t,e){for(t.declarations=[],t.kind="var";;){var n=F();if(n.id=ut(),It&&Ue(n.id.name)&&i(n.id.start,"Binding "+n.id.name+" in strict mode"),n.init=L(Ce)?J(!0,e):null,t.declarations.push(z(n,"VariableDeclarator")),!L(ve))break}return t}function J(t,e){var i=$(e);if(!t&&wt===ve){var n=q(i);for(n.expressions=[i];L(ve);)n.expressions.push($(e));return z(n,"SequenceExpression")}return i}function $(t){var e=K(t);if(wt.isAssign){var i=q(e);return i.operator=Ct,i.left=e,E(),i.right=$(t),U(e),z(i,"AssignmentExpression")}return e}function K(t){var e=Q(t);if(L(be)){var i=q(e);return i.test=e,i.consequent=J(!0),j(ye),i.alternate=J(!0,t),z(i,"ConditionalExpression")}return e}function Q(t){return tt(et(),-1,t)}function tt(t,e,i){var n=wt.binop;if(null!=n&&(!i||wt!==le)&&n>e){var r=q(t);r.left=t,r.operator=Ct;var s=wt;E(),r.right=tt(et(),n,i);var a=z(r,s===Me||s===Pe?"LogicalExpression":"BinaryExpression");return tt(a,e,i)}return t}function et(){if(wt.prefix){var t=F(),e=wt.isUpdate;return t.operator=Ct,t.prefix=!0,St=!0,E(),t.argument=et(),e?U(t.argument):It&&"delete"===t.operator&&"Identifier"===t.argument.type&&i(t.start,"Deleting local variable in strict mode"),z(t,e?"UpdateExpression":"UnaryExpression")}for(var n=it();wt.postfix&&!N();){var t=q(n);t.operator=Ct,t.prefix=!1,t.argument=n,U(n),E(),n=z(t,"UpdateExpression")}return n}function it(){return nt(rt())}function nt(t,e){if(L(xe)){var i=q(t);return i.object=t,i.property=ut(!0),i.computed=!1,nt(z(i,"MemberExpression"),e)}if(L(ce)){var i=q(t);return i.object=t,i.property=J(),i.computed=!0,j(fe),nt(z(i,"MemberExpression"),e)}if(!e&&L(ge)){var i=q(t);return i.callee=t,i.arguments=lt(pe,!1),nt(z(i,"CallExpression"),e)}return t}function rt(){switch(wt){case se:var t=F();return E(),z(t,"ThisExpression");case Lt:return ut();case qt:case Rt:case zt:var t=F();return t.value=Ct,t.raw=ft.slice(mt,yt),E(),z(t,"Literal");case ae:case oe:case he:var t=F();return t.value=wt.atomValue,t.raw=wt.keyword,E(),z(t,"Literal");case ge:var e=xt,i=mt;E();var n=J();return n.start=i,n.end=yt,ct.locations&&(n.loc.start=e,n.loc.end=bt),ct.ranges&&(n.range=[i,yt]),j(pe),n;case ce:var t=F();return E(),t.elements=lt(fe,!0,!0),z(t,"ArrayExpression");case de:return at();case Yt:var t=F();return E(),ht(t,!1);case re:return st();default:D()}}function st(){var t=F();return E(),t.callee=nt(rt(),!0),L(ge)?t.arguments=lt(pe,!1):t.arguments=Ft,z(t,"NewExpression")}function at(){var t=F(),e=!0,n=!1;for(t.properties=[],E();!L(_e);){if(e)e=!1;else if(j(ve),ct.allowTrailingCommas&&L(_e))break;var r,s={key:ot()},a=!1;if(L(ye)?(s.value=J(!0),r=s.kind="init"):ct.ecmaVersion>=5&&"Identifier"===s.key.type&&("get"===s.key.name||"set"===s.key.name)?(a=n=!0,r=s.kind=s.key.name,s.key=ot(),wt!==ge&&D(),s.value=ht(F(),!1)):D(),"Identifier"===s.key.type&&(It||n))for(var o=0;o<t.properties.length;++o){var h=t.properties[o];if(h.key.name===s.key.name){var l=r==h.kind||a&&"init"===h.kind||"init"===r&&("get"===h.kind||"set"===h.kind);l&&!It&&"init"===r&&"init"===h.kind&&(l=!1),l&&i(s.key.start,"Redefinition of property")}}t.properties.push(s)}return z(t,"ObjectExpression")}function ot(){return wt===qt||wt===Rt?rt():ut(!0)}function ht(t,e){wt===Lt?t.id=ut():e?D():t.id=null,t.params=[];var n=!0;for(j(ge);!L(pe);)n?n=!1:j(ve),t.params.push(ut());var r=Tt,s=Ot;if(Tt=!0,Ot=[],t.body=Z(!0),Tt=r,Ot=s,It||t.body.body.length&&R(t.body.body[0]))for(var a=t.id?-1:0;a<t.params.length;++a){var o=0>a?t.id:t.params[a];if((De(o.name)||Ue(o.name))&&i(o.start,"Defining '"+o.name+"' in strict mode"),a>=0)for(var h=0;a>h;++h)o.name===t.params[h].name&&i(o.start,"Argument name clash in strict mode")}return z(t,e?"FunctionDeclaration":"FunctionExpression")}function lt(t,e,i){for(var n=[],r=!0;!L(t);){if(r)r=!1;else if(j(ve),e&&ct.allowTrailingCommas&&L(t))break;i&&wt===ve?n.push(null):n.push(J(!0))}return n}function ut(t){var e=F();return t&&"everywhere"==ct.forbidReserved&&(t=!1),wt===Lt?(!t&&(ct.forbidReserved&&(3===ct.ecmaVersion?Be:je)(Ct)||It&&De(Ct))&&-1==ft.slice(mt,yt).indexOf("\\")&&i(mt,"The keyword '"+Ct+"' is reserved"),e.name=Ct):t&&wt.keyword?e.name=wt.keyword:D(),St=!1,E(),z(e,"Identifier")}t.version="0.5.0";var ct,ft,dt,_t;t.parse=function(t,i){return ft=String(t),dt=ft.length,e(i),s(),V(ct.program)};var gt=t.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null},pt=t.getLineInfo=function(t,e){for(var i=1,n=0;;){Je.lastIndex=n;var r=Je.exec(t);if(!(r&&r.index<e))break;++i,n=r.index+r[0].length}return{line:i,column:e-n}};t.tokenize=function(t,i){function n(t){return Pt=yt,y(t),r.start=mt,r.end=yt,r.startLoc=xt,r.endLoc=bt,r.type=wt,r.value=Ct,r}ft=String(t),dt=ft.length,e(i),s();var r={};return n.jumpTo=function(t,e){if(vt=t,ct.locations){At=1,kt=Je.lastIndex=0;for(var i;(i=Je.exec(ft))&&i.index<t;)++At,kt=i.index+i[0].length}St=e,l()},n};var vt,mt,yt,xt,bt,wt,Ct,St,At,kt,Mt,Pt,Et,Tt,Ot,It,Ft=[],qt={type:"num"},zt={type:"regexp"},Rt={type:"string"},Lt={type:"name"},Nt={type:"eof"},Bt={keyword:"break"},jt={keyword:"case",beforeExpr:!0},Dt={keyword:"catch"},Ut={keyword:"continue"},Vt={keyword:"debugger"},Gt={keyword:"default"},Ht={keyword:"do",isLoop:!0},Zt={keyword:"else",beforeExpr:!0},Wt={keyword:"finally"},Xt={keyword:"for",isLoop:!0},Yt={keyword:"function"},Jt={keyword:"if"},$t={keyword:"return",beforeExpr:!0},Kt={keyword:"switch"},Qt={keyword:"throw",beforeExpr:!0},te={keyword:"try"},ee={keyword:"var"},ie={keyword:"while",isLoop:!0},ne={keyword:"with"},re={keyword:"new",beforeExpr:!0},se={keyword:"this"},ae={keyword:"null",atomValue:null},oe={keyword:"true",atomValue:!0},he={keyword:"false",atomValue:!1},le={keyword:"in",binop:7,beforeExpr:!0},ue={break:Bt,case:jt,catch:Dt,continue:Ut,debugger:Vt,default:Gt,do:Ht,else:Zt,finally:Wt,for:Xt,function:Yt,if:Jt,return:$t,switch:Kt,throw:Qt,try:te,var:ee,while:ie,with:ne,null:ae,true:oe,false:he,new:re,in:le,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:se,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},ce={type:"[",beforeExpr:!0},fe={type:"]"},de={type:"{",beforeExpr:!0},_e={type:"}"},ge={type:"(",beforeExpr:!0},pe={type:")"},ve={type:",",beforeExpr:!0},me={type:";",beforeExpr:!0},ye={type:":",beforeExpr:!0},xe={type:"."},be={type:"?",beforeExpr:!0},we={binop:10,beforeExpr:!0},Ce={isAssign:!0,beforeExpr:!0},Se={isAssign:!0,beforeExpr:!0},Ae={postfix:!0,prefix:!0,isUpdate:!0},ke={prefix:!0,beforeExpr:!0},Me={binop:1,beforeExpr:!0},Pe={binop:2,beforeExpr:!0},Ee={binop:3,beforeExpr:!0},Te={binop:4,beforeExpr:!0},Oe={binop:5,beforeExpr:!0},Ie={binop:6,beforeExpr:!0},Fe={binop:7,beforeExpr:!0},qe={binop:8,beforeExpr:!0},ze={binop:9,prefix:!0,beforeExpr:!0},Re={binop:10,beforeExpr:!0};t.tokTypes={bracketL:ce,bracketR:fe,braceL:de,braceR:_e,parenL:ge,parenR:pe,comma:ve,semi:me,colon:ye,dot:xe,question:be,slash:we,eq:Ce,name:Lt,eof:Nt,num:qt,regexp:zt,string:Rt};for(var Le in ue)t.tokTypes["_"+Le]=ue[Le];var Ne,Be=n("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),je=n("class enum extends super const export import"),De=n("implements interface let package private protected public static yield"),Ue=n("eval arguments"),Ve=n("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Ge=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,He="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Ze="------------------------------------------------------------------------------------------------------------------------------------------",We=new RegExp("["+He+"]"),Xe=new RegExp("["+He+Ze+"]"),Ye=/[\n\r\u2028\u2029]/,Je=/\r\n|[\n\r\u2028\u2029]/g,$e=t.isIdentifierStart=function(t){return 65>t?36===t:91>t||(97>t?95===t:123>t||t>=170&&We.test(String.fromCharCode(t)))},Ke=t.isIdentifierChar=function(t){return 48>t?36===t:58>t||!(65>t)&&(91>t||(97>t?95===t:123>t||t>=170&&Xe.test(String.fromCharCode(t))))},Qe={kind:"loop"},ti={kind:"switch"}});var v={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},m={"-":"__negate","+":null},y=r.each(["add","subtract","multiply","divide","modulo","equals","negate"],function(t){this["__"+t]="#"+t},{});return c.inject(y),d.inject(y),B.inject(y),i&&("complete"===n.readyState?setTimeout(u):G.add(i,{load:u})),{compile:o,execute:h,load:f,parse:s}}.call(this),paper=new(a.inject(r.exports,{enumerable:!0,Base:r,Numerical:l,Key:Y,DomEvent:G,DomElement:V,document:n,window:i,Symbol:k,PlacedSymbol:A})),paper.agent.node&&require("./node/extend")(paper),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&module&&(module.exports=paper),paper}.call(this,"object"==typeof self?self:null);(function(){function t(t){function e(e,i,n,r,s,a){for(;s>=0&&s<a;s+=t){var o=r?r[s]:s;n=i(n,e[o],o,e)}return n}return function(i,n,r,s){n=y(n,s,4);var a=!k(i)&&m.keys(i),o=(a||i).length,h=t>0?0:o-1;return arguments.length<3&&(r=i[a?a[h]:h],h+=t),e(i,n,r,a,h,o)}}function e(t){return function(e,i,n){i=x(i,n);for(var r=A(e),s=t>0?0:r-1;s>=0&&s<r;s+=t)if(i(e[s],s,e))return s;return-1}}function i(t,e,i){return function(n,r,s){var a=0,o=A(n);if("number"==typeof s)t>0?a=s>=0?s:Math.max(s+o,a):o=s>=0?Math.min(s+1,o):s+o+1;else if(i&&s&&o)return s=i(n,r),n[s]===r?s:-1;if(r!==r)return s=e(u.call(n,a,o),m.isNaN),s>=0?s+a:-1;for(s=t>0?a:o-1;s>=0&&s<o;s+=t)if(n[s]===r)return s;return-1}}function n(t,e){var i=O.length,n=t.constructor,r=m.isFunction(n)&&n.prototype||o,s="constructor";for(m.has(t,s)&&!m.contains(e,s)&&e.push(s);i--;)s=O[i],s in t&&t[s]!==r[s]&&!m.contains(e,s)&&e.push(s)}var r=this,s=r._,a=Array.prototype,o=Object.prototype,h=Function.prototype,l=a.push,u=a.slice,c=o.toString,f=o.hasOwnProperty,d=Array.isArray,_=Object.keys,g=h.bind,p=Object.create,v=function(){},m=function(t){return t instanceof m?t:this instanceof m?void(this._wrapped=t):new m(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=m),exports._=m):r._=m,m.VERSION="1.8.3";var y=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)};case 4:return function(i,n,r,s){return t.call(e,i,n,r,s)}}return function(){return t.apply(e,arguments)}},x=function(t,e,i){return null==t?m.identity:m.isFunction(t)?y(t,e,i):m.isObject(t)?m.matcher(t):m.property(t)};m.iteratee=function(t,e){return x(t,e,1/0)};var b=function(t,e){return function(i){var n=arguments.length;if(n<2||null==i)return i;for(var r=1;r<n;r++)for(var s=arguments[r],a=t(s),o=a.length,h=0;h<o;h++){var l=a[h];e&&void 0!==i[l]||(i[l]=s[l])}return i}},w=function(t){if(!m.isObject(t))return{};
if(p)return p(t);v.prototype=t;var e=new v;return v.prototype=null,e},C=function(t){return function(e){return null==e?void 0:e[t]}},S=Math.pow(2,53)-1,A=C("length"),k=function(t){var e=A(t);return"number"==typeof e&&e>=0&&e<=S};m.each=m.forEach=function(t,e,i){e=y(e,i);var n,r;if(k(t))for(n=0,r=t.length;n<r;n++)e(t[n],n,t);else{var s=m.keys(t);for(n=0,r=s.length;n<r;n++)e(t[s[n]],s[n],t)}return t},m.map=m.collect=function(t,e,i){e=x(e,i);for(var n=!k(t)&&m.keys(t),r=(n||t).length,s=Array(r),a=0;a<r;a++){var o=n?n[a]:a;s[a]=e(t[o],o,t)}return s},m.reduce=m.foldl=m.inject=t(1),m.reduceRight=m.foldr=t(-1),m.find=m.detect=function(t,e,i){var n;if(n=k(t)?m.findIndex(t,e,i):m.findKey(t,e,i),void 0!==n&&n!==-1)return t[n]},m.filter=m.select=function(t,e,i){var n=[];return e=x(e,i),m.each(t,function(t,i,r){e(t,i,r)&&n.push(t)}),n},m.reject=function(t,e,i){return m.filter(t,m.negate(x(e)),i)},m.every=m.all=function(t,e,i){e=x(e,i);for(var n=!k(t)&&m.keys(t),r=(n||t).length,s=0;s<r;s++){var a=n?n[s]:s;if(!e(t[a],a,t))return!1}return!0},m.some=m.any=function(t,e,i){e=x(e,i);for(var n=!k(t)&&m.keys(t),r=(n||t).length,s=0;s<r;s++){var a=n?n[s]:s;if(e(t[a],a,t))return!0}return!1},m.contains=m.includes=m.include=function(t,e,i,n){return k(t)||(t=m.values(t)),("number"!=typeof i||n)&&(i=0),m.indexOf(t,e,i)>=0},m.invoke=function(t,e){var i=u.call(arguments,2),n=m.isFunction(e);return m.map(t,function(t){var r=n?e:t[e];return null==r?r:r.apply(t,i)})},m.pluck=function(t,e){return m.map(t,m.property(e))},m.where=function(t,e){return m.filter(t,m.matcher(e))},m.findWhere=function(t,e){return m.find(t,m.matcher(e))},m.max=function(t,e,i){var n,r,s=-(1/0),a=-(1/0);if(null==e&&null!=t){t=k(t)?t:m.values(t);for(var o=0,h=t.length;o<h;o++)n=t[o],n>s&&(s=n)}else e=x(e,i),m.each(t,function(t,i,n){r=e(t,i,n),(r>a||r===-(1/0)&&s===-(1/0))&&(s=t,a=r)});return s},m.min=function(t,e,i){var n,r,s=1/0,a=1/0;if(null==e&&null!=t){t=k(t)?t:m.values(t);for(var o=0,h=t.length;o<h;o++)n=t[o],n<s&&(s=n)}else e=x(e,i),m.each(t,function(t,i,n){r=e(t,i,n),(r<a||r===1/0&&s===1/0)&&(s=t,a=r)});return s},m.shuffle=function(t){for(var e,i=k(t)?t:m.values(t),n=i.length,r=Array(n),s=0;s<n;s++)e=m.random(0,s),e!==s&&(r[s]=r[e]),r[e]=i[s];return r},m.sample=function(t,e,i){return null==e||i?(k(t)||(t=m.values(t)),t[m.random(t.length-1)]):m.shuffle(t).slice(0,Math.max(0,e))},m.sortBy=function(t,e,i){return e=x(e,i),m.pluck(m.map(t,function(t,i,n){return{value:t,index:i,criteria:e(t,i,n)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index}),"value")};var M=function(t){return function(e,i,n){var r={};return i=x(i,n),m.each(e,function(n,s){var a=i(n,s,e);t(r,n,a)}),r}};m.groupBy=M(function(t,e,i){m.has(t,i)?t[i].push(e):t[i]=[e]}),m.indexBy=M(function(t,e,i){t[i]=e}),m.countBy=M(function(t,e,i){m.has(t,i)?t[i]++:t[i]=1}),m.toArray=function(t){return t?m.isArray(t)?u.call(t):k(t)?m.map(t,m.identity):m.values(t):[]},m.size=function(t){return null==t?0:k(t)?t.length:m.keys(t).length},m.partition=function(t,e,i){e=x(e,i);var n=[],r=[];return m.each(t,function(t,i,s){(e(t,i,s)?n:r).push(t)}),[n,r]},m.first=m.head=m.take=function(t,e,i){if(null!=t)return null==e||i?t[0]:m.initial(t,t.length-e)},m.initial=function(t,e,i){return u.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},m.last=function(t,e,i){if(null!=t)return null==e||i?t[t.length-1]:m.rest(t,Math.max(0,t.length-e))},m.rest=m.tail=m.drop=function(t,e,i){return u.call(t,null==e||i?1:e)},m.compact=function(t){return m.filter(t,m.identity)};var P=function(t,e,i,n){for(var r=[],s=0,a=n||0,o=A(t);a<o;a++){var h=t[a];if(k(h)&&(m.isArray(h)||m.isArguments(h))){e||(h=P(h,e,i));var l=0,u=h.length;for(r.length+=u;l<u;)r[s++]=h[l++]}else i||(r[s++]=h)}return r};m.flatten=function(t,e){return P(t,e,!1)},m.without=function(t){return m.difference(t,u.call(arguments,1))},m.uniq=m.unique=function(t,e,i,n){m.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=x(i,n));for(var r=[],s=[],a=0,o=A(t);a<o;a++){var h=t[a],l=i?i(h,a,t):h;e?(a&&s===l||r.push(h),s=l):i?m.contains(s,l)||(s.push(l),r.push(h)):m.contains(r,h)||r.push(h)}return r},m.union=function(){return m.uniq(P(arguments,!0,!0))},m.intersection=function(t){for(var e=[],i=arguments.length,n=0,r=A(t);n<r;n++){var s=t[n];if(!m.contains(e,s)){for(var a=1;a<i&&m.contains(arguments[a],s);a++);a===i&&e.push(s)}}return e},m.difference=function(t){var e=P(arguments,!0,!0,1);return m.filter(t,function(t){return!m.contains(e,t)})},m.zip=function(){return m.unzip(arguments)},m.unzip=function(t){for(var e=t&&m.max(t,A).length||0,i=Array(e),n=0;n<e;n++)i[n]=m.pluck(t,n);return i},m.object=function(t,e){for(var i={},n=0,r=A(t);n<r;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},m.findIndex=e(1),m.findLastIndex=e(-1),m.sortedIndex=function(t,e,i,n){i=x(i,n,1);for(var r=i(e),s=0,a=A(t);s<a;){var o=Math.floor((s+a)/2);i(t[o])<r?s=o+1:a=o}return s},m.indexOf=i(1,m.findIndex,m.sortedIndex),m.lastIndexOf=i(-1,m.findLastIndex),m.range=function(t,e,i){null==e&&(e=t||0,t=0),i=i||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=Array(n),s=0;s<n;s++,t+=i)r[s]=t;return r};var E=function(t,e,i,n,r){if(!(n instanceof e))return t.apply(i,r);var s=w(t.prototype),a=t.apply(s,r);return m.isObject(a)?a:s};m.bind=function(t,e){if(g&&t.bind===g)return g.apply(t,u.call(arguments,1));if(!m.isFunction(t))throw new TypeError("Bind must be called on a function");var i=u.call(arguments,2),n=function(){return E(t,n,e,this,i.concat(u.call(arguments)))};return n},m.partial=function(t){var e=u.call(arguments,1),i=function(){for(var n=0,r=e.length,s=Array(r),a=0;a<r;a++)s[a]=e[a]===m?arguments[n++]:e[a];for(;n<arguments.length;)s.push(arguments[n++]);return E(t,i,this,this,s)};return i},m.bindAll=function(t){var e,i,n=arguments.length;if(n<=1)throw new Error("bindAll must be passed function names");for(e=1;e<n;e++)i=arguments[e],t[i]=m.bind(t[i],t);return t},m.memoize=function(t,e){var i=function(n){var r=i.cache,s=""+(e?e.apply(this,arguments):n);return m.has(r,s)||(r[s]=t.apply(this,arguments)),r[s]};return i.cache={},i},m.delay=function(t,e){var i=u.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},m.defer=m.partial(m.delay,m,1),m.throttle=function(t,e,i){var n,r,s,a=null,o=0;i||(i={});var h=function(){o=i.leading===!1?0:m.now(),a=null,s=t.apply(n,r),a||(n=r=null)};return function(){var l=m.now();o||i.leading!==!1||(o=l);var u=e-(l-o);return n=this,r=arguments,u<=0||u>e?(a&&(clearTimeout(a),a=null),o=l,s=t.apply(n,r),a||(n=r=null)):a||i.trailing===!1||(a=setTimeout(h,u)),s}},m.debounce=function(t,e,i){var n,r,s,a,o,h=function(){var l=m.now()-a;l<e&&l>=0?n=setTimeout(h,e-l):(n=null,i||(o=t.apply(s,r),n||(s=r=null)))};return function(){s=this,r=arguments,a=m.now();var l=i&&!n;return n||(n=setTimeout(h,e)),l&&(o=t.apply(s,r),s=r=null),o}},m.wrap=function(t,e){return m.partial(e,t)},m.negate=function(t){return function(){return!t.apply(this,arguments)}},m.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}},m.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},m.before=function(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}},m.once=m.partial(m.before,2);var T=!{toString:null}.propertyIsEnumerable("toString"),O=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];m.keys=function(t){if(!m.isObject(t))return[];if(_)return _(t);var e=[];for(var i in t)m.has(t,i)&&e.push(i);return T&&n(t,e),e},m.allKeys=function(t){if(!m.isObject(t))return[];var e=[];for(var i in t)e.push(i);return T&&n(t,e),e},m.values=function(t){for(var e=m.keys(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=t[e[r]];return n},m.mapObject=function(t,e,i){e=x(e,i);for(var n,r=m.keys(t),s=r.length,a={},o=0;o<s;o++)n=r[o],a[n]=e(t[n],n,t);return a},m.pairs=function(t){for(var e=m.keys(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=[e[r],t[e[r]]];return n},m.invert=function(t){for(var e={},i=m.keys(t),n=0,r=i.length;n<r;n++)e[t[i[n]]]=i[n];return e},m.functions=m.methods=function(t){var e=[];for(var i in t)m.isFunction(t[i])&&e.push(i);return e.sort()},m.extend=b(m.allKeys),m.extendOwn=m.assign=b(m.keys),m.findKey=function(t,e,i){e=x(e,i);for(var n,r=m.keys(t),s=0,a=r.length;s<a;s++)if(n=r[s],e(t[n],n,t))return n},m.pick=function(t,e,i){var n,r,s={},a=t;if(null==a)return s;m.isFunction(e)?(r=m.allKeys(a),n=y(e,i)):(r=P(arguments,!1,!1,1),n=function(t,e,i){return e in i},a=Object(a));for(var o=0,h=r.length;o<h;o++){var l=r[o],u=a[l];n(u,l,a)&&(s[l]=u)}return s},m.omit=function(t,e,i){if(m.isFunction(e))e=m.negate(e);else{var n=m.map(P(arguments,!1,!1,1),String);e=function(t,e){return!m.contains(n,e)}}return m.pick(t,e,i)},m.defaults=b(m.allKeys,!0),m.create=function(t,e){var i=w(t);return e&&m.extendOwn(i,e),i},m.clone=function(t){return m.isObject(t)?m.isArray(t)?t.slice():m.extend({},t):t},m.tap=function(t,e){return e(t),t},m.isMatch=function(t,e){var i=m.keys(e),n=i.length;if(null==t)return!n;for(var r=Object(t),s=0;s<n;s++){var a=i[s];if(e[a]!==r[a]||!(a in r))return!1}return!0};var I=function(t,e,i,n){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof m&&(t=t._wrapped),e instanceof m&&(e=e._wrapped);var r=c.call(t);if(r!==c.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var s="[object Array]"===r;if(!s){if("object"!=typeof t||"object"!=typeof e)return!1;var a=t.constructor,o=e.constructor;if(a!==o&&!(m.isFunction(a)&&a instanceof a&&m.isFunction(o)&&o instanceof o)&&"constructor"in t&&"constructor"in e)return!1}i=i||[],n=n||[];for(var h=i.length;h--;)if(i[h]===t)return n[h]===e;if(i.push(t),n.push(e),s){if(h=t.length,h!==e.length)return!1;for(;h--;)if(!I(t[h],e[h],i,n))return!1}else{var l,u=m.keys(t);if(h=u.length,m.keys(e).length!==h)return!1;for(;h--;)if(l=u[h],!m.has(e,l)||!I(t[l],e[l],i,n))return!1}return i.pop(),n.pop(),!0};m.isEqual=function(t,e){return I(t,e)},m.isEmpty=function(t){return null==t||(k(t)&&(m.isArray(t)||m.isString(t)||m.isArguments(t))?0===t.length:0===m.keys(t).length)},m.isElement=function(t){return!(!t||1!==t.nodeType)},m.isArray=d||function(t){return"[object Array]"===c.call(t)},m.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},m.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){m["is"+t]=function(e){return c.call(e)==="[object "+t+"]"}}),m.isArguments(arguments)||(m.isArguments=function(t){return m.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(m.isFunction=function(t){return"function"==typeof t||!1}),m.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},m.isNaN=function(t){return m.isNumber(t)&&t!==+t},m.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===c.call(t)},m.isNull=function(t){return null===t},m.isUndefined=function(t){return void 0===t},m.has=function(t,e){return null!=t&&f.call(t,e)},m.noConflict=function(){return r._=s,this},m.identity=function(t){return t},m.constant=function(t){return function(){return t}},m.noop=function(){},m.property=C,m.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},m.matcher=m.matches=function(t){return t=m.extendOwn({},t),function(e){return m.isMatch(e,t)}},m.times=function(t,e,i){var n=Array(Math.max(0,t));e=y(e,i,1);for(var r=0;r<t;r++)n[r]=e(r);return n},m.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},m.now=Date.now||function(){return(new Date).getTime()};var F={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},q=m.invert(F),z=function(t){var e=function(e){return t[e]},i="(?:"+m.keys(t).join("|")+")",n=RegExp(i),r=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(r,e):t}};m.escape=z(F),m.unescape=z(q),m.result=function(t,e,i){var n=null==t?void 0:t[e];return void 0===n&&(n=i),m.isFunction(n)?n.call(t):n};var R=0;m.uniqueId=function(t){var e=++R+"";return t?t+e:e},m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\u2028|\u2029/g,j=function(t){return"\\"+N[t]};m.template=function(t,e,i){!e&&i&&(e=i),e=m.defaults({},e,m.templateSettings);var n=RegExp([(e.escape||L).source,(e.interpolate||L).source,(e.evaluate||L).source].join("|")+"|$","g"),r=0,s="__p+='";t.replace(n,function(e,i,n,a,o){return s+=t.slice(r,o).replace(B,j),r=o+e.length,i?s+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?s+="'+\n((__t=("+n+"))==null?'':__t)+\n'":a&&(s+="';\n"+a+"\n__p+='"),e}),s+="';\n",e.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var a=new Function(e.variable||"obj","_",s)}catch(t){throw t.source=s,t}var o=function(t){return a.call(this,t,m)},h=e.variable||"obj";return o.source="function("+h+"){\n"+s+"}",o},m.chain=function(t){var e=m(t);return e._chain=!0,e};var D=function(t,e){return t._chain?m(e).chain():e};m.mixin=function(t){m.each(m.functions(t),function(e){var i=m[e]=t[e];m.prototype[e]=function(){var t=[this._wrapped];return l.apply(t,arguments),D(this,i.apply(m,t))}})},m.mixin(m),m.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=a[t];m.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],D(this,i)}}),m.each(["concat","join","slice"],function(t){var e=a[t];m.prototype[t]=function(){return D(this,e.apply(this._wrapped,arguments))}}),m.prototype.value=function(){return this._wrapped},m.prototype.valueOf=m.prototype.toJSON=m.prototype.value,m.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return m})}).call(this),function(){var t=this,e=t.Backbone||{};t.Backbone=e;var i=[],n=i.slice,r=function(t,e,i){var n,r=-1,s=e.length;switch(i.length){case 0:for(;++r<s;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<s;)(n=e[r]).callback.call(n.ctx,i[0]);return;case 2:for(;++r<s;)(n=e[r]).callback.call(n.ctx,i[0],i[1]);return;case 3:for(;++r<s;)(n=e[r]).callback.call(n.ctx,i[0],i[1],i[2]);return;default:for(;++r<s;)(n=e[r]).callback.apply(n.ctx,i)}},s=e.Events={on:function(t,e,i){this._events||(this._events={});var n=this._events[t]||(this._events[t]=[]);return n.push({callback:e,context:i,ctx:i||this}),this},once:function(t,e,i){var n=this,r=_.once(function(){n.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,i),this},off:function(t,e,i){var n,r,s,a,o,h,l,u;if(!this._events)return this;if(!t&&!e&&!i)return this._events={},this;for(a=t?[t]:_.keys(this._events),o=0,h=a.length;o<h;o++)if(t=a[o],n=this._events[t]){if(s=[],e||i)for(l=0,u=n.length;l<u;l++)r=n[l],(e&&e!==(r.callback._callback||r.callback)||i&&i!==r.context)&&s.push(r);this._events[t]=s}return this},trigger:function(t){if(!this._events)return this;var e=n.call(arguments,1),i=this._events[t],s=this._events.all;return i&&r(this,i,e),s&&r(this,s,arguments),this},listenTo:function(t,e,i){var n=this._listeners||(this._listeners={}),r=t._listenerId||(t._listenerId=_.uniqueId("l"));return n[r]=t,t.on(e,i||this,this),this},stopListening:function(t,e,i){var n=this._listeners;if(n){if(t)t.off(e,i,this),e||i||delete n[t._listenerId];else{for(var r in n)n[r].off(null,null,this);this._listeners={}}return this}}};s.bind=s.on,s.unbind=s.off,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Backbone=e):t.Backbone=e,"function"==typeof define&&define.amd&&define("backbone",[],function(){return e})}(),function(){function t(t,n){var r=(new Date).getTime(),s=Math.max(0,16-(r-i)),a=e.setTimeout(function(){t(r+s)},s);return i=r+s,a}for(var e=this,i=0,n=["ms","moz","webkit","o"],r=0;r<n.length&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[n[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=t),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(t){clearTimeout(t)}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e.requestAnimationFrame),exports.requestAnimationFrame=e.requestAnimationFrame):e.requestAnimationFrame=e.requestAnimationFrame,"function"==typeof define&&define.amd&&define("requestAnimationFrame",[],function(){return e.requestAnimationFrame})}(),function(t,e,i,n){function r(){var t=document.body.getBoundingClientRect(),e=this.width=t.width,i=this.height=t.height;this.renderer.setSize(e,i,this.ratio),this.trigger(y.Events.resize,e,i)}function s(){return(a.performance&&a.performance.now?a.performance:Date).now()}var a=this,o=Math.sin,h=Math.cos,l=Math.atan2,u=Math.sqrt,c=(Math.round,Math.abs,Math.PI),f=2*c,d=c/2,_=Math.pow,g=Math.min,p=Math.max,v=0,m={temp:document.createElement("div"),hasEventListeners:e.isFunction(a.addEventListener),bind:function(t,e,i,n){return this.hasEventListeners?t.addEventListener(e,i,!!n):t.attachEvent("on"+e,i),this},unbind:function(t,e,i,n){return this.hasEventListeners?t.removeEventListeners(e,i,!!n):t.detachEvent("on"+e,i),this}},y=a.Two=function(t){var i=e.defaults(t||{},{fullscreen:!1,width:640,height:480,type:y.Types.svg,autostart:!1});if(e.each(i,function(t,e){"fullscreen"!==e&&"width"!==e&&"height"!==e&&"autostart"!==e&&(this[e]=t)},this),e.isElement(i.domElement)){var n=i.domElement.tagName.toLowerCase();/^(CanvasRenderer-canvas|WebGLRenderer-canvas|SVGRenderer-svg)$/.test(this.type+"-"+n)||(this.type=y.Types[n])}if(this.renderer=new y[this.type](this),y.Utils.setPlaying.call(this,i.autostart),this.frameCount=0,i.fullscreen){var s=e.bind(r,this);e.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),e.extend(this.renderer.domElement.style,{display:"block",top:0,left:0,right:0,bottom:0,position:"fixed"}),m.bind(a,"resize",s),s()}else e.isElement(i.domElement)||(this.renderer.setSize(i.width,i.height,this.ratio),this.width=i.width,this.height=i.height);this.scene=this.renderer.scene,y.Instances.push(this)};e.extend(y,{Array:a.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Version:"v0.6.0",Identifier:"two_",Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change",remove:"remove",insert:"insert",order:"order"},Commands:{move:"M",line:"L",curve:"C",close:"Z"},Resolution:8,Instances:[],noConflict:function(){return a.Two=t,this},uniqueId:function(){var t=v;return v++,t},Utils:{defineProperty:function(t){var e=this,i="_"+t,n="_flag"+t.charAt(0).toUpperCase()+t.slice(1);Object.defineProperty(e,t,{get:function(){return this[i]},set:function(t){this[i]=t,this[n]=!0}})},release:function(t){e.isObject(t)&&(e.isFunction(t.unbind)&&t.unbind(),t.vertices&&(e.isFunction(t.vertices.unbind)&&t.vertices.unbind(),e.each(t.vertices,function(t){e.isFunction(t.unbind)&&t.unbind()})),t.children&&e.each(t.children,function(t){y.Utils.release(t)}))},xhr:function(t,e){var i=new XMLHttpRequest;return i.open("GET",t),i.onreadystatechange=function(){4===i.readyState&&200===i.status&&e(i.responseText)},i.send(),i},Curve:{CollinearityEpsilon:_(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:.25,angle:0,epsilon:.01},abscissas:[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],weights:[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]]},devicePixelRatio:a.devicePixelRatio||1,getBackingStoreRatio:function(t){return t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1},getRatio:function(t){return y.Utils.devicePixelRatio/A(t)},setPlaying:function(t){return this.playing=!!t,this},getComputedMatrix:function(t,i){i=i&&i.identity()||new y.Matrix;for(var n=t,r=[];n&&n._matrix;)r.push(n._matrix),n=n.parent;return r.reverse(),e.each(r,function(t){var e=t.elements;i.multiply(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9])}),i},deltaTransformPoint:function(t,e,i){var n=e*t.a+i*t.c+0,r=e*t.b+i*t.d+0;return new y.Vector(n,r)},decomposeMatrix:function(t){var e=y.Utils.deltaTransformPoint(t,0,1),i=y.Utils.deltaTransformPoint(t,1,0),n=180/Math.PI*Math.atan2(e.y,e.x)-90,r=180/Math.PI*Math.atan2(i.y,i.x);return{translateX:t.e,translateY:t.f,scaleX:Math.sqrt(t.a*t.a+t.b*t.b),scaleY:Math.sqrt(t.c*t.c+t.d*t.d),skewX:n,skewY:r,rotation:n}},applySvgAttributes:function(t,i){var n,r,s,a,o={},h={};if(getComputedStyle){var l=getComputedStyle(t);for(n=l.length;n--;)r=l[n],s=l[r],void 0!==s&&(h[r]=s)}for(n=t.attributes.length;n--;)a=t.attributes[n],o[a.nodeName]=a.value;e.isUndefined(h.opacity)||(h["stroke-opacity"]=h.opacity,h["fill-opacity"]=h.opacity),e.extend(h,o),h.visible=!(e.isUndefined(h.display)&&"none"===h.display)||e.isUndefined(h.visibility)&&"hidden"===h.visibility;for(r in h)switch(s=h[r],r){case"transform":if("none"===s)break;var u=t.getCTM();if(null===u)break;var c=y.Utils.decomposeMatrix(t.getCTM());i.translation.set(c.translateX,c.translateY),i.rotation=c.rotation,i.scale=c.scaleX,h.x&&(i.translation.x=h.x),h.y&&(i.translation.y=h.y);break;case"visible":i.visible=s;break;case"stroke-linecap":i.cap=s;break;case"stroke-linejoin":i.join=s;break;case"stroke-miterlimit":i.miter=s;break;case"stroke-width":i.linewidth=parseFloat(s);break;case"stroke-opacity":case"fill-opacity":case"opacity":i.opacity=parseFloat(s);break;case"fill":case"stroke":/url\(\#.*\)/i.test(s)?i[r]=this.getById(s.replace(/url\(\#(.*)\)/i,"$1")):i[r]="none"===s?"transparent":s;break;case"id":i.id=s;break;case"class":i.classList=s.split(" ")}return i},read:{svg:function(){return y.Utils.read.g.apply(this,arguments)},g:function(t){var e=new y.Group;y.Utils.applySvgAttributes.call(this,t,e);for(var i=0,n=t.childNodes.length;i<n;i++){var r=t.childNodes[i],s=r.nodeName;if(!s)return;var a=s.replace(/svg\:/gi,"").toLowerCase();if(a in y.Utils.read){var o=y.Utils.read[a].call(e,r);e.add(o)}}return e},polygon:function(t,e){var i=t.getAttribute("points"),n=[];i.replace(/(-?[\d\.?]+),(-?[\d\.?]+)/g,function(t,e,i){n.push(new y.Anchor(parseFloat(e),parseFloat(i)))});var r=new y.Path(n,!e).noStroke();return r.fill="black",y.Utils.applySvgAttributes.call(this,t,r)},polyline:function(t){return y.Utils.read.polygon.call(this,t,!0)},path:function(t){var i,n,r=t.getAttribute("d"),s=new y.Anchor,a=!1,o=!1,h=r.match(/[a-df-z][^a-df-z]*/gi),l=h.length-1;e.each(h.slice(0),function(t,e){var i,n=t[0],r=n.toLowerCase(),s=t.slice(1).trim().split(/[\s,]+|(?=\s?[+\-])/),a=[];switch(e<=0&&(h=[]),r){case"h":case"v":s.length>1&&(i=1);break;case"m":case"l":case"t":s.length>2&&(i=2);break;case"s":case"q":s.length>4&&(i=4);break;case"c":s.length>6&&(i=6);break;case"a":}if(i){for(var o=0,l=s.length,u=0;o<l;o+=i){var c=n;if(u>0)switch(n){case"m":c="l";break;case"M":c="L"}a.push([c].concat(s.slice(o,o+i)).join(" ")),u++}h=Array.prototype.concat.apply(h,a)}else h.push(t)});var u=e.flatten(e.map(h,function(t,r){var h,u,c,f=t[0],d=f.toLowerCase();n=t.slice(1).trim(),n=n.replace(/(-?\d+(?:\.\d*)?)[eE]([+\-]?\d+)/g,function(t,e,i){return parseFloat(e)*_(10,i)}),n=n.split(/[\s,]+|(?=\s?[+\-])/),o=f===d;var g,p,v,m,x,b,w,C,A;switch(d){case"z":r>=l?a=!0:(u=s.x,c=s.y,h=new y.Anchor(u,c,void 0,void 0,void 0,void 0,y.Commands.close));break;case"m":case"l":u=parseFloat(n[0]),c=parseFloat(n[1]),h=new y.Anchor(u,c,void 0,void 0,void 0,void 0,"m"===d?y.Commands.move:y.Commands.line),o&&h.addSelf(s),s=h;break;case"h":case"v":var k="h"===d?"x":"y",M="x"===k?"y":"x";h=new y.Anchor(void 0,void 0,void 0,void 0,void 0,void 0,y.Commands.line),h[k]=parseFloat(n[0]),h[M]=s[M],o&&(h[k]+=s[k]),s=h;break;case"c":case"s":g=s.x,p=s.y,i||(i=new y.Vector),"c"===d?(v=parseFloat(n[0]),m=parseFloat(n[1]),x=parseFloat(n[2]),b=parseFloat(n[3]),w=parseFloat(n[4]),C=parseFloat(n[5])):(A=P(s,i,o),v=A.x,m=A.y,x=parseFloat(n[0]),b=parseFloat(n[1]),w=parseFloat(n[2]),C=parseFloat(n[3])),o&&(v+=g,m+=p,x+=g,b+=p,w+=g,C+=p),e.isObject(s.controls)||y.Anchor.AppendCurveProperties(s),s.controls.right.set(v-s.x,m-s.y),h=new y.Anchor(w,C,x-w,b-C,void 0,void 0,y.Commands.curve),s=h,i=h.controls.left;break;case"t":case"q":g=s.x,p=s.y,i||(i=new y.Vector),i.isZero()?(v=g,m=p):(v=i.x,p=i.y),"q"===d?(x=parseFloat(n[0]),b=parseFloat(n[1]),w=parseFloat(n[1]),C=parseFloat(n[2])):(A=P(s,i,o),x=A.x,b=A.y,w=parseFloat(n[0]),C=parseFloat(n[1])),o&&(v+=g,m+=p,x+=g,b+=p,w+=g,C+=p),e.isObject(s.controls)||y.Anchor.AppendCurveProperties(s),s.controls.right.set(v-s.x,m-s.y),h=new y.Anchor(w,C,x-w,b-C,void 0,void 0,y.Commands.curve),s=h,i=h.controls.left;break;case"a":g=s.x,p=s.y;var E=parseFloat(n[0]),T=parseFloat(n[1]),O=parseFloat(n[2])*Math.PI/180,I=parseFloat(n[3]),F=parseFloat(n[4]);w=parseFloat(n[5]),C=parseFloat(n[6]),o&&(w+=g,C+=p);var q=(w-g)/2,z=(C-p)/2,R=q*Math.cos(O)+z*Math.sin(O),L=-q*Math.sin(O)+z*Math.cos(O),N=E*E,B=T*T,j=R*R,D=L*L,U=j/N+D/B;U>1&&(E*=Math.sqrt(U),T*=Math.sqrt(U));var V=Math.sqrt((N*B-N*D-B*j)/(N*D+B*j));e.isNaN(V)?V=0:I!=F&&V>0&&(V*=-1);var G=V*E*L/T,H=-V*T*R/E,Z=G*Math.cos(O)-H*Math.sin(O)+(g+w)/2,W=G*Math.sin(O)+H*Math.cos(O)+(p+C)/2,X=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},Y=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(X(t)*X(e))},k=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(Y(t,e))},J=k([1,0],[(R-G)/E,(L-H)/T]),$=[(R-G)/E,(L-H)/T],K=[(-R-G)/E,(-L-H)/T],Q=k($,K);Y($,K)<=-1&&(Q=Math.PI),Y($,K)>=1&&(Q=0),I&&(Q=S(Q,2*Math.PI)),F&&Q>0&&(Q-=2*Math.PI);var tt=y.Resolution,et=(new y.Matrix).translate(Z,W).rotate(O);h=e.map(e.range(tt),function(t){var e=1-t/(tt-1),i=e*Q+J,n=E*Math.cos(i),r=T*Math.sin(i),s=et.multiply(n,r,1);return new y.Anchor(s.x,s.y,!1,!1,!1,!1,y.Commands.line)}),h.push(new y.Anchor(w,C,!1,!1,!1,!1,y.Commands.line)),s=h[h.length-1],i=s.controls.left}return h}));if(!(u.length<=1)){u=e.compact(u);var c=new y.Path(u,a,void 0,!0).noStroke();return c.fill="black",y.Utils.applySvgAttributes.call(this,t,c)}},circle:function(t){var i=parseFloat(t.getAttribute("cx")),n=parseFloat(t.getAttribute("cy")),r=parseFloat(t.getAttribute("r")),s=y.Resolution,a=e.map(e.range(s),function(t){var e=t/s,i=e*f,n=r*h(i),a=r*o(i);return new y.Anchor(n,a)}),l=new y.Path(a,!0,!0).noStroke();return l.translation.set(i,n),l.fill="black",y.Utils.applySvgAttributes.call(this,t,l)},ellipse:function(t){var i=parseFloat(t.getAttribute("cx")),n=parseFloat(t.getAttribute("cy")),r=parseFloat(t.getAttribute("rx")),s=parseFloat(t.getAttribute("ry")),a=y.Resolution,l=e.map(e.range(a),function(t){var e=t/a,i=e*f,n=r*h(i),l=s*o(i);return new y.Anchor(n,l)}),u=new y.Path(l,!0,!0).noStroke();return u.translation.set(i,n),u.fill="black",y.Utils.applySvgAttributes.call(this,t,u)},rect:function(t){var e=parseFloat(t.getAttribute("x"))||0,i=parseFloat(t.getAttribute("y"))||0,n=parseFloat(t.getAttribute("width")),r=parseFloat(t.getAttribute("height")),s=n/2,a=r/2,o=[new y.Anchor(s,a),new y.Anchor(-s,a),new y.Anchor(-s,-a),new y.Anchor(s,-a)],h=new y.Path(o,!0).noStroke();return h.translation.set(e+s,i+a),h.fill="black",y.Utils.applySvgAttributes.call(this,t,h)},line:function(t){var e=parseFloat(t.getAttribute("x1")),i=parseFloat(t.getAttribute("y1")),n=parseFloat(t.getAttribute("x2")),r=parseFloat(t.getAttribute("y2")),s=n-e,a=r-i,o=s/2,h=a/2,l=[new y.Anchor(-o,-h),new y.Anchor(o,h)],u=new y.Path(l).noFill();return u.translation.set(e+o,i+h),y.Utils.applySvgAttributes.call(this,t,u)},lineargradient:function(t){for(var i=parseFloat(t.getAttribute("x1")),n=parseFloat(t.getAttribute("y1")),r=parseFloat(t.getAttribute("x2")),s=parseFloat(t.getAttribute("y2")),a=(r+i)/2,o=(s+n)/2,h=[],l=0;l<t.children.length;l++){var u=t.children[l],c=parseFloat(u.getAttribute("offset")),f=u.getAttribute("stop-color"),d=u.getAttribute("stop-opacity"),_=u.getAttribute("style");if(e.isNull(f)){var g=_.match(/stop\-color\:\s?([\#a-fA-F0-9]*)/);f=g&&g.length>1?g[1]:void 0}if(e.isNull(d)){var g=_.match(/stop\-opacity\:\s?([0-1\.\-]*)/);d=g&&g.length>1?parseFloat(g[1]):1}h.push(new y.Gradient.Stop(c,f,d))}var p=new y.LinearGradient(i-a,n-o,r-a,s-o,h);return y.Utils.applySvgAttributes.call(this,t,p)},radialgradient:function(t){var i=parseFloat(t.getAttribute("cx"))||0,n=parseFloat(t.getAttribute("cy"))||0,r=parseFloat(t.getAttribute("r")),s=parseFloat(t.getAttribute("fx")),a=parseFloat(t.getAttribute("fy"));e.isNaN(s)&&(s=i),e.isNaN(a)&&(a=n);for(var o=Math.abs(i+s)/2,h=Math.abs(n+a)/2,l=[],u=0;u<t.children.length;u++){var c=t.children[u],f=parseFloat(c.getAttribute("offset")),d=c.getAttribute("stop-color"),_=c.getAttribute("stop-opacity"),g=c.getAttribute("style");if(e.isNull(d)){var p=g.match(/stop\-color\:\s?([\#a-fA-F0-9]*)/);d=p&&p.length>1?p[1]:void 0}if(e.isNull(_)){var p=g.match(/stop\-opacity\:\s?([0-1\.\-]*)/);_=p&&p.length>1?parseFloat(p[1]):1}l.push(new y.Gradient.Stop(f,d,_))}var v=new y.RadialGradient(i-o,n-h,r,l,s-o,a-h);return y.Utils.applySvgAttributes.call(this,t,v)}},subdivide:function(t,i,n,r,s,a,o,h,l){l=l||y.Utils.Curve.RecursionLimit;var u=l+1;return t===o&&i===h?[new y.Anchor(o,h)]:e.map(e.range(0,u),function(e){var l=e/u,c=k(l,t,n,s,o),f=k(l,i,r,a,h);
return new y.Anchor(c,f)})},getPointOnCubicBezier:function(t,e,i,n,r){var s=1-t;return s*s*s*e+3*s*s*t*i+3*s*t*t*n+t*t*t*r},getCurveLength:function(t,e,i,n,r,s,a,o,h){if(t===i&&e===n&&r===a&&s===o){var l=a-t,c=o-e;return u(l*l+c*c)}var f=9*(i-r)+3*(a-t),d=6*(t+r)-12*i,_=3*(i-t),g=9*(n-s)+3*(o-e),p=6*(e+s)-12*n,v=3*(n-e),m=function(t){var e=(f*t+d)*t+_,i=(g*t+p)*t+v;return u(e*e+i*i)};return M(m,0,1,h||y.Utils.Curve.RecursionLimit)},integrate:function(t,e,i,n){for(var r=y.Utils.Curve.abscissas[n-2],s=y.Utils.Curve.weights[n-2],a=.5*(i-e),o=a+e,h=0,l=n+1>>1,u=1&n?s[h++]*t(o):0;h<l;){var c=a*r[h];u+=s[h++]*(t(o+c)+t(o-c))}return a*u},getCurveFromPoints:function(t,i){for(var n=t.length,r=n-1,s=0;s<n;s++){var a=t[s];e.isObject(a.controls)||y.Anchor.AppendCurveProperties(a);var o=i?S(s-1,n):p(s-1,0),h=i?S(s+1,n):g(s+1,r),l=t[o],u=a,c=t[h];C(l,u,c),u._command=0===s?y.Commands.move:y.Commands.curve,u.controls.left.x=e.isNumber(u.controls.left.x)?u.controls.left.x:u.x,u.controls.left.y=e.isNumber(u.controls.left.y)?u.controls.left.y:u.y,u.controls.right.x=e.isNumber(u.controls.right.x)?u.controls.right.x:u.x,u.controls.right.y=e.isNumber(u.controls.right.y)?u.controls.right.y:u.y}},getControlPoints:function(t,i,n){var r=w(t,i),s=w(n,i),a=x(t,i),l=x(n,i),u=(r+s)/2;return i.u=e.isObject(i.controls.left)?i.controls.left:new y.Vector(0,0),i.v=e.isObject(i.controls.right)?i.controls.right:new y.Vector(0,0),a<1e-4||l<1e-4?(i._relative||(i.controls.left.copy(i),i.controls.right.copy(i)),i):(a*=.33,l*=.33,s<r?u+=d:u-=d,i.controls.left.x=h(u)*a,i.controls.left.y=o(u)*a,u-=c,i.controls.right.x=h(u)*l,i.controls.right.y=o(u)*l,i._relative||(i.controls.left.x+=i.x,i.controls.left.y+=i.y,i.controls.right.x+=i.x,i.controls.right.y+=i.y),i)},getReflection:function(t,e,i){return new y.Vector(2*t.x-(e.x+t.x)-(i?t.x:0),2*t.y-(e.y+t.y)-(i?t.y:0))},getAnchorsFromArcData:function(t,i,n,r,s,a,o){var h=((new y.Matrix).translate(t.x,t.y).rotate(i),y.Resolution);return e.map(e.range(h),function(t){var e=(t+1)/h;o&&(e=1-e);var i=e*a+s,l=n*Math.cos(i),u=r*Math.sin(i),c=new y.Anchor(l,u);return y.Anchor.AppendCurveProperties(c),c.command=y.Commands.line,c})},ratioBetween:function(t,e){return(t.x*e.x+t.y*e.y)/(t.length()*e.length())},angleBetween:function(t,e){var i,n;return arguments.length>=4?(i=arguments[0]-arguments[2],n=arguments[1]-arguments[3],l(n,i)):(i=t.x-e.x,n=t.y-e.y,l(n,i))},distanceBetweenSquared:function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n},distanceBetween:function(t,e){return u(b(t,e))},toFixed:function(t){return Math.floor(1e3*t)/1e3},mod:function(t,e){for(;t<0;)t+=e;return t%e},Collection:function(){Array.call(this),arguments.length>1?Array.prototype.push.apply(this,arguments):arguments[0]&&Array.isArray(arguments[0])&&Array.prototype.push.apply(this,arguments[0])},Error:function(t){this.name="two.js",this.message=t}}}),y.Utils.Error.prototype=new Error,y.Utils.Error.prototype.constructor=y.Utils.Error,y.Utils.Collection.prototype=new Array,y.Utils.Collection.constructor=y.Utils.Collection,e.extend(y.Utils.Collection.prototype,i.Events,{pop:function(){var t=Array.prototype.pop.apply(this,arguments);return this.trigger(y.Events.remove,[t]),t},shift:function(){var t=Array.prototype.shift.apply(this,arguments);return this.trigger(y.Events.remove,[t]),t},push:function(){var t=Array.prototype.push.apply(this,arguments);return this.trigger(y.Events.insert,arguments),t},unshift:function(){var t=Array.prototype.unshift.apply(this,arguments);return this.trigger(y.Events.insert,arguments),t},splice:function(){var t,e=Array.prototype.splice.apply(this,arguments);return this.trigger(y.Events.remove,e),arguments.length>2&&(t=this.slice(arguments[0],arguments.length-2),this.trigger(y.Events.insert,t),this.trigger(y.Events.order)),e},sort:function(){return Array.prototype.sort.apply(this,arguments),this.trigger(y.Events.order),this},reverse:function(){return Array.prototype.reverse.apply(this,arguments),this.trigger(y.Events.order),this}});var x=y.Utils.distanceBetween,b=(y.Utils.getAnchorsFromArcData,y.Utils.distanceBetweenSquared),w=(y.Utils.ratioBetween,y.Utils.angleBetween),C=y.Utils.getControlPoints,S=(y.Utils.getCurveFromPoints,y.Utils.solveSegmentIntersection,y.Utils.decoupleShapes,y.Utils.mod),A=y.Utils.getBackingStoreRatio,k=y.Utils.getPointOnCubicBezier,M=(y.Utils.getCurveLength,y.Utils.integrate),P=y.Utils.getReflection;e.extend(y.prototype,i.Events,{appendTo:function(t){return t.appendChild(this.renderer.domElement),this},play:function(){return y.Utils.setPlaying.call(this,!0),this.trigger(y.Events.play)},pause:function(){return this.playing=!1,this.trigger(y.Events.pause)},update:function(){var t=!!this._lastFrame,e=s();this.frameCount++,t&&(this.timeDelta=parseFloat((e-this._lastFrame).toFixed(3))),this._lastFrame=e;var i=this.width,n=this.height,r=this.renderer;return i===r.width&&n===r.height||r.setSize(i,n,this.ratio),this.trigger(y.Events.update,this.frameCount,this.timeDelta),this.render()},render:function(){return this.renderer.render(),this.trigger(y.Events.render,this.frameCount)},add:function(t){var i=t;return i instanceof Array||(i=e.toArray(arguments)),this.scene.add(i),this},remove:function(t){var i=t;return i instanceof Array||(i=e.toArray(arguments)),this.scene.remove(i),this},clear:function(){return this.scene.remove(e.toArray(this.scene.children)),this},makeLine:function(t,e,i,n){var r=new y.Line(t,e,i,n);return this.scene.add(r),r},makeRectangle:function(t,e,i,n){var r=new y.Rectangle(t,e,i,n);return this.scene.add(r),r},makeRoundedRectangle:function(t,e,i,n,r){var s=new y.RoundedRectangle(t,e,i,n,r);return this.scene.add(s),s},makeCircle:function(t,e,i){return this.makeEllipse(t,e,i,i)},makeEllipse:function(t,e,i,n){var r=new y.Ellipse(t,e,i,n);return this.scene.add(r),r},makeStar:function(t,e,i,n,r){var s=new y.Star(t,e,i,n,r);return this.scene.add(s),s},makeCurve:function(t){var i=arguments.length,n=t;if(!e.isArray(t)){n=[];for(var r=0;r<i;r+=2){var s=arguments[r];if(!e.isNumber(s))break;var a=arguments[r+1];n.push(new y.Anchor(s,a))}}var o=arguments[i-1],h=new y.Path(n,!(e.isBoolean(o)?o:void 0),!0),l=h.getBoundingClientRect();return h.center().translation.set(l.left+l.width/2,l.top+l.height/2),this.scene.add(h),h},makePolygon:function(t,e,i,n){var r=new y.Polygon(t,e,i,n);return this.scene.add(r),r},makeArcSegment:function(t,e,i,n,r,s,a){var o=new y.ArcSegment(t,e,i,n,r,s,a);return this.scene.add(o),o},makePath:function(t){var i=arguments.length,n=t;if(!e.isArray(t)){n=[];for(var r=0;r<i;r+=2){var s=arguments[r];if(!e.isNumber(s))break;var a=arguments[r+1];n.push(new y.Anchor(s,a))}}var o=arguments[i-1],h=new y.Path(n,!(e.isBoolean(o)?o:void 0)),l=h.getBoundingClientRect();return h.center().translation.set(l.left+l.width/2,l.top+l.height/2),this.scene.add(h),h},makeText:function(t,e,i,n){var r=new y.Text(t,e,i,n);return this.add(r),r},makeLinearGradient:function(t,e,i,n){var r=Array.prototype.slice.call(arguments,4),s=new y.LinearGradient(t,e,i,n,r);return this.add(s),s},makeRadialGradient:function(t,e,i){var n=Array.prototype.slice.call(arguments,3),r=new y.RadialGradient(t,e,i,n);return this.add(r),r},makeGroup:function(t){var i=t;i instanceof Array||(i=e.toArray(arguments));var n=new y.Group;return this.scene.add(n),n.add(i),n},interpret:function(t,e){var i=t.tagName.toLowerCase();if(!(i in y.Utils.read))return null;var n=y.Utils.read[i].call(this,t);return e&&n instanceof y.Group?this.add(n.children):this.add(n),n},load:function(t,i){var n,r,s=[];if(/.*\.svg/gi.test(t))return y.Utils.xhr(t,e.bind(function(t){for(m.temp.innerHTML=t,r=0;r<m.temp.children.length;r++)n=m.temp.children[r],s.push(this.interpret(n));i(s.length<=1?s[0]:s,m.temp.children.length<=1?m.temp.children[0]:m.temp.children)},this)),this;for(m.temp.innerHTML=t,r=0;r<m.temp.children.length;r++)n=m.temp.children[r],s.push(this.interpret(n));return i(s.length<=1?s[0]:s,m.temp.children.length<=1?m.temp.children[0]:m.temp.children),this}}),function(){n(arguments.callee),y.Instances.forEach(function(t){t.playing&&t.update()})}(),"function"==typeof define&&define.amd?define(function(){return y}):"undefined"!=typeof module&&module.exports&&(module.exports=y)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Vector=function(t,e){this.x=t||0,this.y=e||0};e.extend(r,{zero:new t.Vector}),e.extend(r.prototype,i.Events,{set:function(t,e){return this.x=t,this.y=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new r(this.x,this.y)},add:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},multiplySelf:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},setLength:function(t){return this.normalize().multiplyScalar(t)},equals:function(t,e){return e="undefined"==typeof e?1e-4:e,this.distanceTo(t)<e},lerp:function(t,e){var i=(t.x-this.x)*e+this.x,n=(t.y-this.y)*e+this.y;return this.set(i,n)},isZero:function(t){return t="undefined"==typeof t?1e-4:t,this.length()<t},toString:function(){return this.x+","+this.y},toObject:function(){return{x:this.x,y:this.y}}});var s={set:function(e,i){return this._x=e,this._y=i,this.trigger(t.Events.change)},copy:function(e){return this._x=e.x,this._y=e.y,this.trigger(t.Events.change)},clear:function(){return this._x=0,this._y=0,this.trigger(t.Events.change)},clone:function(){return new r(this._x,this._y)},add:function(e,i){return this._x=e.x+i.x,this._y=e.y+i.y,this.trigger(t.Events.change)},addSelf:function(e){return this._x+=e.x,this._y+=e.y,this.trigger(t.Events.change)},sub:function(e,i){return this._x=e.x-i.x,this._y=e.y-i.y,this.trigger(t.Events.change)},subSelf:function(e){return this._x-=e.x,this._y-=e.y,this.trigger(t.Events.change)},multiplySelf:function(e){return this._x*=e.x,this._y*=e.y,this.trigger(t.Events.change)},multiplyScalar:function(e){return this._x*=e,this._y*=e,this.trigger(t.Events.change)},divideScalar:function(e){return e?(this._x/=e,this._y/=e,this.trigger(t.Events.change)):this.clear()},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this._x*t.x+this._y*t.y},lengthSquared:function(){return this._x*this._x+this._y*this._y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this._x-t.x,i=this._y-t.y;return e*e+i*i},setLength:function(t){return this.normalize().multiplyScalar(t)},equals:function(t,e){return e="undefined"==typeof e?1e-4:e,this.distanceTo(t)<e},lerp:function(t,e){var i=(t.x-this._x)*e+this._x,n=(t.y-this._y)*e+this._y;return this.set(i,n)},isZero:function(t){return t="undefined"==typeof t?1e-4:t,this.length()<t},toString:function(){return this._x+","+this._y},toObject:function(){return{x:this._x,y:this._y}}},a={get:function(){return this._x},set:function(e){this._x=e,this.trigger(t.Events.change,"x")}},o={get:function(){return this._y},set:function(e){this._y=e,this.trigger(t.Events.change,"y")}};t.Vector.prototype.bind=t.Vector.prototype.on=function(){return this._bound||(this._x=this.x,this._y=this.y,Object.defineProperty(this,"x",a),Object.defineProperty(this,"y",o),e.extend(this,s),this._bound=!0),i.Events.bind.apply(this,arguments),this}}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Commands,s=t.Anchor=function(i,n,a,o,h,l,u){return t.Vector.call(this,i,n),this._broadcast=e.bind(function(){this.trigger(t.Events.change)},this),this._command=u||r.move,this._relative=!0,u?(s.AppendCurveProperties(this),e.isNumber(a)&&(this.controls.left.x=a),e.isNumber(o)&&(this.controls.left.y=o),e.isNumber(h)&&(this.controls.right.x=h),void(e.isNumber(l)&&(this.controls.right.y=l))):this};e.extend(s,{AppendCurveProperties:function(e){e.controls={left:new t.Vector(0,0),right:new t.Vector(0,0)}}});var a={listen:function(){return e.isObject(this.controls)||s.AppendCurveProperties(this),this.controls.left.bind(t.Events.change,this._broadcast),this.controls.right.bind(t.Events.change,this._broadcast),this},ignore:function(){return this.controls.left.unbind(t.Events.change,this._broadcast),this.controls.right.unbind(t.Events.change,this._broadcast),this},clone:function(){var e=this.controls,i=new t.Anchor(this.x,this.y,e&&e.left.x,e&&e.left.y,e&&e.right.x,e&&e.right.y,this.command);return i.relative=this._relative,i},toObject:function(){var t={x:this.x,y:this.y};return this._command&&(t.command=this._command),this._relative&&(t.relative=this._relative),this.controls&&(t.controls={left:this.controls.left.toObject(),right:this.controls.right.toObject()}),t}};Object.defineProperty(s.prototype,"command",{get:function(){return this._command},set:function(i){return this._command=i,this._command!==r.curve||e.isObject(this.controls)||s.AppendCurveProperties(this),this.trigger(t.Events.change)}}),Object.defineProperty(s.prototype,"relative",{get:function(){return this._relative},set:function(e){return this._relative==e?this:(this._relative=!!e,this.trigger(t.Events.change))}}),e.extend(s.prototype,t.Vector.prototype,a),t.Anchor.prototype.bind=t.Anchor.prototype.on=function(){t.Vector.prototype.bind.apply(this,arguments),e.extend(this,a)},t.Anchor.prototype.unbind=t.Anchor.prototype.off=function(){t.Vector.prototype.unbind.apply(this,arguments),e.extend(this,a)}}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=Math.cos,s=Math.sin,a=Math.tan,o=t.Matrix=function(i,n,r,s,a,o){this.elements=new t.Array(9);var h=i;e.isArray(h)||(h=e.toArray(arguments)),this.identity().set(h)};e.extend(o,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(e,i,n){if(i.length<=3){var r,s,a,o=e,h=i[0]||0,l=i[1]||0,u=i[2]||0;return r=o[0]*h+o[1]*l+o[2]*u,s=o[3]*h+o[4]*l+o[5]*u,a=o[6]*h+o[7]*l+o[8]*u,{x:r,y:s,z:a}}var c=e[0],f=e[1],d=e[2],_=e[3],g=e[4],p=e[5],v=e[6],m=e[7],y=e[8],x=i[0],b=i[1],w=i[2],C=i[3],S=i[4],A=i[5],k=i[6],M=i[7],P=i[8];return n=n||new t.Array(9),n[0]=c*x+f*C+d*k,n[1]=c*b+f*S+d*M,n[2]=c*w+f*A+d*P,n[3]=_*x+g*C+p*k,n[4]=_*b+g*S+p*M,n[5]=_*w+g*A+p*P,n[6]=v*x+m*C+y*k,n[7]=v*b+m*S+y*M,n[8]=v*w+m*A+y*P,n}}),e.extend(o.prototype,i.Events,{set:function(i){var n=i;return e.isArray(n)||(n=e.toArray(arguments)),e.extend(this.elements,n),this.trigger(t.Events.change)},identity:function(){return this.set(o.Identity),this},multiply:function(i,n,r,s,a,o,h,l,u){var c=arguments,f=c.length;if(f<=1)return e.each(this.elements,function(t,e){this.elements[e]=t*i},this),this.trigger(t.Events.change);if(f<=3){var d,_,g;return i=i||0,n=n||0,r=r||0,a=this.elements,d=a[0]*i+a[1]*n+a[2]*r,_=a[3]*i+a[4]*n+a[5]*r,g=a[6]*i+a[7]*n+a[8]*r,{x:d,y:_,z:g}}var p=this.elements,v=c,m=p[0],y=p[1],x=p[2],b=p[3],w=p[4],C=p[5],S=p[6],A=p[7],k=p[8],M=v[0],P=v[1],E=v[2],T=v[3],O=v[4],I=v[5],F=v[6],q=v[7],z=v[8];return this.elements[0]=m*M+y*T+x*F,this.elements[1]=m*P+y*O+x*q,this.elements[2]=m*E+y*I+x*z,this.elements[3]=b*M+w*T+C*F,this.elements[4]=b*P+w*O+C*q,this.elements[5]=b*E+w*I+C*z,this.elements[6]=S*M+A*T+k*F,this.elements[7]=S*P+A*O+k*q,this.elements[8]=S*E+A*I+k*z,this.trigger(t.Events.change)},inverse:function(e){var i=this.elements;e=e||new t.Matrix;var n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],h=i[5],l=i[6],u=i[7],c=i[8],f=c*o-h*u,d=-c*a+h*l,_=u*a-o*l,g=n*f+r*d+s*_;return g?(g=1/g,e.elements[0]=f*g,e.elements[1]=(-c*r+s*u)*g,e.elements[2]=(h*r-s*o)*g,e.elements[3]=d*g,e.elements[4]=(c*n-s*l)*g,e.elements[5]=(-h*n+s*a)*g,e.elements[6]=_*g,e.elements[7]=(-u*n+r*l)*g,e.elements[8]=(o*n-r*a)*g,e):null},scale:function(t,e){var i=arguments.length;return i<=1&&(e=t),this.multiply(t,0,0,0,e,0,0,0,1)},rotate:function(t){var e=r(t),i=s(t);return this.multiply(e,-i,0,i,e,0,0,0,1)},translate:function(t,e){return this.multiply(1,0,t,0,1,e,0,0,1)},skewX:function(t){var e=a(t);return this.multiply(1,e,0,0,1,0,0,0,1)},skewY:function(t){var e=a(t);return this.multiply(1,0,0,e,1,0,0,0,1)},toString:function(t){var e=[];return this.toArray(t,e),e.join(" ")},toArray:function(t,e){var i=this.elements,n=!!e,r=parseFloat(i[0].toFixed(3)),s=parseFloat(i[1].toFixed(3)),a=parseFloat(i[2].toFixed(3)),o=parseFloat(i[3].toFixed(3)),h=parseFloat(i[4].toFixed(3)),l=parseFloat(i[5].toFixed(3));if(t){var u=parseFloat(i[6].toFixed(3)),c=parseFloat(i[7].toFixed(3)),f=parseFloat(i[8].toFixed(3));return n?(e[0]=r,e[1]=o,e[2]=u,e[3]=s,e[4]=h,e[5]=c,e[6]=a,e[7]=l,void(e[8]=f)):[r,o,u,s,h,c,a,l,f]}return n?(e[0]=r,e[1]=o,e[2]=s,e[3]=h,e[4]=a,void(e[5]=l)):[r,o,s,h,a,l]},clone:function(){var e,i,n,r,s,a,o,h,l;return e=this.elements[0],i=this.elements[1],n=this.elements[2],r=this.elements[3],s=this.elements[4],a=this.elements[5],o=this.elements[6],h=this.elements[7],l=this.elements[8],new t.Matrix(e,i,n,r,s,a,o,h,l)}})}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Utils.mod,s=t.Utils.toFixed,a={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",alignments:{left:"start",center:"middle",right:"end"},createElement:function(t,i){var n=t,r=document.createElementNS(this.ns,n);return"svg"===n&&(i=e.defaults(i||{},{version:this.version})),e.isEmpty(i)||a.setAttributes(r,i),r},setAttributes:function(t,e){for(var i=Object.keys(e),n=0;n<i.length;n++)t.setAttribute(i[n],e[i[n]]);return this},removeAttributes:function(t,e){for(var i in e)t.removeAttribute(i);return this},toString:function(e,i){for(var n,a=e.length,o=a-1,h="",l=0;l<a;l++){var u,c,f,d,_,g,p,v,m,y=e[l],x=i?r(l-1,a):Math.max(l-1,0),b=i?r(l+1,a):Math.min(l+1,o),w=e[x],C=e[b],S=s(y._x),A=s(y._y);switch(y._command){case t.Commands.close:u=t.Commands.close;break;case t.Commands.curve:g=w.controls&&w.controls.right||w,p=y.controls&&y.controls.left||y,w._relative?(c=s(g.x+w.x),f=s(g.y+w.y)):(c=s(g.x),f=s(g.y)),y._relative?(d=s(p.x+y.x),_=s(p.y+y.y)):(d=s(p.x),_=s(p.y)),u=(0===l?t.Commands.move:t.Commands.curve)+" "+c+" "+f+" "+d+" "+_+" "+S+" "+A;break;case t.Commands.move:n=y,u=t.Commands.move+" "+S+" "+A;break;default:u=y._command+" "+S+" "+A}l>=o&&i&&(y._command===t.Commands.curve&&(C=n,v=y.controls&&y.controls.right||y,m=C.controls&&C.controls.left||C,y._relative?(c=s(v.x+y.x),f=s(v.y+y.y)):(c=s(v.x),f=s(v.y)),C._relative?(d=s(m.x+C.x),_=s(m.y+C.y)):(d=s(m.x),_=s(m.y)),S=s(C.x),A=s(C.y),u+=" C "+c+" "+f+" "+d+" "+_+" "+S+" "+A),u+=" Z"),h+=u+" "}return h},getClip:function(t){var e=t._renderer.clip;if(!e){for(var i=t;i.parent;)i=i.parent;e=t._renderer.clip=a.createElement("clipPath"),i.defs.appendChild(e)}return e},group:{appendChild:function(t){var e=t._renderer.elem;if(e){var i=e.nodeName;!i||/(radial|linear)gradient/i.test(i)||t._clip||this.elem.appendChild(e)}},removeChild:function(t){var e=t._renderer.elem;if(e&&e.parentNode==this.elem){var i=e.nodeName;i&&(t._clip||this.elem.removeChild(e))}},orderChild:function(t){this.elem.appendChild(t._renderer.elem)},renderChild:function(t){a[t._renderer.type].render.call(t,this)},render:function(t){if(this._update(),0===this._opacity&&!this._flagOpacity)return this;this._renderer.elem||(this._renderer.elem=a.createElement("g",{id:this.id}),t.appendChild(this._renderer.elem));var e=this._matrix.manual||this._flagMatrix,i={domElement:t,elem:this._renderer.elem};e&&this._renderer.elem.setAttribute("transform","matrix("+this._matrix.toString()+")");for(var n=0;n<this.children.length;n++){var r=this.children[n];a[r._renderer.type].render.call(r,t)}return this._flagOpacity&&this._renderer.elem.setAttribute("opacity",this._opacity),this._flagAdditions&&this.additions.forEach(a.group.appendChild,i),this._flagSubtractions&&this.subtractions.forEach(a.group.removeChild,i),this._flagOrder&&this.children.forEach(a.group.orderChild,i),this._flagMask&&(this._mask?this._renderer.elem.setAttribute("clip-path","url(#"+this._mask.id+")"):this._renderer.elem.removeAttribute("clip-path")),this.flagReset()}},path:{render:function(t){if(this._update(),0===this._opacity&&!this._flagOpacity)return this;var e={},i=this._matrix.manual||this._flagMatrix;if(i&&(e.transform="matrix("+this._matrix.toString()+")"),this._flagVertices){var n=a.toString(this._vertices,this._closed);e.d=n}if(this._flagFill&&(this._fill&&this._fill._renderer&&a[this._fill._renderer.type].render.call(this._fill,t),e.fill=this._fill&&this._fill.id?"url(#"+this._fill.id+")":this._fill),this._flagStroke&&(this._stroke&&this._stroke._renderer&&a[this._stroke._renderer.type].render.call(this._stroke,t),e.stroke=this._stroke&&this._stroke.id?"url(#"+this._stroke.id+")":this._stroke),this._flagLinewidth&&(e["stroke-width"]=this._linewidth),this._flagOpacity&&(e["stroke-opacity"]=this._opacity,e["fill-opacity"]=this._opacity),this._flagVisible&&(e.visibility=this._visible?"visible":"hidden"),this._flagCap&&(e["stroke-linecap"]=this._cap),this._flagJoin&&(e["stroke-linejoin"]=this._join),this._flagMiter&&(e["stroke-miterlimit"]=this._miter),this._renderer.elem?a.setAttributes(this._renderer.elem,e):(e.id=this.id,this._renderer.elem=a.createElement("path",e),t.appendChild(this._renderer.elem)),this._flagClip){var r=a.getClip(this),s=this._renderer.elem;this._clip?(s.removeAttribute("id"),r.setAttribute("id",this.id),r.appendChild(s)):(r.removeAttribute("id"),s.setAttribute("id",this.id),this.parent._renderer.elem.appendChild(s))}return this.flagReset()}},text:{render:function(t){this._update();var e={},i=this._matrix.manual||this._flagMatrix;if(i&&(e.transform="matrix("+this._matrix.toString()+")"),this._flagFamily&&(e["font-family"]=this._family),this._flagSize&&(e["font-size"]=this._size),this._flagLeading&&(e["line-height"]=this._leading),this._flagAlignment&&(e["text-anchor"]=a.alignments[this._alignment]||this._alignment),this._flagBaseline&&(e["alignment-baseline"]=e["dominant-baseline"]=this._baseline),this._flagStyle&&(e["font-style"]=this._style),this._flagWeight&&(e["font-weight"]=this._weight),this._flagDecoration&&(e["text-decoration"]=this._decoration),this._flagFill&&(e.fill=this._fill&&this._fill.id?"url(#"+this._fill.id+")":this._fill),this._flagStroke&&(e.stroke=this._stroke&&this._stroke.id?"url(#"+this._stroke.id+")":this._stroke),this._flagLinewidth&&(e["stroke-width"]=this._linewidth),this._flagOpacity&&(e.opacity=this._opacity),this._flagVisible&&(e.visibility=this._visible?"visible":"hidden"),this._renderer.elem?a.setAttributes(this._renderer.elem,e):(e.id=this.id,this._renderer.elem=a.createElement("text",e),t.defs.appendChild(this._renderer.elem)),this._flagClip){var n=a.getClip(this),r=this._renderer.elem;this._clip?(r.removeAttribute("id"),n.setAttribute("id",this.id),n.appendChild(r)):(n.removeAttribute("id"),r.setAttribute("id",this.id),this.parent._renderer.elem.appendChild(r))}return this._flagValue&&(this._renderer.elem.textContent=this._value),this.flagReset()}},"linear-gradient":{render:function(t){this._update();var e={};if(this._flagEndPoints&&(e.x1=this.left._x,e.y1=this.left._y,e.x2=this.right._x,e.y2=this.right._y),this._flagSpread&&(e.spreadMethod=this._spread),this._renderer.elem?a.setAttributes(this._renderer.elem,e):(e.id=this.id,e.gradientUnits="userSpaceOnUse",this._renderer.elem=a.createElement("linearGradient",e),t.defs.appendChild(this._renderer.elem)),this._flagStops){this._renderer.elem.childNodes.length=0;for(var i=0;i<this.stops.length;i++){var n=this.stops[i],r={};n._flagOffset&&(r.offset=100*n._offset+"%"),n._flagColor&&(r["stop-color"]=n._color),n._flagOpacity&&(r["stop-opacity"]=n._opacity),n._renderer.elem?a.setAttributes(n._renderer.elem,r):n._renderer.elem=a.createElement("stop",r),this._renderer.elem.appendChild(n._renderer.elem),n.flagReset()}}return this.flagReset()}},"radial-gradient":{render:function(t){this._update();var e={};if(this._flagCenter&&(e.cx=this.center._x,e.cy=this.center._y),this._flagFocal&&(e.fx=this.focal._x,e.fy=this.focal._y),this._flagRadius&&(e.r=this._radius),this._flagSpread&&(e.spreadMethod=this._spread),this._renderer.elem?a.setAttributes(this._renderer.elem,e):(e.id=this.id,e.gradientUnits="userSpaceOnUse",this._renderer.elem=a.createElement("radialGradient",e),t.defs.appendChild(this._renderer.elem)),this._flagStops){this._renderer.elem.childNodes.length=0;for(var i=0;i<this.stops.length;i++){var n=this.stops[i],r={};n._flagOffset&&(r.offset=100*n._offset+"%"),n._flagColor&&(r["stop-color"]=n._color),n._flagOpacity&&(r["stop-opacity"]=n._opacity),n._renderer.elem?a.setAttributes(n._renderer.elem,r):n._renderer.elem=a.createElement("stop",r),this._renderer.elem.appendChild(n._renderer.elem),n.flagReset()}}return this.flagReset()}}},o=t[t.Types.svg]=function(e){this.domElement=e.domElement||a.createElement("svg"),this.scene=new t.Group,this.scene.parent=this,this.defs=a.createElement("defs"),this.domElement.appendChild(this.defs),this.domElement.defs=this.defs,this.domElement.style.overflow="hidden"};e.extend(o,{Utils:a}),e.extend(o.prototype,i.Events,{setSize:function(t,e){return this.width=t,this.height=e,a.setAttributes(this.domElement,{width:t,height:e}),this},render:function(){return a.group.render.call(this.scene,this.domElement),this}})}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Utils.mod,s=t.Utils.toFixed,a=t.Utils.getRatio,o=function(t){return 1==t[0]&&0==t[3]&&0==t[1]&&1==t[4]&&0==t[2]&&0==t[5]},h={isHidden:/(none|transparent)/i,alignments:{left:"start",middle:"center",right:"end"},group:{renderChild:function(t){h[t._renderer.type].render.call(t,this.ctx,!0,this.clip)},render:function(t){this._update();var e=this._matrix.elements,i=this.parent;this._renderer.opacity=this._opacity*(i&&i._renderer?i._renderer.opacity:1);var n=o(e),r=this._mask;this._renderer.context||(this._renderer.context={}),this._renderer.context.ctx=t,n||(t.save(),t.transform(e[0],e[3],e[1],e[4],e[2],e[5])),r&&h[r._renderer.type].render.call(r,t,!0);for(var s=0;s<this.children.length;s++){var a=this.children[s];h[a._renderer.type].render.call(a,t)}return n||t.restore(),this.flagReset()}},path:{render:function(i,n,a){var l,u,c,f,d,_,g,p,v,m,y,x,b,w,C,S,A,k,M,P,E,T,O,I,F,q,z,R,L,N,B;if(this._update(),l=this._matrix.elements,u=this._stroke,c=this._linewidth,f=this._fill,d=this._opacity*this.parent._renderer.opacity,_=this._visible,g=this._cap,p=this._join,v=this._miter,m=this._closed,y=this._vertices,x=y.length,b=x-1,B=o(l),N=this._clip,!n&&(!_||N))return this;B||(i.save(),i.transform(l[0],l[3],l[1],l[4],l[2],l[5])),f&&(e.isString(f)?i.fillStyle=f:(h[f._renderer.type].render.call(f,i),i.fillStyle=f._renderer.gradient)),u&&(e.isString(u)?i.strokeStyle=u:(h[u._renderer.type].render.call(u,i),i.strokeStyle=u._renderer.gradient)),c&&(i.lineWidth=c),v&&(i.miterLimit=v),p&&(i.lineJoin=p),g&&(i.lineCap=g),e.isNumber(d)&&(i.globalAlpha=d),i.beginPath();for(var j=0;j<y.length;j++)switch(A=y[j],R=s(A._x),L=s(A._y),A._command){case t.Commands.close:i.closePath();break;case t.Commands.curve:C=m?r(j-1,x):Math.max(j-1,0),w=m?r(j+1,x):Math.min(j+1,b),S=y[C],k=y[w],I=S.controls&&S.controls.right||S,F=A.controls&&A.controls.left||A,S._relative?(T=I.x+s(S._x),O=I.y+s(S._y)):(T=s(I.x),O=s(I.y)),A._relative?(P=F.x+s(A._x),E=F.y+s(A._y)):(P=s(F.x),E=s(F.y)),i.bezierCurveTo(T,O,P,E,R,L),j>=b&&m&&(k=M,q=A.controls&&A.controls.right||A,z=k.controls&&k.controls.left||k,A._relative?(T=q.x+s(A._x),O=q.y+s(A._y)):(T=s(q.x),O=s(q.y)),k._relative?(P=z.x+s(k._x),E=z.y+s(k._y)):(P=s(z.x),E=s(z.y)),R=s(k._x),L=s(k._y),i.bezierCurveTo(T,O,P,E,R,L));break;case t.Commands.line:i.lineTo(R,L);break;case t.Commands.move:M=A,i.moveTo(R,L)}return m&&i.closePath(),N||a||(h.isHidden.test(f)||i.fill(),h.isHidden.test(u)||i.stroke()),B||i.restore(),N&&!a&&i.clip(),this.flagReset()}},"linear-gradient":{render:function(t){if(this._update(),!this._renderer.gradient||this._flagEndPoints||this._flagStops){this._renderer.gradient=t.createLinearGradient(this.left._x,this.left._y,this.right._x,this.right._y);for(var e=0;e<this.stops.length;e++){var i=this.stops[e];this._renderer.gradient.addColorStop(i._offset,i._color)}}return this.flagReset()}},text:{render:function(t,i,n){this._update();var r=this._matrix.elements,s=this._stroke,a=this._linewidth,l=this._fill,u=this._opacity*this.parent._renderer.opacity,c=this._visible,f=o(r),d=this._clip;return i||c&&!d?(f||(t.save(),t.transform(r[0],r[3],r[1],r[4],r[2],r[5])),t.font=[this._style,this._weight,this._size+"px/"+this._leading+"px",this._family].join(" "),t.textAlign=h.alignments[this._alignment]||this._alignment,t.textBaseline=this._baseline,l&&(e.isString(l)?t.fillStyle=l:(h[l._renderer.type].render.call(l,t),t.fillStyle=l._renderer.gradient)),s&&(e.isString(s)?t.strokeStyle=s:(h[s._renderer.type].render.call(s,t),t.strokeStyle=s._renderer.gradient)),a&&(t.lineWidth=a),e.isNumber(u)&&(t.globalAlpha=u),d||n||(h.isHidden.test(l)||t.fillText(this.value,0,0),h.isHidden.test(s)||t.strokeText(this.value,0,0)),f||t.restore(),d&&!n&&t.clip(),this.flagReset()):this}},"radial-gradient":{render:function(t){if(this._update(),!this._renderer.gradient||this._flagCenter||this._flagFocal||this._flagRadius||this._flagStops){this._renderer.gradient=t.createRadialGradient(this.center._x,this.center._y,0,this.focal._x,this.focal._y,this._radius);for(var e=0;e<this.stops.length;e++){var i=this.stops[e];this._renderer.gradient.addColorStop(i._offset,i._color)}}return this.flagReset()}}},l=t[t.Types.canvas]=function(e){var i=e.smoothing!==!1;this.domElement=e.domElement||document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.overdraw=e.overdraw||!1,this.ctx.imageSmoothingEnabled=i,this.ctx.mozImageSmoothingEnabled=i,this.ctx.oImageSmoothingEnabled=i,this.ctx.webkitImageSmoothingEnabled=i,this.ctx.imageSmoothingEnabled=i,this.scene=new t.Group,this.scene.parent=this};e.extend(l,{Utils:h}),e.extend(l.prototype,i.Events,{setSize:function(t,i,n){return this.width=t,this.height=i,this.ratio=e.isUndefined(n)?a(this.ctx):n,this.domElement.width=t*this.ratio,this.domElement.height=i*this.ratio,e.extend(this.domElement.style,{width:t+"px",
height:i+"px"}),this},render:function(){var t=1===this.ratio;return t||(this.ctx.save(),this.ctx.scale(this.ratio,this.ratio)),this.overdraw||this.ctx.clearRect(0,0,this.width,this.height),h.group.render.call(this.scene,this.ctx),t||this.ctx.restore(),this}})}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Matrix.Multiply,s=t.Utils.mod,a=[1,0,0,0,1,0,0,0,1],o=new t.Array(9),h=t.Utils.getRatio,l=(t.Utils.getComputedMatrix,t.Utils.toFixed),u={isHidden:/(none|transparent)/i,canvas:document.createElement("canvas"),alignments:{left:"start",middle:"center",right:"end"},matrix:new t.Matrix,uv:new t.Array([0,0,1,0,0,1,0,1,1,0,1,1]),group:{removeChild:function(t,e){if(t.children)for(var i=0;i<t.children.length;i++)u.group.removeChild(t.children[i],e);else e.deleteTexture(t._renderer.texture),delete t._renderer.texture},renderChild:function(t){u[t._renderer.type].render.call(t,this.gl,this.program)},render:function(e,i){this._update();var n=this.parent,s=n._matrix&&n._matrix.manual||n._flagMatrix,a=this._matrix.manual||this._flagMatrix;if((s||a)&&(this._renderer.matrix||(this._renderer.matrix=new t.Array(9)),this._matrix.toArray(!0,o),r(o,n._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*n._renderer.scale,s&&(this._flagMatrix=!0)),this._mask&&(e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,1,1),e.colorMask(!1,!1,!1,!0),e.stencilOp(e.KEEP,e.KEEP,e.INCR),u[this._mask._renderer.type].render.call(this._mask,e,i,this),e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.NOTEQUAL,0,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)),this._flagOpacity=n._flagOpacity||this._flagOpacity,this._renderer.opacity=this._opacity*(n&&n._renderer?n._renderer.opacity:1),this._flagSubtractions)for(var h=0;h<this.subtractions.length;h++)u.group.removeChild(this.subtractions[h],e);return this.children.forEach(u.group.renderChild,{gl:e,program:i}),this._mask&&(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),u[this._mask._renderer.type].render.call(this._mask,e,i,this),e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.NOTEQUAL,0,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.disable(e.STENCIL_TEST)),this.flagReset()}},path:{updateCanvas:function(i){var n,r,a,o,h,c,f,d,_,g,p,v,m,y,x=i._vertices,w=this.canvas,C=this.ctx,S=i._renderer.scale,A=i._stroke,k=i._linewidth,M=i._fill,P=i._renderer.opacity||i._opacity,E=i._cap,T=i._join,O=i._miter,I=i._closed,F=x.length,q=F-1;w.width=Math.max(Math.ceil(i._renderer.rect.width*S),1),w.height=Math.max(Math.ceil(i._renderer.rect.height*S),1);var z=i._renderer.rect.centroid,R=z.x,L=z.y;C.clearRect(0,0,w.width,w.height),M&&(e.isString(M)?C.fillStyle=M:(u[M._renderer.type].render.call(M,C,i),C.fillStyle=M._renderer.gradient)),A&&(e.isString(A)?C.strokeStyle=A:(u[A._renderer.type].render.call(A,C,i),C.strokeStyle=A._renderer.gradient)),k&&(C.lineWidth=k),O&&(C.miterLimit=O),T&&(C.lineJoin=T),E&&(C.lineCap=E),e.isNumber(P)&&(C.globalAlpha=P);var N;C.save(),C.scale(S,S),C.translate(R,L),C.beginPath();for(var B=0;B<x.length;B++)switch(b=x[B],m=l(b._x),y=l(b._y),b._command){case t.Commands.close:C.closePath();break;case t.Commands.curve:r=I?s(B-1,F):Math.max(B-1,0),n=I?s(B+1,F):Math.min(B+1,q),a=x[r],o=x[n],_=a.controls&&a.controls.right||a,g=b.controls&&b.controls.left||b,a._relative?(f=l(_.x+a._x),d=l(_.y+a._y)):(f=l(_.x),d=l(_.y)),b._relative?(h=l(g.x+b._x),c=l(g.y+b._y)):(h=l(g.x),c=l(g.y)),C.bezierCurveTo(f,d,h,c,m,y),B>=q&&I&&(o=N,p=b.controls&&b.controls.right||b,v=o.controls&&o.controls.left||o,b._relative?(f=l(p.x+b._x),d=l(p.y+b._y)):(f=l(p.x),d=l(p.y)),o._relative?(h=l(v.x+o._x),c=l(v.y+o._y)):(h=l(v.x),c=l(v.y)),m=l(o._x),y=l(o._y),C.bezierCurveTo(f,d,h,c,m,y));break;case t.Commands.line:C.lineTo(m,y);break;case t.Commands.move:N=b,C.moveTo(m,y)}I&&C.closePath(),u.isHidden.test(M)||C.fill(),u.isHidden.test(A)||C.stroke(),C.restore()},getBoundingClientRect:function(t,i,n){var r,s,a=1/0,o=-(1/0),h=1/0,l=-(1/0);t.forEach(function(t){var e,i,n,r,s,u,c=t.x,f=t.y,d=t.controls;h=Math.min(f,h),a=Math.min(c,a),o=Math.max(c,o),l=Math.max(f,l),t.controls&&(s=d.left,u=d.right,s&&u&&(e=t._relative?s.x+c:s.x,i=t._relative?s.y+f:s.y,n=t._relative?u.x+c:u.x,r=t._relative?u.y+f:u.y,e&&i&&n&&r&&(h=Math.min(i,r,h),a=Math.min(e,n,a),o=Math.max(e,n,o),l=Math.max(i,r,l))))}),e.isNumber(i)&&(h-=i,a-=i,o+=i,l+=i),r=o-a,s=l-h,n.top=h,n.left=a,n.right=o,n.bottom=l,n.width=r,n.height=s,n.centroid||(n.centroid={}),n.centroid.x=-a,n.centroid.y=-h},render:function(e,i,n){if(!this._visible||!this._opacity)return this;var s=this.parent,a=s._matrix.manual||s._flagMatrix,h=this._matrix.manual||this._flagMatrix,l=this._flagVertices||this._flagFill||this._fill instanceof t.LinearGradient&&(this._fill._flagSpread||this._fill._flagStops||this._fill._flagEndPoints)||this._fill instanceof t.RadialGradient&&(this._fill._flagSpread||this._fill._flagStops||this._fill._flagRadius||this._fill._flagCenter||this._fill._flagFocal)||this._stroke instanceof t.LinearGradient&&(this._stroke._flagSpread||this._stroke._flagStops||this._stroke._flagEndPoints)||this._stroke instanceof t.RadialGradient&&(this._stroke._flagSpread||this._stroke._flagStops||this._stroke._flagRadius||this._stroke._flagCenter||this._stroke._flagFocal)||this._flagStroke||this._flagLinewidth||this._flagOpacity||s._flagOpacity||this._flagVisible||this._flagCap||this._flagJoin||this._flagMiter||this._flagScale||!this._renderer.texture;return this._update(),(a||h)&&(this._renderer.matrix||(this._renderer.matrix=new t.Array(9)),this._matrix.toArray(!0,o),r(o,s._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*s._renderer.scale),l&&(this._renderer.rect||(this._renderer.rect={}),this._renderer.triangles||(this._renderer.triangles=new t.Array(12)),this._renderer.opacity=this._opacity*s._renderer.opacity,u.path.getBoundingClientRect(this._vertices,this._linewidth,this._renderer.rect),u.getTriangles(this._renderer.rect,this._renderer.triangles),u.updateBuffer.call(u,e,this,i),u.updateTexture.call(u,e,this)),!this._clip||n?(e.bindBuffer(e.ARRAY_BUFFER,this._renderer.textureCoordsBuffer),e.vertexAttribPointer(i.textureCoords,2,e.FLOAT,!1,0,0),e.bindTexture(e.TEXTURE_2D,this._renderer.texture),e.uniformMatrix3fv(i.matrix,!1,this._renderer.matrix),e.bindBuffer(e.ARRAY_BUFFER,this._renderer.buffer),e.vertexAttribPointer(i.position,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,6),this.flagReset()):void 0}},text:{updateCanvas:function(t){var i=this.canvas,n=this.ctx,r=t._renderer.scale,s=t._stroke,a=t._linewidth*r,o=t._fill,h=t._renderer.opacity||t._opacity;i.width=Math.max(Math.ceil(t._renderer.rect.width*r),1),i.height=Math.max(Math.ceil(t._renderer.rect.height*r),1);var l=t._renderer.rect.centroid,c=l.x,f=l.y;n.clearRect(0,0,i.width,i.height),n.font=[t._style,t._weight,t._size+"px/"+t._leading+"px",t._family].join(" "),n.textAlign="center",n.textBaseline="middle",o&&(e.isString(o)?n.fillStyle=o:(u[o._renderer.type].render.call(o,n,t),n.fillStyle=o._renderer.gradient)),s&&(e.isString(s)?n.strokeStyle=s:(u[s._renderer.type].render.call(s,n,t),n.strokeStyle=s._renderer.gradient)),a&&(n.lineWidth=a),e.isNumber(h)&&(n.globalAlpha=h),n.save(),n.scale(r,r),n.translate(c,f),u.isHidden.test(o)||n.fillText(t.value,0,0),u.isHidden.test(s)||n.strokeText(t.value,0,0),n.restore()},getBoundingClientRect:function(t,e){var i=u.ctx;i.font=[t._style,t._weight,t._size+"px/"+t._leading+"px",t._family].join(" "),i.textAlign="center",i.textBaseline=t._baseline;var n=i.measureText(t._value).width,r=Math.max(t._size||t._leading);this._linewidth&&!u.isHidden.test(this._stroke)&&(r+=this._linewidth);var s=n/2,a=r/2;switch(u.alignments[t._alignment]||t._alignment){case u.alignments.left:e.left=0,e.right=n;break;case u.alignments.right:e.left=-n,e.right=0;break;default:e.left=-s,e.right=s}switch(t._baseline){case"bottom":e.top=-r,e.bottom=0;break;case"top":e.top=0,e.bottom=r;break;default:e.top=-a,e.bottom=a}e.width=n,e.height=r,e.centroid||(e.centroid={}),e.centroid.x=s,e.centroid.y=a},render:function(e,i,n){if(!this._visible||!this._opacity)return this;var s=this.parent,a=s._matrix.manual||s._flagMatrix,h=this._matrix.manual||this._flagMatrix,l=this._flagVertices||this._flagFill||this._fill instanceof t.LinearGradient&&(this._fill._flagSpread||this._fill._flagStops||this._fill._flagEndPoints)||this._fill instanceof t.RadialGradient&&(this._fill._flagSpread||this._fill._flagStops||this._fill._flagRadius||this._fill._flagCenter||this._fill._flagFocal)||this._stroke instanceof t.LinearGradient&&(this._stroke._flagSpread||this._stroke._flagStops||this._stroke._flagEndPoints)||this._stroke instanceof t.RadialGradient&&(this._stroke._flagSpread||this._stroke._flagStops||this._stroke._flagRadius||this._stroke._flagCenter||this._stroke._flagFocal)||this._flagStroke||this._flagLinewidth||this._flagOpacity||s._flagOpacity||this._flagVisible||this._flagScale||this._flagValue||this._flagFamily||this._flagSize||this._flagLeading||this._flagAlignment||this._flagBaseline||this._flagStyle||this._flagWeight||this._flagDecoration||!this._renderer.texture;return this._update(),(a||h)&&(this._renderer.matrix||(this._renderer.matrix=new t.Array(9)),this._matrix.toArray(!0,o),r(o,s._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*s._renderer.scale),l&&(this._renderer.rect||(this._renderer.rect={}),this._renderer.triangles||(this._renderer.triangles=new t.Array(12)),this._renderer.opacity=this._opacity*s._renderer.opacity,u.text.getBoundingClientRect(this,this._renderer.rect),u.getTriangles(this._renderer.rect,this._renderer.triangles),u.updateBuffer.call(u,e,this,i),u.updateTexture.call(u,e,this)),!this._clip||n?(e.bindBuffer(e.ARRAY_BUFFER,this._renderer.textureCoordsBuffer),e.vertexAttribPointer(i.textureCoords,2,e.FLOAT,!1,0,0),e.bindTexture(e.TEXTURE_2D,this._renderer.texture),e.uniformMatrix3fv(i.matrix,!1,this._renderer.matrix),e.bindBuffer(e.ARRAY_BUFFER,this._renderer.buffer),e.vertexAttribPointer(i.position,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,6),this.flagReset()):void 0}},"linear-gradient":{render:function(t,e){if(t.canvas.getContext("2d")){if(this._update(),!this._renderer.gradient||this._flagEndPoints||this._flagStops){this._renderer.gradient=t.createLinearGradient(this.left._x,this.left._y,this.right._x,this.right._y);for(var i=0;i<this.stops.length;i++){var n=this.stops[i];this._renderer.gradient.addColorStop(n._offset,n._color)}}return this.flagReset()}}},"radial-gradient":{render:function(t,e){if(t.canvas.getContext("2d")){if(this._update(),!this._renderer.gradient||this._flagCenter||this._flagFocal||this._flagRadius||this._flagStops){this._renderer.gradient=t.createRadialGradient(this.center._x,this.center._y,0,this.focal._x,this.focal._y,this._radius);for(var i=0;i<this.stops.length;i++){var n=this.stops[i];this._renderer.gradient.addColorStop(n._offset,n._color)}}return this.flagReset()}}},getTriangles:function(t,e){var i=t.top,n=t.left,r=t.right,s=t.bottom;e[0]=n,e[1]=i,e[2]=r,e[3]=i,e[4]=n,e[5]=s,e[6]=n,e[7]=s,e[8]=r,e[9]=i,e[10]=r,e[11]=s},updateTexture:function(t,e){this[e._renderer.type].updateCanvas.call(u,e),e._renderer.texture&&t.deleteTexture(e._renderer.texture),t.bindBuffer(t.ARRAY_BUFFER,e._renderer.textureCoordsBuffer),e._renderer.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,e._renderer.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),this.canvas.width<=0||this.canvas.height<=0||t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(t,i,n){e.isObject(i._renderer.buffer)&&t.deleteBuffer(i._renderer.buffer),i._renderer.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i._renderer.buffer),t.enableVertexAttribArray(n.position),t.bufferData(t.ARRAY_BUFFER,i._renderer.triangles,t.STATIC_DRAW),e.isObject(i._renderer.textureCoordsBuffer)&&t.deleteBuffer(i._renderer.textureCoordsBuffer),i._renderer.textureCoordsBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i._renderer.textureCoordsBuffer),t.enableVertexAttribArray(n.textureCoords),t.bufferData(t.ARRAY_BUFFER,this.uv,t.STATIC_DRAW)},program:{create:function(i,n){var r,s,a;if(r=i.createProgram(),e.each(n,function(t){i.attachShader(r,t)}),i.linkProgram(r),s=i.getProgramParameter(r,i.LINK_STATUS),!s)throw a=i.getProgramInfoLog(r),i.deleteProgram(r),new t.Utils.Error("unable to link program: "+a);return r}},shaders:{create:function(e,i,n){var r,s,a;if(r=e.createShader(e[n]),e.shaderSource(r,i),e.compileShader(r),s=e.getShaderParameter(r,e.COMPILE_STATUS),!s)throw a=e.getShaderInfoLog(r),e.deleteShader(r),new t.Utils.Error("unable to compile shader "+r+": "+a);return r},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:["attribute vec2 a_position;","attribute vec2 a_textureCoords;","","uniform mat3 u_matrix;","uniform vec2 u_resolution;","","varying vec2 v_textureCoords;","","void main() {","   vec2 projected = (u_matrix * vec3(a_position, 1.0)).xy;","   vec2 normal = projected / u_resolution;","   vec2 clipspace = (normal * 2.0) - 1.0;","","   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);","   v_textureCoords = a_textureCoords;","}"].join("\n"),fragment:["precision mediump float;","","uniform sampler2D u_image;","varying vec2 v_textureCoords;","","void main() {","  gl_FragColor = texture2D(u_image, v_textureCoords);","}"].join("\n")}};u.ctx=u.canvas.getContext("2d");var c=t[t.Types.webgl]=function(i){var n,r,s,o;if(this.domElement=i.domElement||document.createElement("canvas"),this.scene=new t.Group,this.scene.parent=this,this._renderer={matrix:new t.Array(a),scale:1,opacity:1},this._flagMatrix=!0,n=e.defaults(i||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!0,overdraw:!1}),this.overdraw=n.overdraw,r=this.ctx=this.domElement.getContext("webgl",n)||this.domElement.getContext("experimental-webgl",n),!this.ctx)throw new t.Utils.Error("unable to create a webgl context. Try using another renderer.");s=u.shaders.create(r,u.shaders.vertex,u.shaders.types.vertex),o=u.shaders.create(r,u.shaders.fragment,u.shaders.types.fragment),this.program=u.program.create(r,[s,o]),r.useProgram(this.program),this.program.position=r.getAttribLocation(this.program,"a_position"),this.program.matrix=r.getUniformLocation(this.program,"u_matrix"),this.program.textureCoords=r.getAttribLocation(this.program,"a_textureCoords"),r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)};e.extend(c,{Utils:u}),e.extend(c.prototype,i.Events,{setSize:function(t,i,n){this.width=t,this.height=i,this.ratio=e.isUndefined(n)?h(this.ctx):n,this.domElement.width=t*this.ratio,this.domElement.height=i*this.ratio,e.extend(this.domElement.style,{width:t+"px",height:i+"px"}),t*=this.ratio,i*=this.ratio,this._renderer.matrix[0]=this._renderer.matrix[4]=this._renderer.scale=this.ratio,this._flagMatrix=!0,this.ctx.viewport(0,0,t,i);var r=this.ctx.getUniformLocation(this.program,"u_resolution");return this.ctx.uniform2f(r,t,i),this},render:function(){var t=this.ctx;return this.overdraw||t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),u.group.render.call(this.scene,t,this.program),this._flagMatrix=!1,this}})}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Shape=function(){this._renderer={},this.id=t.Identifier+t.uniqueId(),this.classList=[],this._matrix=new t.Matrix,this.translation=new t.Vector,this.translation.bind(t.Events.change,e.bind(r.FlagMatrix,this)),this.rotation=0,this.scale=1};e.extend(r,i.Events,{FlagMatrix:function(){this._flagMatrix=!0},MakeObservable:function(t){Object.defineProperty(t,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this._flagMatrix=!0}}),Object.defineProperty(t,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this._flagMatrix=!0,this._flagScale=!0}})}}),e.extend(r.prototype,{_flagMatrix:!0,_rotation:0,_scale:1,addTo:function(t){return t.add(this),this},clone:function(){var t=new r;return t.translation.copy(this.translation),t.rotation=this.rotation,t.scale=this.scale,e.each(r.Properties,function(e){t[e]=this[e]},this),t._update()},_update:function(t){return!this._matrix.manual&&this._flagMatrix&&this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation),t&&this.parent&&this.parent._update&&this.parent._update(),this},flagReset:function(){return this._flagMatrix=this._flagScale=!1,this}}),r.MakeObservable(r.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){function r(e,i,n){var r,s,a,o,h,l,u,c,f=i.controls&&i.controls.right,d=e.controls&&e.controls.left;return r=i.x,h=i.y,s=(f||i).x,l=(f||i).y,a=(d||e).x,u=(d||e).y,o=e.x,c=e.y,f&&i._relative&&(s+=i.x,l+=i.y),d&&e._relative&&(a+=e.x,u+=e.y),t.Utils.getCurveLength(r,h,s,l,a,u,o,c,n)}function s(e,i,n){var r,s,a,o,h,l,u,c,f=i.controls&&i.controls.right,d=e.controls&&e.controls.left;return r=i.x,h=i.y,s=(f||i).x,l=(f||i).y,a=(d||e).x,u=(d||e).y,o=e.x,c=e.y,f&&i._relative&&(s+=i.x,l+=i.y),d&&e._relative&&(a+=e.x,u+=e.y),t.Utils.subdivide(r,h,s,l,a,u,o,c,n)}var a=Math.min,o=Math.max,h=Math.round,l=t.Utils.getComputedMatrix,u={};e.each(t.Commands,function(t,e){u[e]=new RegExp(t)});var c=t.Path=function(e,i,n,r){t.Shape.call(this),this._renderer.type="path",this._closed=!!i,this._curved=!!n,this.beginning=0,this.ending=1,this.fill="#fff",this.stroke="#000",this.linewidth=1,this.opacity=1,this.visible=!0,this.cap="butt",this.join="miter",this.miter=4,this._vertices=[],this.vertices=e,this.automatic=!r};e.extend(c,{Properties:["fill","stroke","linewidth","opacity","visible","cap","join","miter","closed","curved","automatic","beginning","ending"],FlagVertices:function(){this._flagVertices=!0,this._flagLength=!0},MakeObservable:function(i){t.Shape.MakeObservable(i),e.each(c.Properties.slice(0,8),function(t){var e="_"+t,n="_flag"+t.charAt(0).toUpperCase()+t.slice(1);Object.defineProperty(i,t,{get:function(){return this[e]},set:function(t){this[e]=t,this[n]=!0}})}),Object.defineProperty(i,"length",{get:function(){return this._flagLength&&this._updateLength(),this._length}}),Object.defineProperty(i,"closed",{get:function(){return this._closed},set:function(t){this._closed=!!t,this._flagVertices=!0}}),Object.defineProperty(i,"curved",{get:function(){return this._curved},set:function(t){this._curved=!!t,this._flagVertices=!0}}),Object.defineProperty(i,"automatic",{get:function(){return this._automatic},set:function(t){if(t!==this._automatic){this._automatic=!!t;var i=this._automatic?"ignore":"listen";e.each(this.vertices,function(t){t[i]()})}}}),Object.defineProperty(i,"beginning",{get:function(){return this._beginning},set:function(t){this._beginning=a(o(t,0),this._ending),this._flagVertices=!0}}),Object.defineProperty(i,"ending",{get:function(){return this._ending},set:function(t){this._ending=a(o(t,this._beginning),1),this._flagVertices=!0}}),Object.defineProperty(i,"vertices",{get:function(){return this._collection},set:function(i){var n=e.bind(c.FlagVertices,this),r=e.bind(function(e){for(var i=e.length;i--;)e[i].bind(t.Events.change,n);n()},this),s=e.bind(function(i){e.each(i,function(e){e.unbind(t.Events.change,n)},this),n()},this);this._collection&&this._collection.unbind(),this._collection=new t.Utils.Collection((i||[]).slice(0)),this._collection.bind(t.Events.insert,r),this._collection.bind(t.Events.remove,s),r(this._collection)}}),Object.defineProperty(i,"clip",{get:function(){return this._clip},set:function(t){this._clip=t,this._flagClip=!0}})}}),e.extend(c.prototype,t.Shape.prototype,{_flagVertices:!0,_flagLength:!0,_flagFill:!0,_flagStroke:!0,_flagLinewidth:!0,_flagOpacity:!0,_flagVisible:!0,_flagCap:!0,_flagJoin:!0,_flagMiter:!0,_flagClip:!1,_length:0,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,_clip:!1,clone:function(i){i=i||this.parent;var n=e.map(this.vertices,function(t){return t.clone()}),r=new c(n,this.closed,this.curved,!this.automatic);return e.each(t.Path.Properties,function(t){r[t]=this[t]},this),r.translation.copy(this.translation),r.rotation=this.rotation,r.scale=this.scale,i.add(r),r},toObject:function(){var i={vertices:e.map(this.vertices,function(t){return t.toObject()})};return e.each(t.Shape.Properties,function(t){i[t]=this[t]},this),i.translation=this.translation.toObject,i.rotation=this.rotation,i.scale=this.scale,i},noFill:function(){return this.fill="transparent",this},noStroke:function(){return this.stroke="transparent",this},corner:function(){var t=this.getBoundingClientRect(!0);return t.centroid={x:t.left+t.width/2,y:t.top+t.height/2},e.each(this.vertices,function(e){e.addSelf(t.centroid)}),this},center:function(){var t=this.getBoundingClientRect(!0);return t.centroid={x:t.left+t.width/2,y:t.top+t.height/2},e.each(this.vertices,function(e){e.subSelf(t.centroid)}),this},remove:function(){return this.parent?(this.parent.remove(this),this):this},getBoundingClientRect:function(t){var e,i,n,r,s,h,u,c=1/0,f=-(1/0),d=1/0,_=-(1/0);for(this._update(!0),e=t?this._matrix:l(this),i=this.linewidth/2,n=this._vertices.length,h=0;h<n;h++)u=this._vertices[h],r=u.x,s=u.y,u=e.multiply(r,s,1),d=a(u.y-i,d),c=a(u.x-i,c),f=o(u.x+i,f),_=o(u.y+i,_);return{top:d,left:c,right:f,bottom:_,width:f-c,height:_-d}},getPointAt:function(i,n){for(var r,s,a,o,h,l,u,c,f,d,_,g,p=this.length*Math.min(Math.max(i,0),1),v=this.vertices.length,m=v-1,y=null,x=null,b=0,w=this._lengths.length,C=0;b<w;b++){if(C+this._lengths[b]>p){y=this.vertices[this.closed?t.Utils.mod(b,v):b],x=this.vertices[Math.min(Math.max(b-1,0),m)],p-=C,i=p/this._lengths[b];break}C+=this._lengths[b]}return e.isNull(y)||e.isNull(x)?null:(g=x.controls&&x.controls.right,_=y.controls&&y.controls.left,s=x.x,u=x.y,a=(g||x).x,c=(g||x).y,o=(_||y).x,f=(_||y).y,h=y.x,d=y.y,g&&x._relative&&(a+=x.x,c+=x.y),_&&y._relative&&(o+=y.x,f+=y.y),r=t.Utils.getPointOnCubicBezier(i,s,a,o,h),l=t.Utils.getPointOnCubicBezier(i,u,c,f,d),e.isObject(n)?(n.x=r,n.y=l,n):new t.Vector(r,l))},plot:function(){if(this.curved)return t.Utils.getCurveFromPoints(this._vertices,this.closed),this;for(var e=0;e<this._vertices.length;e++)this._vertices[e]._command=0===e?t.Commands.move:t.Commands.line;return this},subdivide:function(i){this._update();var n=this.vertices.length-1,r=this.vertices[n],a=this._closed||this.vertices[n]._command===t.Commands.close,o=[];return e.each(this.vertices,function(h,l){if(l<=0&&!a)return void(r=h);if(h.command===t.Commands.move)return o.push(new t.Anchor(r.x,r.y)),l>0&&(o[o.length-1].command=t.Commands.line),void(r=h);var u=s(h,r,i);o=o.concat(u),e.each(u,function(e,i){i<=0&&r.command===t.Commands.move?e.command=t.Commands.move:e.command=t.Commands.line}),l>=n&&(this._closed&&this._automatic?(r=h,u=s(h,r,i),o=o.concat(u),e.each(u,function(e,i){i<=0&&r.command===t.Commands.move?e.command=t.Commands.move:e.command=t.Commands.line})):a&&o.push(new t.Anchor(h.x,h.y)),o[o.length-1].command=a?t.Commands.close:t.Commands.line),r=h},this),this._automatic=!1,this._curved=!1,this.vertices=o,this},_updateLength:function(i){this._update();var n=this.vertices.length-1,s=this.vertices[n],a=this._closed||this.vertices[n]._command===t.Commands.close,o=0;return e.isUndefined(this._lengths)&&(this._lengths=[]),e.each(this.vertices,function(e,h){return h<=0&&!a||e.command===t.Commands.move?(s=e,void(this._lengths[h]=0)):(this._lengths[h]=r(e,s,i),o+=this._lengths[h],h>=n&&a&&(s=e,this._lengths[h+1]=r(e,s,i),o+=this._lengths[h+1]),void(s=e))},this),this._length=o,this},_update:function(){if(this._flagVertices){var e,i=this.vertices.length,n=i-1,r=h(this._beginning*n),s=h(this._ending*n);this._vertices.length=0;for(var a=r;a<s+1;a++)e=this.vertices[a],this._vertices.push(e);this._automatic&&this.plot()}return t.Shape.prototype._update.apply(this,arguments),this},flagReset:function(){return this._flagVertices=this._flagFill=this._flagStroke=this._flagLinewidth=this._flagOpacity=this._flagVisible=this._flagCap=this._flagJoin=this._flagMiter=this._flagClip=!1,t.Shape.prototype.flagReset.call(this),this}}),c.MakeObservable(c.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Path,s=t.Line=function(e,i,n,s){var a=n-e,o=s-i,h=a/2,l=o/2;r.call(this,[new t.Anchor(-h,-l),new t.Anchor(h,l)]),this.translation.set(e+h,i+l)};e.extend(s.prototype,r.prototype),r.MakeObservable(s.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Path,s=t.Rectangle=function(e,i,n,s){var a=n/2,o=s/2;r.call(this,[new t.Anchor(-a,-o),new t.Anchor(a,-o),new t.Anchor(a,o),new t.Anchor(-a,o)],!0),this.translation.set(e,i)};e.extend(s.prototype,r.prototype),r.MakeObservable(s.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Path,s=2*Math.PI,a=Math.cos,o=Math.sin,h=t.Ellipse=function(i,n,h,l){e.isNumber(l)||(l=h);var u=t.Resolution,c=e.map(e.range(u),function(e){var i=e/u,n=i*s,r=h*a(n),c=l*o(n);return new t.Anchor(r,c)},this);r.call(this,c,!0,!0),this.translation.set(i,n)};e.extend(h.prototype,r.prototype),r.MakeObservable(h.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Path,s=2*Math.PI,a=Math.cos,o=Math.sin,h=t.Polygon=function(i,n,h,l){l=Math.max(l||0,3);var u=e.map(e.range(l),function(e){var i=(e+.5)/l,n=s*i+Math.PI/2,r=h*a(n),u=h*o(n);return new t.Anchor(r,u)});r.call(this,u,!0),this.translation.set(i,n)};e.extend(h.prototype,r.prototype),r.MakeObservable(h.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Path,s=Math.PI,a=(2*Math.PI,Math.PI/2),o=Math.cos,h=Math.sin,l=(Math.abs,t.ArcSegment=function(e,i,n,l,u,c,f){u>c&&(c+=2*Math.PI),f=f||8;var d=c-u,_=d/f,g=t.Commands.move,p=[];p.push(new t.Anchor(Math.sin(0)*l,Math.cos(0)*l,0,0,0,0,g));var v,m,y,x,b,w,C;g=t.Commands.curve;for(var S=0;S<f+1;S++)v=S*_,m=h(v)*l,y=o(v)*l,x=h(v-a)*(_/s)*l,b=o(v-a)*(_/s)*l,w=h(v+a)*(_/s)*l,C=o(v+a)*(_/s)*l,0===S&&(x=b=0),S===f&&(w=C=0),p.push(new t.Anchor(m,y,x,b,w,C,g));for(var A=0;A<f+1;A++)v=d-_*A,m=h(v)*n,y=o(v)*n,x=h(v-1.5*s)*(_/s)*n,b=o(v-1.5*s)*(_/s)*n,w=h(v+1.5*s)*(_/s)*n,C=o(v+1.5*s)*(_/s)*n,0===A&&(x=b=0),A===f&&(w=C=0),p.push(new t.Anchor(m,y,x,b,w,C,g));g=t.Commands.close,p.push(new t.Anchor(Math.sin(0)*l,Math.cos(0)*l,0,0,0,0,g)),r.call(this,p,!0,!1,!0),this.rotation=u,this.translation.set(e,i)});e.extend(l.prototype,r.prototype),r.MakeObservable(l.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Path,s=Math.PI,a=(2*Math.PI,Math.cos),o=Math.sin,h=(Math.abs,t.SineRing=function(e,i,n,h,l,u){var c=2*h+1,f=Math.PI/h,d=s*n/h/2;u=u||1;var _,g,p,v,m,y,x=[],b=s;x.push(new t.Anchor(o(b)*(n+l/2),a(b)*(n+l/2),0,0,0,0,t.Commands.move));for(var w=0;w<c;w++)b=f*w+s,w%2===0?(_=Math.sin(b)*(n+l/2),g=Math.cos(b)*(n+l/2)):(_=Math.sin(b)*(n-l/2),g=Math.cos(b)*(n-l/2)),p=Math.sin(b-Math.PI/2)*d*u,v=Math.cos(b-Math.PI/2)*d*u,m=Math.sin(b+Math.PI/2)*d*u,y=Math.cos(b+Math.PI/2)*d*u,0===w&&(p=v=0),w===c-1&&(m=y=0),x.push(new t.Anchor(_,g,p,v,m,y,t.Commands.curve));r.call(this,x,!0,!1,!0),this.translation.set(e,i)});e.extend(h.prototype,r.prototype),r.MakeObservable(h.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Path,s=2*Math.PI,a=Math.cos,o=Math.sin,h=t.Star=function(i,n,h,l,u){e.isNumber(l)||(l=h/2),(!e.isNumber(u)||u<=0)&&(u=5);var c=2*u,f=e.map(e.range(c),function(e){var i=(e-.5)/c,n=i*s,r=e%2?l:h,u=r*a(n),f=r*o(n);return new t.Anchor(u,f)});r.call(this,f,!0),this.translation.set(i,n)};e.extend(h.prototype,r.prototype),r.MakeObservable(h.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){function r(i,n,r,a,o){var h=0,l=0,u=t.Resolution,c=(i[i.length-1],new t.Anchor(n,r),n<0?-a:a),f=r<0?-a:a;switch(o){case 1:h=-Math.PI/2,l=0;break;case 2:h=-Math.PI,l=-Math.PI/2;break;case 3:h=1.5*-Math.PI,l=-Math.PI;break;case 4:h=0,l=Math.PI/2}var d=e.map(e.range(u),function(e){var i=s(u-e,0,u,h,l),o=a*Math.cos(i)+n-c,d=a*Math.sin(i)+r-f,_=new t.Anchor(o,d);return _}).reverse();return i.concat(d)}function s(t,e,i,n,r){return n+(r-n)*((t-e)/(i-e))}var a=t.Path,o=t.RoundedRectangle=function(i,n,s,o,h){var l,u,c=s/2,f=o/2;e.isNumber(h)||(h=Math.floor(Math.min(s,o)/12));var d=[new t.Anchor(-c+h,-f),new t.Anchor(c-h,-f)];l=c,u=-f,d=r(d,l,u,h,1),d.push(new t.Anchor(c,f-h)),l=c,u=f,d=r(d,l,u,h,4),d.push(new t.Anchor(-c+h,f)),l=-c,u=f,d=r(d,l,u,h,3),d.push(new t.Anchor(-c,-f+h)),l=-c,u=-f,d=r(d,l,u,h,2),d.pop(),a.call(this,d,!0),this.translation.set(i,n)};e.extend(o.prototype,a.prototype),a.MakeObservable(o.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),
function(t,e,i,n){var r=t.Utils.getComputedMatrix,s=document.createElement("canvas");s.getContext("2d");t.Text=function(i,n,r,s){return t.Shape.call(this),this._renderer.type="text",this.value=i,e.isNumber(n)&&(this.translation.x=n),e.isNumber(r)&&(this.translation.y=r),e.isObject(s)?void e.each(t.Text.Properties,function(t){t in s&&(this[t]=s[t])},this):this},e.extend(t.Text,{Properties:["value","family","size","leading","alignment","fill","stroke","linewidth","style","weight","decoration","baseline","opacity","visible"],MakeObservable:function(i){t.Shape.MakeObservable(i),e.each(t.Text.Properties,function(t){var e="_"+t,n="_flag"+t.charAt(0).toUpperCase()+t.slice(1);Object.defineProperty(i,t,{get:function(){return this[e]},set:function(t){this[e]=t,this[n]=!0}})}),Object.defineProperty(i,"clip",{get:function(){return this._clip},set:function(t){this._clip=t,this._flagClip=!0}})}}),e.extend(t.Text.prototype,t.Shape.prototype,{_flagValue:!0,_flagFamily:!0,_flagSize:!0,_flagLeading:!0,_flagAlignment:!0,_flagBaseline:!0,_flagStyle:!0,_flagWeight:!0,_flagDecoration:!0,_flagFill:!0,_flagStroke:!0,_flagLinewidth:!0,_flagOpacity:!0,_flagVisible:!0,_flagClip:!1,_value:"",_family:"sans-serif",_size:13,_leading:17,_alignment:"center",_baseline:"middle",_style:"normal",_weight:500,_decoration:"none",_fill:"#000",_stroke:"transparent",_linewidth:1,_opacity:1,_visible:!0,_clip:!1,clone:function(i){var i=i||this.parent,n=new t.Text(this.value);return n.translation.copy(this.translation),n.rotation=this.rotation,n.scale=this.scale,e.each(t.Text.Properties,function(t){n[t]=this[t]},this),i.add(n),n},toObject:function(){var i={translation:this.translation.toObject(),rotation:this.rotation,scale:this.scale};return e.each(t.Text.Properties,function(t){i[t]=this[t]},this),i},noStroke:function(){return this.stroke="transparent",this},noFill:function(){return this.fill="transparent",this},getBoundingClientRect:function(t){var e,i;return this._update(!0),e=t?this._matrix:r(this),i=e.multiply(0,0,1),{top:i.x,left:i.y,right:i.x,bottom:i.y,width:0,height:0}},flagReset:function(){return this._flagValue=this._flagFamily=this._flagSize=this._flagLeading=this._flagAlignment=this._flagFill=this._flagStroke=this._flagLinewidth=this._flagOpaicty=this._flagVisible=this._flagClip=this._flagDecoration=this._flagBaseline=!1,t.Shape.prototype.flagReset.call(this),this}}),t.Text.MakeObservable(t.Text.prototype)}(Two,"function"!=typeof require||"function"==typeof define&&define.amd?_:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.Stop=function(t,i,n){this._renderer={},this.offset=e.isNumber(t)?t:r.Index<=0?0:1,this.opacity=e.isNumber(n)?n:1,this.color=e.isString(i)?i:r.Index<=0?"#fff":"#000",r.Index=(r.Index+1)%2};e.extend(r,{Index:0,Properties:["offset","opacity","color"],MakeObservable:function(i){e.each(r.Properties,function(e){var n="_"+e,r="_flag"+e.charAt(0).toUpperCase()+e.slice(1);Object.defineProperty(i,e,{get:function(){return this[n]},set:function(e){this[n]=e,this[r]=!0,this.trigger(t.Events.change)}})})}}),e.extend(r.prototype,i.Events,{clone:function(){var t=new r;return e.each(r.Properties,function(e){t[e]=this[e]},this),t},toObject:function(){var t={};return e.each(r.Properties,function(e){t[e]=this[e]},this),t},flagReset:function(){return this._flagOffset=this._flagColor=this._flagOpacity=!1,this}}),r.MakeObservable(r.prototype);var s=t.Gradient=function(e){t.Shape.call(this),this._renderer.type="gradient",this.spread="pad",this.stops=e};e.extend(s,{Stop:r,Properties:["spread"],MakeObservable:function(i){t.Shape.MakeObservable(i),e.each(s.Properties,t.Utils.defineProperty,i),Object.defineProperty(i,"stops",{get:function(){return this._stops},set:function(i){var n=e.bind(s.FlagStops,this),r=e.bind(function(e){for(var i=e.length;i--;)e[i].bind(t.Events.change,n);n()},this),a=e.bind(function(i){e.each(i,function(e){e.unbind(t.Events.change,n)},this),n()},this);this._stops&&this._stops.unbind(),this._stops=new t.Utils.Collection((i||[]).slice(0)),this._stops.bind(t.Events.insert,r),this._stops.bind(t.Events.remove,a),r(this._stops)}})},FlagStops:function(){this._flagStops=!0}}),e.extend(s.prototype,t.Shape.prototype,{clone:function(i){i=i||this.parent;var n=e.map(this.stops,function(t){return t.clone()}),r=new s(n);return e.each(t.Gradient.Properties,function(t){r[t]=this[t]},this),r.translation.copy(this.translation),r.rotation=this.rotation,r.scale=this.scale,i.add(r),r},toObject:function(){var t={stops:e.map(this.stops,function(t){return t.toObject()})};return e.each(s.Properties,function(e){t[e]=this[e]},this),t},flagReset:function(){return this._flagSpread=this._flagStops=!1,t.Shape.prototype.flagReset.call(this),this}}),s.MakeObservable(s.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.LinearGradient=function(i,n,s,a,o){t.Gradient.call(this,o),this._renderer.type="linear-gradient";var h=e.bind(r.FlagEndPoints,this);this.left=(new t.Vector).bind(t.Events.change,h),this.right=(new t.Vector).bind(t.Events.change,h),e.isNumber(i)&&(this.left.x=i),e.isNumber(n)&&(this.left.y=n),e.isNumber(s)&&(this.right.x=s),e.isNumber(a)&&(this.right.y=a)};e.extend(r,{Stop:t.Gradient.Stop,MakeObservable:function(e){t.Gradient.MakeObservable(e)},FlagEndPoints:function(){this._flagEndPoints=!0}}),e.extend(r.prototype,t.Gradient.prototype,{_flagEndPoints:!1,clone:function(i){i=i||this.parent;var n=e.map(this.stops,function(t){return t.clone()}),s=new r(this.left._x,this.left._y,this.right._x,this.right._y,n);return e.each(t.Gradient.Properties,function(t){s[t]=this[t]},this),i.add(s),s},toObject:function(){var e=t.Gradient.prototype.toObject.call(this);return e.left=this.left.toObject(),e.right=this.right.toObject(),e},flagReset:function(){return this._flagEndPoints=!1,t.Gradient.prototype.flagReset.call(this),this}}),r.MakeObservable(r.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){var r=t.RadialGradient=function(i,n,r,s,a,o){t.Gradient.call(this,s),this._renderer.type="radial-gradient",this.center=(new t.Vector).bind(t.Events.change,e.bind(function(){this._flagCenter=!0},this)),this.radius=e.isNumber(r)?r:20,this.focal=(new t.Vector).bind(t.Events.change,e.bind(function(){this._flagFocal=!0},this)),e.isNumber(i)&&(this.center.x=i),e.isNumber(n)&&(this.center.y=n),this.focal.copy(this.center),e.isNumber(a)&&(this.focal.x=a),e.isNumber(o)&&(this.focal.y=o)};e.extend(r,{Stop:t.Gradient.Stop,Properties:["radius"],MakeObservable:function(i){t.Gradient.MakeObservable(i),e.each(r.Properties,t.Utils.defineProperty,i)}}),e.extend(r.prototype,t.Gradient.prototype,{_flagEndPoints:!1,clone:function(i){i=i||this.parent;var n=e.map(this.stops,function(t){return t.clone()}),s=new r(this.center._x,this.center._y,this._radius,n,this.focal._x,this.focal._y);return e.each(t.Gradient.Properties.concat(r.Properties),function(t){s[t]=this[t]},this),i.add(s),s},toObject:function(){var i=t.Gradient.prototype.toObject.call(this);return e.each(r.Properties,function(t){i[t]=this[t]},this),i.center=this.center.toObject(),i.focal=this.focal.toObject(),i},flagReset:function(){return this._flagRadius=this._flagCenter=this._flagFocal=!1,t.Gradient.prototype.flagReset.call(this),this}}),r.MakeObservable(r.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame")),function(t,e,i,n){function r(t,i){var n,r=t.parent;return r===i?(this.additions.push(t),void(this._flagAdditions=!0)):(r&&r.children.ids[t.id]&&(n=e.indexOf(r.children,t),r.children.splice(n,1),n=e.indexOf(r.additions,t),n>=0?r.additions.splice(n,1):(r.subtractions.push(t),r._flagSubtractions=!0)),i?(t.parent=i,this.additions.push(t),void(this._flagAdditions=!0)):(n=e.indexOf(this.additions,t),n>=0?this.additions.splice(n,1):(this.subtractions.push(t),this._flagSubtractions=!0),void delete t.parent))}var s=Math.min,a=Math.max,o=function(){t.Utils.Collection.apply(this,arguments),Object.defineProperty(this,"_events",{value:{},enumerable:!1}),this.ids={},this.on(t.Events.insert,this.attach),this.on(t.Events.remove,this.detach),o.prototype.attach.apply(this,arguments)};o.prototype=new t.Utils.Collection,o.constructor=o,e.extend(o.prototype,{attach:function(t){for(var e=0;e<t.length;e++)this.ids[t[e].id]=t[e];return this},detach:function(t){for(var e=0;e<t.length;e++)delete this.ids[t[e].id];return this}});var h=t.Group=function(){t.Shape.call(this,!0),this._renderer.type="group",this.additions=[],this.subtractions=[],this._children=[],this.children=arguments};e.extend(h,{Children:o,InsertChildren:function(t){for(var e=0;e<t.length;e++)r.call(this,t[e],this)},RemoveChildren:function(t){for(var e=0;e<t.length;e++)r.call(this,t[e])},OrderChildren:function(t){this._flagOrder=!0},MakeObservable:function(i){var n=t.Path.Properties.slice(0),r=e.indexOf(n,"opacity");r>=0&&(n.splice(r,1),Object.defineProperty(i,"opacity",{get:function(){return this._opacity},set:function(t){this._flagOpacity=this._opacity!=t,this._opacity=t}})),t.Shape.MakeObservable(i),h.MakeGetterSetters(i,n),Object.defineProperty(i,"children",{get:function(){return this._collection},set:function(i){var n=e.bind(h.InsertChildren,this),r=e.bind(h.RemoveChildren,this),s=e.bind(h.OrderChildren,this);this._collection&&this._collection.unbind(),this._collection=new o(i),this._collection.bind(t.Events.insert,n),this._collection.bind(t.Events.remove,r),this._collection.bind(t.Events.order,s)}}),Object.defineProperty(i,"mask",{get:function(){return this._mask},set:function(t){this._mask=t,this._flagMask=!0,t.clip||(t.clip=!0)}})},MakeGetterSetters:function(t,i){e.isArray(i)||(i=[i]),e.each(i,function(e){h.MakeGetterSetter(t,e)})},MakeGetterSetter:function(t,i){var n="_"+i;Object.defineProperty(t,i,{get:function(){return this[n]},set:function(t){this[n]=t,e.each(this.children,function(e){e[i]=t})}})}}),e.extend(h.prototype,t.Shape.prototype,{_flagAdditions:!1,_flagSubtractions:!1,_flagOrder:!1,_flagOpacity:!0,_flagMask:!1,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,_mask:null,clone:function(t){t=t||this.parent;var i=new h;t.add(i);e.map(this.children,function(t){return t.clone(i)});return i.translation.copy(this.translation),i.rotation=this.rotation,i.scale=this.scale,i},toObject:function(){var t={children:{},translation:this.translation.toObject(),rotation:this.rotation,scale:this.scale};return e.each(this.children,function(e,i){t.children[i]=e.toObject()},this),t},corner:function(){var t=this.getBoundingClientRect(!0),e={x:t.left,y:t.top};return this.children.forEach(function(t){t.translation.subSelf(e)}),this},center:function(){var t=this.getBoundingClientRect(!0);return t.centroid={x:t.left+t.width/2,y:t.top+t.height/2},this.children.forEach(function(e){e.translation.subSelf(t.centroid)}),this},getById:function(t){var e=function(t,i){if(t.id===i)return t;if(t.children)for(var n=t.children.length;n--;){var r=e(t.children[n],i);if(r)return r}};return e(this,t)||null},getByClassName:function(t){var e=[],i=function(t,n){return t.classList.indexOf(n)!=-1?e.push(t):t.children&&t.children.forEach(function(t){i(t,n)}),e};return i(this,t)},getByType:function(e){var i=[],n=function(e,r){for(var s in e.children)e.children[s]instanceof r?i.push(e.children[s]):e.children[s]instanceof t.Group&&n(e.children[s],r);return i};return n(this,e)},add:function(t){t=t instanceof Array?t.slice():e.toArray(arguments);for(var i=0;i<t.length;i++)t[i]&&t[i].id&&this.children.push(t[i]);return this},remove:function(t){var i=arguments.length,n=this.parent;if(i<=0&&n)return n.remove(this),this;t=t instanceof Array?t.slice():e.toArray(arguments);for(var r=0;r<t.length;r++)t[r]&&this.children.ids[t[r].id]&&this.children.splice(e.indexOf(this.children,t[r]),1);return this},getBoundingClientRect:function(t){var i;this._update(!0);var n=1/0,r=-(1/0),o=1/0,h=-(1/0);return this.children.forEach(function(l){/(linear-gradient|radial-gradient|gradient)/.test(l._renderer.type)||(i=l.getBoundingClientRect(t),e.isNumber(i.top)&&e.isNumber(i.left)&&e.isNumber(i.right)&&e.isNumber(i.bottom)&&(o=s(i.top,o),n=s(i.left,n),r=a(i.right,r),h=a(i.bottom,h)))},this),{top:o,left:n,right:r,bottom:h,width:r-n,height:h-o}},noFill:function(){return this.children.forEach(function(t){t.noFill()}),this},noStroke:function(){return this.children.forEach(function(t){t.noStroke()}),this},subdivide:function(){var t=arguments;return this.children.forEach(function(e){e.subdivide.apply(e,t)}),this},flagReset:function(){return this._flagAdditions&&(this.additions.length=0,this._flagAdditions=!1),this._flagSubtractions&&(this.subtractions.length=0,this._flagSubtractions=!1),this._flagOrder=this._flagMask=this._flagOpacity=!1,t.Shape.prototype.flagReset.call(this),this}}),h.MakeObservable(h.prototype)}(this.Two,"function"!=typeof require||"function"==typeof define&&define.amd?this._:require("underscore"),"function"!=typeof require||"function"==typeof define&&define.amd?this.Backbone:require("backbone"),"function"!=typeof require||"function"==typeof define&&define.amd?this.requestAnimationFrame:require("requestAnimationFrame"));